---
title: MoAI-ADK 아키텍처
description: Commands, Sub-agents, Skills, Hooks 4-레이어 구조
---

# MoAI-ADK 아키텍처

## 4-레이어 구조

MoAI-ADK는 **Commands → Sub-agents → Skills → Hooks** 4개 레이어로 구성됩니다.

```mermaid
graph TB
    A[Commands] --> B[Sub-agents]
    B --> C[Skills]
    C --> D[Hooks]

    A1[/alfred:0-project<br/>/alfred:1-plan<br/>/alfred:2-run<br/>/alfred:3-sync] --> A
    B1[spec-builder<br/>tdd-implementer<br/>doc-syncer<br/>git-manager] --> B
    C1[Foundation: EARS, TRUST<br/>Essentials: TDD, Refactor<br/>Alfred: Context, Memory<br/>Domain: Python, TypeScript] --> C
    D1[SessionStart<br/>PreToolUse<br/>PostToolUse] --> D
```

## Layer 1: Commands (워크플로우 오케스트레이션)

사용자가 직접 호출하는 진입점입니다.

### 주요 명령어

- **`/alfred:0-project`**: 프로젝트 초기화
- **`/alfred:1-plan`**: SPEC 작성
- **`/alfred:2-run`**: TDD 구현
- **`/alfred:3-sync`**: 문서 동기화

### 특징

- 여러 sub-agent 조율
- 사용자 승인 관리
- 진행 상황 추적

## Layer 2: Sub-agents (추론 & 의사결정)

작업별 전문가 에이전트들입니다.

### 핵심 에이전트 (10개)

1. **spec-builder**: SPEC 문서 작성
2. **implementation-planner**: 구현 계획 수립
3. **tdd-implementer**: TDD 사이클 실행
4. **quality-gate**: 코드 품질 검증
5. **doc-syncer**: 문서 동기화
6. **tag-agent**: @TAG 체인 관리
7. **git-manager**: Git 작업 수행
8. **debug-helper**: 오류 디버깅
9. **cc-manager**: Claude Code 관리
10. **skill-factory**: Skills 동적 생성

### 전문 에이전트 (6개)

- 언어별 전문가 (Python, TypeScript, etc.)
- 도메인별 전문가 (Backend, Frontend, etc.)

### Built-in 에이전트 (2개)

- **Plan Agent**: 작업 분석 및 계획
- **Explore Agent**: 코드베이스 탐색

## Layer 3: Skills (재사용 가능 지식)

<500단어 플레이북들입니다.

### 6개 Tier

1. **Foundation** (8개): EARS, TRUST, TAG 등 핵심 원칙
2. **Essentials** (12개): TDD, Refactor, Debug 등 필수 기술
3. **Alfred** (10개): Context, Memory, Commands 등 Alfred 고유 기능
4. **Domain** (10개): 특정 도메인 지식 (Backend, Frontend 등)
5. **Language** (10개): 언어별 베스트 프랙티스
6. **Ops** (5개): DevOps, CI/CD 등 운영 관련

### 로딩 방식

- **Progressive Disclosure**: 필요할 때만 로드
- **명시적 호출**: `Skill("skill-name")` 형식
- **컨텍스트 최적화**: 토큰 사용량 최소화

## Layer 4: Hooks (가드레일 & JIT 컨텍스트)

세션 이벤트에 자동 반응하는 가벼운 체크들입니다.

### 주요 Hook

- **SessionStart**: 프로젝트 요약 표시
- **PreToolUse**: 파괴적 명령 차단
- **PostToolUse**: 상태 카드 업데이트

### 특징

- <100ms 실행 시간
- 안전성 보장
- 컨텍스트 포인터 제공

## 레이어 선택 가이드

작업에 적합한 레이어를 선택하세요:

1. **이벤트에 자동 실행?** → Hook
2. **추론이나 대화 필요?** → Sub-agent
3. **재사용 가능한 지식이나 정책?** → Skill
4. **여러 단계나 승인 필요?** → Command

---

## 8개 핵심 서브시스템 (Subsystems)

MoAI-ADK의 **57개 Python 모듈**은 8개의 논리적 서브시스템으로 구성됩니다. 각 서브시스템은 명확한 책임을 가지고 독립적으로 동작하면서도 다른 시스템과 협력합니다.

### 1. CLI 서브시스템 (7개 파일)

**책임**: 사용자 인터페이스 및 명령어 처리

**주요 파일**:
- `init.py` (302줄): 프로젝트 초기화 명령어
- `doctor.py` (260줄): 프로젝트 상태 진단
- `update.py` (1,017줄): 프로젝트 자동 업데이트
- `status.py`: 현재 상태 조회
- `config.py`: 설정 관리
- `main.py`: CLI 진입점

**기능**:
- Rich console을 이용한 사용자 친화적 출력
- 명령어 파싱 및 라우팅
- 진행 상황 표시 (progress bars, spinners)
- 에러 처리 및 로깅

**사용 예**:
```bash
moai init                    # 프로젝트 초기화
moai doctor                  # 상태 진단
moai update                  # 자동 업데이트
```

### 2. Project 서브시스템 (6개 파일)

**책임**: 프로젝트 초기화, 단계별 설정, 프로젝트 상태 관리

**주요 파일**:
- `initializer.py` (194줄): 프로젝트 기본 구조 생성
- `phase_executor.py` (335줄): 5단계 설정 실행
- `checker.py` (302줄): 프로젝트 요구사항 검증
- `validator.py`: 프로젝트 정합성 확인

**기능**:
- 새 프로젝트 생성 및 템플릿 적용
- `.moai/` 디렉토리 구조 초기화
- `config.json` 생성 및 검증
- 프로젝트 메타데이터 관리

**데이터 모델**:
```python
# 프로젝트 구조
- .moai/
  - specs/
  - docs/
  - reports/
  - memory/
  - config.json
```

### 3. Git 서브시스템 (6개 파일)

**책임**: Git 작업 자동화 및 버전 관리

**주요 파일**:
- `manager.py` (127줄): Git 기본 작업 (add, commit, push)
- `branch_manager.py` (137줄): 브랜치 생성 및 전환
- `checkpoint.py` (140줄): 작업 스냅샷 저장/복구
- `pre_commit.py`: Pre-commit 훅 관리
- `commit_formatter.py`: 커밋 메시지 포맷팅

**기능**:
- 자동 브랜치 생성 (feature/SPEC-XXX)
- RED → GREEN → REFACTOR 커밋 추적
- 체크포인트 시스템 (작업 임시 저장)
- Pre-commit 훅 자동 설치

**GIT Flow**:
```
main
 ├─ release/v1.0
 └─ feature/SPEC-001 (feature branch)
    ├─ RED commit
    ├─ GREEN commit
    └─ REFACTOR commit
```

### 4. TAG 서브시스템 (10개 파일, 897줄 validator)

**책임**: @TAG 생성, 검증, 보고서 생성, 추적 가능성 보증

**핵심 컴포넌트**:
- `validator.py` (897줄): TAG 체인 검증 & 무결성 확인
- `reporter.py` (956줄): 다중 형식 보고서 생성 (JSON, Markdown, Plain)
- `ci_validator.py` (463줄): CI/CD 파이프라인 통합
- `pre_commit_validator.py` (354줄): Pre-commit 훅 검증

**TAG 체인 예시**:
```
SPEC:SAMPLE-001           (요구사항)
  ├─ TEST:SAMPLE-001      (테스트)
  ├─ CODE:SAMPLE-001      (구현)
  └─ DOC:SAMPLE-001       (문서)
```

**검증 규칙**:
- ✅ 중복 TAG 감지
- ✅ 고아 TAG 감지
- ✅ SPEC → CODE → TEST → DOC 연결 확인
- ✅ TAG 포맷 검증

**보고서 형식**:
- JSON: 자동화 도구 연동용
- Markdown: 사용자 조회용
- PlainText: 로그용

### 5. Quality 서브시스템 (2개 파일, 441줄)

**책임**: TRUST 5 원칙 기반 품질 관리

**주요 파일**:
- `trust_checker.py` (441줄): 5가지 품질 메트릭 검증

**TRUST 5 원칙**:

| 원칙 | 메트릭 | 기준 |
|------|--------|------|
| **T**est | 테스트 커버리지 | ≥ 85% |
| **R**eadable | 코드 가독성 | 파일 ≤300줄, 함수 ≤50줄 |
| **U**nified | 타입 안전성 | 타입 힌팅 100% |
| **S**ecured | 보안 검사 | Bandit 0 issues |
| **T**rackable | TAG 무결성 | SPEC-TEST-CODE-DOC 연결 확인 |

**검증 프로세스**:
```python
# 실행 흐름
1. pytest 실행 → 커버리지 계산
2. radon complexity 분석 → 가독성 확인
3. mypy --strict → 타입 검증
4. bandit → 보안 스캔
5. TAG validator → 추적성 확인
```

### 6. Template 서브시스템 (6개 파일)

**책임**: Jinja2 템플릿 처리, 파일 생성, 병합 전략

**주요 파일**:
- `processor.py` (521줄): 템플릿 처리 및 변수 대체
- `merger.py` (184줄): 기존 파일과 템플릿 병합 전략
- `template_engine.py` (257줄): Jinja2 엔진 관리

**기능**:
- Jinja2 템플릿 렌더링
- 변수 치환 (프로젝트명, 언어, 저자 등)
- 기존 파일 충돌 해결 (3-way merge)
- 조건부 파일 생성

**템플릿 구조**:
```
templates/
 ├─ .claude/          (Claude Code 설정)
 ├─ .moai/            (프로젝트 기본 구조)
 └─ src/              (코드 템플릿)
```

### 7. Config 서브시스템 (1개 파일)

**책임**: 설정 관리 및 마이그레이션

**주요 파일**:
- `config.py`: 설정 읽기/쓰기 및 버전 관리

**기능**:
- YAML/JSON 형식 지원
- 중첩 설정 구조 (`config.language.conversation_language`)
- 버전 마이그레이션 (v0.6.3 → v0.7.0+)
- 설정 검증 및 기본값 제공

**설정 예**:
```json
{
  "project": {
    "name": "my-project",
    "language": "python"
  },
  "language": {
    "conversation_language": "ko",
    "conversation_language_name": "Korean"
  }
}
```

### 8. Utils 서브시스템 (3개 파일)

**책임**: 공유 유틸리티 (로깅, 배너, 진단)

**주요 파일**:
- `logging.py`: 센시티브 정보 마스킹 로깅
- `banner.py`: CLI 배너 출력
- `diagnostics.py`: 시스템 진단 도구

**기능**:
- 민감 정보 자동 마스킹 (API 키, 경로 등)
- 컬러 배너 출력
- 시스템 사양 진단 (Python 버전, 의존성 등)
- 디버그 정보 수집

---

## 서브시스템 간 데이터 흐름

```
사용자 입력
    ↓
[CLI] 명령어 파싱
    ↓
[Project] 프로젝트 상태 확인
    ↓
[Template] 필요 파일 생성
    ↓
[Git] 변경사항 커밋
    ↓
[TAG] 추적 관계 검증
    ↓
[Quality] TRUST 5 검증
    ↓
사용자 결과 출력
```

---

## 아키텍처 설계 원칙

### 1. 단일 책임 원칙 (Single Responsibility)
각 서브시스템은 하나의 책임만 가집니다.

### 2. 인터페이스 분리 (Interface Segregation)
외부에서 필요한 메서드만 노출합니다.

### 3. 의존성 주입 (Dependency Injection)
결합도를 낮추기 위해 의존성을 주입받습니다.

### 4. 확장성 (Extensibility)
새로운 기능은 기존 코드 수정 없이 추가 가능합니다.

### 5. 테스트 용이성 (Testability)
각 서브시스템은 독립적으로 테스트 가능합니다.

---

## 다음 단계

- [주요 개념](/ko/introduction/concepts) - SPEC, TDD, TAG 시스템
- [CLI 명령어](/ko/cli/commands) - 4가지 핵심 명령어 상세 가이드
- [워크플로우 개요](/ko/workflow/overview) - 4단계 워크플로우
