---
title: /alfred:1-plan - SPEC 작성
description: MoAI-ADK SPEC 작성 명령어 상세 가이드 (EARS 포맷)
---

# /alfred:1-plan - SPEC 작성

SPEC(Specification) 작성은 MoAI-ADK 워크플로우의 두 번째 단계입니다. 구현하려는 기능에 대한 명확한 요구사항을 정의합니다.

## 개요

**목적**: 구현할 기능에 대한 상세한 SPEC 문서 작성 (EARS 형식)

**실행 위치**: 프로젝트 루트 디렉토리

**예상 시간**: 5-10분 (기능 복잡도에 따라 변동)

**출력**: SPEC 문서 3개 (spec.md, plan.md, acceptance.md) + @TAG 생성

---

## 기본 사용법

### 간단한 형식

Claude Code에서:

```
/alfred:1-plan "사용자 인증 기능"
```

### 상세한 형식 (부제목 추가)

```
/alfred:1-plan "사용자 인증" "이메일 기반 로그인" "JWT 토큰 발급" "비밀번호 암호화"
```

### 옵션 포함

```
/alfred:1-plan --name "USER-AUTH-001" --priority high "사용자 인증 기능"
```

---

## SPEC 작성 프로세스

### Step 1: 기능 설명 수집 (1-2분)

Alfred가 물어볼 질문들:

| 단계 | 질문 | 예시 |
|------|------|------|
| 1 | **기능 개요** | "사용자가 이메일과 비밀번호로 로그인" |
| 2 | **주요 요구사항** | "안전한 토큰 발급", "세션 관리" |
| 3 | **성공 기준** | "로그인 성공 시 JWT 토큰 반환" |
| 4 | **에러 처리** | "잘못된 이메일/비밀번호 시 에러" |

**입력 예시**:

```
기능명: 사용자 인증

주요 요구사항:
- 이메일 기반 로그인
- 안전한 비밀번호 저장
- JWT 토큰 발급
- 로그인 세션 추적

성공 기준:
- 올바른 이메일/비밀번호 입력 시 토큰 반환
- 토큰 유효기간: 24시간

에러 처리:
- 잘못된 이메일: 404 Not Found
- 잘못된 비밀번호: 401 Unauthorized
- 이메일 형식 오류: 400 Bad Request
```

### Step 2: EARS 형식 요구사항 작성 (3-5분)

Alfred가 생성하는 `.moai/specs/SPEC-AUTH-001/spec.md`:

```markdown
# SPEC-AUTH-001: 사용자 인증

## 개요
사용자가 이메일과 비밀번호를 이용하여 안전하게 로그인하는 기능을 제공합니다.

## 요구사항 (EARS 포맷)

### UBIQUITOUS (보편적)
시스템이 항상 만족해야 하는 요구사항:

- REQ-001: 시스템은 모든 사용자 입력을 검증해야 한다
- REQ-002: 시스템은 모든 민감 정보를 암호화하여 저장해야 한다
- REQ-003: 시스템은 로그인 시도를 기록해야 한다

### EVENT-DRIVEN (이벤트 기반)
특정 이벤트 발생 시 수행해야 할 요구사항:

- REQ-004: WHEN 사용자가 로그인을 시도하면
  - 시스템은 이메일 형식을 검증해야 한다
  - 시스템은 사용자의 비밀번호를 검증해야 한다
  - 시스템은 JWT 토큰을 발급해야 한다
  - 시스템은 로그인 기록을 저장해야 한다

- REQ-005: WHEN 사용자가 로그아웃하면
  - 시스템은 현재 토큰을 무효화해야 한다
  - 시스템은 로그아웃 기록을 저장해야 한다

### STATE-DRIVEN (상태 기반)
특정 상태에서 유지해야 할 요구사항:

- REQ-006: WHILE 로그인 세션이 유효하면
  - 시스템은 토큰을 검증해야 한다
  - 시스템은 사용자 정보에 접근을 허락해야 한다

- REQ-007: WHILE 로그인 세션이 만료되면
  - 시스템은 토큰을 거부해야 한다
  - 시스템은 재로그인을 요청해야 한다

### OPTIONAL (선택사항)
필요에 따라 구현할 수 있는 요구사항:

- REQ-008: 시스템은 다중 로그인을 지원할 수 있다
- REQ-009: 시스템은 로그인 실패 시 재시도 제한을 적용할 수 있다

### UNWANTED (제약사항)
시스템이 절대 하면 안 되는 것:

- REQ-010: 시스템은 비밀번호를 평문으로 저장하면 안 된다
- REQ-011: 시스템은 토큰을 클라이언트에 다시 전송하면 안 된다
```

### Step 3: 구현 계획 생성 (자동)

Alfred가 생성하는 `.moai/specs/SPEC-AUTH-001/plan.md`:

```markdown
# SPEC-AUTH-001 구현 계획

## 개요
5단계의 TDD 사이클로 구현

## 단계별 계획

### Phase 1: 데이터 모델 (테스트 작성)
- [ ] User 모델 정의
- [ ] LoginAttempt 모델 정의
- [ ] 테스트: 사용자 생성 및 조회

### Phase 2: 비밀번호 암호화 (구현)
- [ ] Bcrypt 라이브러리 통합
- [ ] 비밀번호 해싱 함수 구현
- [ ] 비밀번호 검증 함수 구현

### Phase 3: JWT 토큰 (TDD)
- [ ] JWT 토큰 생성 함수
- [ ] 토큰 검증 함수
- [ ] 토큰 만료 처리

### Phase 4: 로그인 엔드포인트 (TDD)
- [ ] POST /auth/login 엔드포인트
- [ ] 이메일 검증 로직
- [ ] 비밀번호 검증 로직
- [ ] 토큰 발급 로직

### Phase 5: 로그아웃 및 세션 (TDD)
- [ ] POST /auth/logout 엔드포인트
- [ ] 토큰 무효화 로직
- [ ] 세션 종료 처리

## 의존성
- bcrypt >= 4.0.0
- PyJWT >= 2.6.0
- sqlalchemy >= 2.0.0

## 소요 시간
- 예상 개발 시간: 4-6시간
- 테스트 작성: 2시간
- 리뷰 및 수정: 1시간
```

### Step 4: 수용 기준 정의 (자동)

Alfred가 생성하는 `.moai/specs/SPEC-AUTH-001/acceptance.md`:

```markdown
# SPEC-AUTH-001 수용 기준

## 기능 수용 기준 (Acceptance Criteria)

### AC-001: 정상 로그인
**Given** 유효한 사용자가 존재하고
**When** 올바른 이메일과 비밀번호로 로그인하면
**Then** JWT 토큰을 받고 (status: 200)
**And** 토큰의 유효기간은 24시간이고
**And** 로그인 기록이 저장된다

### AC-002: 잘못된 비밀번호
**Given** 사용자가 존재하고
**When** 올바른 이메일이지만 잘못된 비밀번호로 로그인하면
**Then** 에러 응답을 받고 (status: 401)
**And** 에러 메시지는 "Invalid credentials"이고
**And** 로그인 시도가 기록된다

### AC-003: 존재하지 않는 사용자
**Given** 사용자가 존재하지 않고
**When** 해당 이메일로 로그인 시도하면
**Then** 에러 응답을 받고 (status: 404)
**And** 에러 메시지는 "User not found"이다

### AC-004: 토큰 검증
**Given** 유효한 토큰을 가지고 있고
**When** 보호된 리소스에 접근하면
**Then** 리소스를 조회할 수 있고 (status: 200)
**And** 사용자 정보가 반환된다

### AC-005: 만료된 토큰
**Given** 24시간이 지난 토큰을 가지고 있고
**When** 보호된 리소스에 접근하면
**Then** 에러 응답을 받고 (status: 401)
**And** 에러 메시지는 "Token expired"이다

## 테스트 케이스

### 긍정적 테스트 (Happy Path)
- ✅ test_login_with_valid_credentials
- ✅ test_token_contains_user_id
- ✅ test_token_has_24h_expiration

### 부정적 테스트 (Error Cases)
- ✅ test_login_with_wrong_password
- ✅ test_login_with_nonexistent_user
- ✅ test_login_with_invalid_email_format
- ✅ test_access_protected_resource_with_expired_token
- ✅ test_access_protected_resource_without_token

## 품질 기준

| 항목 | 기준 | 검증 |
|------|------|------|
| 테스트 커버리지 | ≥ 85% | pytest --cov |
| 코드 스타일 | PEP 8 준수 | ruff check |
| 타입 안전성 | 100% 타입 힌팅 | mypy --strict |
| 보안 | 0개 이슈 | bandit |
```

### Step 5: TAG 생성 (자동)

Alfred가 생성하는 TAG 마커:

```
SPEC-AUTH-001
  ├─ spec.md (요구사항 정의)
  ├─ plan.md (구현 계획)
  └─ acceptance.md (수용 기준)
```

이후 `/alfred:2-run SPEC-AUTH-001`에서 사용할 수 있습니다.

---

## EARS 포맷 이해하기

### 5가지 요구사항 유형

#### 1️⃣ UBIQUITOUS (보편적)
시스템이 **항상** 만족해야 하는 요구사항

```markdown
- 시스템은 모든 입력을 검증해야 한다
- 시스템은 모든 에러를 로깅해야 한다
```

**사용 시기**: 모든 상황에 적용되는 규칙

#### 2️⃣ EVENT-DRIVEN (이벤트 기반)
특정 **이벤트 발생 시** 수행할 요구사항

```markdown
- WHEN 사용자가 로그인하면
  - 시스템은 비밀번호를 검증해야 한다
  - 시스템은 토큰을 발급해야 한다
```

**사용 시기**: 사용자 액션, 시스템 이벤트 등

#### 3️⃣ STATE-DRIVEN (상태 기반)
특정 **상태에서** 유지해야 할 요구사항

```markdown
- WHILE 로그인 상태이면
  - 시스템은 토큰을 검증해야 한다
- WHILE 로그아웃 상태이면
  - 시스템은 접근을 거부해야 한다
```

**사용 시기**: 지속적인 상태 조건

#### 4️⃣ OPTIONAL (선택사항)
나중에 구현할 수 있는 부가 기능

```markdown
- 시스템은 다중 로그인을 지원할 수 있다
- 시스템은 로그인 실패 시 재시도 제한을 할 수 있다
```

**사용 시기**: MVP에 필수적이지 않은 기능

#### 5️⃣ UNWANTED (제약사항)
시스템이 **절대로** 하면 안 되는 것

```markdown
- 시스템은 비밀번호를 평문으로 저장하면 안 된다
- 시스템은 토큰을 클라이언트에 다시 전송하면 안 된다
```

**사용 시기**: 보안, 성능, 규정 제약

---

## SPEC 작성 팁

### ✅ Good SPEC

```markdown
### EVENT-DRIVEN
- WHEN 사용자가 주문을 제출하면
  - 시스템은 재고를 확인해야 한다
  - 시스템은 가격을 계산해야 한다
  - 시스템은 주문을 저장해야 한다
```

명확한 조건, 순차적 작업, 구체적 동작

### ❌ Bad SPEC

```markdown
- 시스템은 주문을 처리해야 한다
```

모호함, 이행 가능 여부 불명확, 테스트 어려움

---

## SPEC 검증

SPEC 작성 후 체크리스트:

```
□ 모든 요구사항이 명확한가?
□ 각 요구사항이 테스트 가능한가?
□ 5가지 유형(EARS)을 모두 사용했는가?
□ 의존성이 명시되어 있는가?
□ 수용 기준이 정의되어 있는가?
□ 모호한 표현(예: "빠르게", "쉽게")이 없는가?
```

---

## 자주 묻는 질문

### Q: SPEC을 작성하는 데 시간이 오래 걸리나요?

**A**: 처음에는 5-10분, 경험이 쌓이면 2-3분입니다. 명확한 SPEC은 구현 시간을 50% 이상 단축합니다.

### Q: SPEC 없이 바로 구현할 수 있나요?

**A**: 기술적으로 가능하지만 권장하지 않습니다. SPEC이 없으면:
- 요구사항이 불명확해져 재작업 발생
- 테스트 작성이 어려워짐
- 문서화가 누락됨

### Q: SPEC을 변경하려면?

**A**: 언제든 변경 가능합니다. 변경 후 `/alfred:2-run` 실행 시 새로운 요구사항으로 구현됩니다.

---

## 다음 단계

SPEC 작성 완료 후:

1. **[/alfred:2-run 실행](/ko/cli/alfred-2-run)** - RED → GREEN → REFACTOR TDD 사이클
2. **[문서 검토](/ko/getting-started/first-project)** - SPEC 문서 검토 및 수정
3. **[팀과 공유](/ko/workflow/overview)** - SPEC을 팀에 공유하고 피드백 수집

---

## 참고 자료

- [EARS 가이드](/ko/concepts/ears-guide) - EARS 포맷 상세 설명
- [SPEC-First TDD](/ko/concepts/spec-first-tdd) - SPEC-First 개념 이해
- [예제 SPEC](https://github.com/modu-ai/moai-adk/tree/main/.moai/specs) - 실제 SPEC 예제
