---
title: Hooks ì‹œìŠ¤í…œ (ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™í™”)
description: MoAI-ADK Hooks - Claude Code ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™í™” ë° ì§„ì‹œì„± ì‹œìŠ¤í…œ
---

# Hooks ì‹œìŠ¤í…œ: ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™í™”

HooksëŠ” MoAI-ADKì˜ **ìë™í™” ë° ì§„ì‹œì„±(Real-time Responsiveness)** ê³„ì¸µì…ë‹ˆë‹¤. Claude Codeì˜ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ê°œë°œ ì›Œí¬í”Œë¡œìš°ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

## ê°œìš”

**ëª©ì **: Claude Code ì´ë²¤íŠ¸ ê°ì§€ â†’ ìë™ ì‹¤í–‰ â†’ ì§„ì‹œ ì»¨í…ìŠ¤íŠ¸ ì œê³µ

**í•µì‹¬ íŠ¹ì§•**:
- **ì´ë²¤íŠ¸ ê¸°ë°˜**: SessionStart, UserPromptSubmit, PreToolUse ë“± 8ê°€ì§€ ì´ë²¤íŠ¸ ì§€ì›
- **ì´ˆê³ ì† ì‘ë‹µ**: 5ì´ˆ ê¸€ë¡œë²Œ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€
- **ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜**: ì¼ë¶€ ì‘ì—… ì‹¤íŒ¨ ì‹œì—ë„ ê¸°ë³¸ ê¸°ëŠ¥ì€ ê³„ì† ì‘ë™
- **ì§„ì‹œ ì»¨í…ìŠ¤íŠ¸**: ì‚¬ìš©ì ì…ë ¥ ë¶„ì„ â†’ í•„ìš”í•œ ë¬¸ì„œ ìë™ ë¡œë“œ (JIT Retrieval)
- **ê²€ì¦ í¬ì¸íŠ¸**: ìœ„í—˜ ì‘ì—… ê°ì§€ â†’ ìë™ ì²´í¬í¬ì¸íŠ¸ ìƒì„±

---

## ì•„í‚¤í…ì²˜: 3ê³„ì¸µ ì„¤ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ Router (Alfred Hooks)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - CLI ì¸ìˆ˜ íŒŒì‹± (event_name)                         â”‚
â”‚ - JSON I/O (stdin/stdout)                            â”‚
â”‚ - ì´ë²¤íŠ¸ë³„ í•¸ë“¤ëŸ¬ ë¼ìš°íŒ…                              â”‚
â”‚ - 5ì´ˆ ê¸€ë¡œë²Œ íƒ€ì„ì•„ì›ƒ ê´€ë¦¬                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ Handlers (handlers/)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - session.py: SessionStart, SessionEnd               â”‚
â”‚ - user.py: UserPromptSubmit                          â”‚
â”‚ - tool.py: PreToolUse, PostToolUse                   â”‚
â”‚ - notification.py: Notification, Stop, SubagentStop  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ Core Logic (core/)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - project.py: ì–¸ì–´ ê°ì§€, Git ì •ë³´, SPEC ì§„í–‰ë¥       â”‚
â”‚ - context.py: JIT ë¬¸ì„œ ë¡œë“œ (Just-In-Time)           â”‚
â”‚ - checkpoint.py: ì´ë²¤íŠ¸ ê¸°ë°˜ ì²´í¬í¬ì¸íŠ¸              â”‚
â”‚ - tags.py: TAG ê²€ìƒ‰/ê²€ì¦, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ ìºì‹œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8ê°€ì§€ ì´ë²¤íŠ¸ íƒ€ì…

### 1ï¸âƒ£ SessionStart

**ë°œìƒ**: Claude Code ì„¸ì…˜ ì‹œì‘ ì‹œ
**ëª©ì **: í”„ë¡œì íŠ¸ ìƒíƒœ ìš”ì•½ í‘œì‹œ
**ì¶œë ¥**: ì‹œìŠ¤í…œ ë©”ì‹œì§€ (í”„ë¡œì íŠ¸ ì •ë³´ ìš”ì•½)

**í‘œì‹œë˜ëŠ” ì •ë³´**:
```
ğŸš€ MoAI-ADK Session Started
   Language: python
   Branch: feature/SPEC-AUTH-001 (a1b2c3d)
   Changes: 3 files modified
   SPEC Progress: 2/5 (40%)
   Checkpoints: 5 available
```

**ë‚´ë¶€ ë¡œì§**:
```python
# ì¤‘ìš”ë„ë³„ ì²˜ë¦¬
1. CRITICAL: detect_language(cwd) - ë°˜ë“œì‹œ ì„±ê³µí•´ì•¼ í•¨
2. OPTIONAL: get_git_info(cwd) - ì‹¤íŒ¨ ì‹œ ìŠ¤í‚µ
3. OPTIONAL: count_specs(cwd) - ì‹¤íŒ¨ ì‹œ ìŠ¤í‚µ
4. OPTIONAL: list_checkpoints(cwd) - ì‹¤íŒ¨ ì‹œ ìŠ¤í‚µ

# ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜ (Graceful Degradation)
- ëª¨ë“  OPTIONAL ì‘ì—…ì€ try-exceptë¡œ ê°ì‹¸ì§
- ì¼ë¶€ ì‹¤íŒ¨í•´ë„ CRITICAL ì •ë³´ëŠ” ë°˜ë“œì‹œ í‘œì‹œ
- ìµœì†Œ 1ê°œ ì´ìƒì˜ ì •ë³´ëŠ” í•­ìƒ í‘œì‹œ
```

**í™œìš© ì˜ˆì‹œ**: ìƒˆ ì„¸ì…˜ì„ ì‹œì‘í•  ë•Œ í˜„ì¬ í”„ë¡œì íŠ¸ ìƒíƒœë¥¼ í•œëˆˆì— íŒŒì•…

---

### 2ï¸âƒ£ UserPromptSubmit

**ë°œìƒ**: ì‚¬ìš©ìê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í–ˆì„ ë•Œ
**ëª©ì **: ì‚¬ìš©ì ì…ë ¥ ë¶„ì„ â†’ í•„ìš”í•œ ë¬¸ì„œ ìë™ ë¡œë“œ
**ì¶œë ¥**: ì»¨í…ìŠ¤íŠ¸ íŒŒì¼ ëª©ë¡ + ë¡œë“œ ë©”ì‹œì§€

**ì˜ˆì‹œ ì›Œí¬í”Œë¡œìš°**:
```python
ì‚¬ìš©ì ì…ë ¥: "tag ê²€ì¦í•˜ê³  ì‹¶ì–´"
             â–¼
Hook ë¶„ì„ (get_jit_context):
  - "tag" í‚¤ì›Œë“œ ê°ì§€
  - "ê²€ì¦" ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
             â–¼
ìë™ ë¡œë“œ:
  - .moai/specs/SPEC-*/spec.md
  - .moai/docs/tag-system-guide.md
  - .claude/skills/moai-foundation-tags/SKILL.md
             â–¼
ì‚¬ìš©ì: "ğŸ“ Loaded 3 context file(s)"
```

**JIT Retrieval ì•Œê³ ë¦¬ì¦˜**:
```
1. ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ë¶„ì„ (í‚¤ì›Œë“œ ì¶”ì¶œ)
2. í‚¤ì›Œë“œë³„ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
3. ì¤‘ë³µ ì œê±° (ê°™ì€ íŒŒì¼ ì¤‘ë³µ ë¡œë“œ ë°©ì§€)
4. ìš°ì„ ìˆœìœ„ ì •ë ¬ (ê°€ì¥ ê´€ë ¨ ë†’ì€ ë¬¸ì„œë¶€í„°)
5. íŒŒì¼ ëª©ë¡ ë°˜í™˜

ì§€ì›í•˜ëŠ” í‚¤ì›Œë“œ:
- "spec" â†’ .moai/specs/ ë¬¸ì„œ
- "test" / "test" â†’ tests/ ë””ë ‰í† ë¦¬
- "tag" / "ì¶”ì " â†’ TAG ê²€ì¦ ë¬¸ì„œ
- "hook" â†’ Hooks ì„¤ì • ë¬¸ì„œ
- "config" / "ì„¤ì •" â†’ .moai/config.json ë¬¸ì„œ
```

**ë¶€ê°€ ê¸°ëŠ¥: ëª…ë ¹ì–´ ë¡œê¹…**:
```python
# Alfred ëª…ë ¹ì–´ ì‹¤í–‰ ê¸°ë¡ ìë™ ì €ì¥
ì‚¬ìš©ì: "/alfred:2-run SPEC-AUTH-001"
        â–¼
Hook: .moai/logs/command-invocations.logì— ê¸°ë¡
        2024-03-15T10:23:45.123456 | /alfred:2-run SPEC-AUTH-001
```

---

### 3ï¸âƒ£ SessionEnd

**ë°œìƒ**: Claude Code ì„¸ì…˜ ì¢…ë£Œ ì‹œ
**ëª©ì **: ì„¸ì…˜ ì •ë¦¬ ë° ìµœì¢… ìƒíƒœ ì €ì¥
**ì¶œë ¥**: ì„¸ì…˜ ì¢…ë£Œ ë©”ì‹œì§€ (í–¥í›„ í™•ì¥ ê°€ëŠ¥)

**í˜„ì¬ ê¸°ëŠ¥**: ìŠ¤í… (í–¥í›„ êµ¬í˜„ ì˜ˆì •)
**ë¯¸ë˜ ê¸°ëŠ¥**:
- ì„¸ì…˜ í†µê³„ ì €ì¥ (ì‹¤í–‰ ì‹œê°„, ëª…ë ¹ì–´ ìˆ˜, ìƒì„±ëœ íŒŒì¼ ìˆ˜)
- ë¯¸ì™„ë£Œ ì²´í¬í¬ì¸íŠ¸ ì •ë¦¬
- ë¸Œëœì¹˜ ì •ë³´ ìµœì¢… ì €ì¥

---

### 4ï¸âƒ£ PreToolUse

**ë°œìƒ**: ë„êµ¬(Tool) ì‚¬ìš© ì§ì „
**ëª©ì **: ìœ„í—˜ ì‘ì—… ê°ì§€ â†’ ìë™ ì²´í¬í¬ì¸íŠ¸ ìƒì„±
**ì¶œë ¥**: ì²´í¬í¬ì¸íŠ¸ ìƒì„± ë©”ì‹œì§€ ë˜ëŠ” ì‘ì—… ì°¨ë‹¨

**ìœ„í—˜ ì‘ì—… ê°ì§€**:
```python
ìœ„í—˜í•œ ì‘ì—… (ìë™ ì²´í¬í¬ì¸íŠ¸):
  1. git push / git force-push
  2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
  3. íŒŒì¼ ëŒ€ëŸ‰ ì‚­ì œ (rm -rf ë“±)
  4. í”„ë¡œë•ì…˜ í™˜ê²½ ë°°í¬
  5. ë³´ì•ˆ ë¯¼ê° íŒŒì¼ ìˆ˜ì • (.env, credentials.json)

ìë™ ì²´í¬í¬ì¸íŠ¸:
  .moai/checkpoints/checkpoint-20240315-102345.json
  {
    "timestamp": "2024-03-15T10:23:45.123456",
    "tool": "Bash",
    "command": "git push origin main",
    "risk_level": "HIGH",
    "files_involved": ["README.md", "src/auth.py"]
  }
```

**ì²´í¬í¬ì¸íŠ¸ í™œìš©**:
```bash
# ë‚˜ì¤‘ì— ì‹¤ìˆ˜ë¡œ ë˜ëŒë ¤ì•¼ í•  ê²½ìš°
$ moai restore checkpoint-20240315-102345

# ì²´í¬í¬ì¸íŠ¸ ëª©ë¡ í™•ì¸
$ moai list checkpoints
```

---

### 5ï¸âƒ£ PostToolUse

**ë°œìƒ**: ë„êµ¬ ì‚¬ìš© ì™„ë£Œ í›„
**ëª©ì **: ì‹¤í–‰ ê²°ê³¼ ê²€ì¦ ë° ê¸°ë¡
**ì¶œë ¥**: ê²€ì¦ ê²°ê³¼ ë©”ì‹œì§€

**ì˜ˆì‹œ**:
```
ì‚¬ìš©ì: pytest tests/ ì‹¤í–‰
        â–¼
PostToolUse:
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì‹± (ì„±ê³µ/ì‹¤íŒ¨)
  - ì»¤ë²„ë¦¬ì§€ ë©”íŠ¸ë¦­ ì¶”ì¶œ
  - ê²°ê³¼ ê¸°ë¡ (.moai/logs/test-runs.log)
  - 85% ë¯¸ë§Œ ì»¤ë²„ë¦¬ì§€ ê²½ê³ 
```

---

### 6ï¸âƒ£ Notification

**ë°œìƒ**: Claude Codeê°€ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ì „ì†¡í•  ë•Œ
**ëª©ì **: ì•Œë¦¼ ì²˜ë¦¬ ë° í•„ìš” ì‹œ ì¶”ê°€ ì‘ì—… ì‹¤í–‰
**ì¶œë ¥**: ì•Œë¦¼ ì²˜ë¦¬ ê²°ê³¼

**ì˜ˆì‹œ ì•Œë¦¼**:
```
Claude Code: "Do you want to approve this operation?"
             â–¼
Hook: ìœ„í—˜ë„ í‰ê°€
      - ë‚®ìŒ: ìë™ ìŠ¹ì¸
      - ë†’ìŒ: ì‚¬ìš©ìì—ê²Œ ë¬¼ì–´ë³´ê¸°
      - ë§¤ìš° ë†’ìŒ: ìë™ ê±°ë¶€
```

---

### 7ï¸âƒ£ Stop

**ë°œìƒ**: ì‚¬ìš©ìê°€ ì‹¤í–‰ì„ ì¤‘ë‹¨í–ˆì„ ë•Œ (Ctrl+C, ì¤‘ì§€ ë²„íŠ¼)
**ëª©ì **: ìš°ì•„í•œ ì¢…ë£Œ ë° ë³µêµ¬ ì •ë³´ ì €ì¥
**ì¶œë ¥**: ì¢…ë£Œ ë©”ì‹œì§€

**í˜„ì¬ ê¸°ëŠ¥**: ìŠ¤í… (í–¥í›„ í™•ì¥)
**ë¯¸ë˜ ê¸°ëŠ¥**:
- ë¶€ë¶„ ì‘ì—… ìë™ ì €ì¥
- ë³µêµ¬ ì²´í¬í¬ì¸íŠ¸ ìƒì„±
- ì¤‘ë‹¨ ì‚¬ìœ  ê¸°ë¡
- ì™¸ë¶€ ì‹œìŠ¤í…œì— ì¤‘ë‹¨ ì•Œë¦¼

---

### 8ï¸âƒ£ SubagentStop

**ë°œìƒ**: Sub-agent ì‹¤í–‰ ì¢…ë£Œ ì‹œ
**ëª©ì **: Sub-agent ê²°ê³¼ ìˆ˜ì§‘ ë° ê²€ì¦
**ì¶œë ¥**: Sub-agent ì‹¤í–‰ ê²°ê³¼ ìš”ì•½

**ì˜ˆì‹œ**:
```
Sub-agent: tdd-implementer ì‹¤í–‰ ì¤‘...
           â–¼
ì‘ì—… ì™„ë£Œ:
  - RED ë‹¨ê³„: 3ê°œ í…ŒìŠ¤íŠ¸ ì‘ì„±
  - GREEN ë‹¨ê³„: êµ¬í˜„ ì™„ë£Œ (ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼)
  - REFACTOR ë‹¨ê³„: ì½”ë“œ ì •ë¦¬ (ì»¤ë²„ë¦¬ì§€ 85%)
           â–¼
SubagentStop Hook:
  - ê²°ê³¼ ê²€ì¦ (ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼?)
  - í’ˆì§ˆ ë©”íŠ¸ë¦­ ì¶”ì¶œ
  - ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ
```

---

## Hook ì‹¤í–‰ ëª¨ë¸

### JSON I/O í†µì‹ 

```bash
# Hook í˜¸ì¶œ (Claude Code ìë™)
$ echo '{"cwd": "/path/to/project", "userPrompt": "..."}' \
  | python alfred_hooks.py UserPromptSubmit

# ì¶œë ¥ (Hook ë°˜í™˜)
{
  "continue": true,
  "systemMessage": "ğŸ“ Loaded 3 context file(s)",
  "hookSpecificOutput": {
    "hookEventName": "UserPromptSubmit",
    "additionalContext": "ğŸ“ Context: .moai/specs/SPEC-AUTH-001/spec.md\n..."
  }
}
```

### ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (HookResult)

```python
@dataclass
class HookResult:
    # Claude Code í‘œì¤€ í•„ë“œ
    continue_execution: bool = True  # ì‹¤í–‰ ê³„ì† ì—¬ë¶€
    suppress_output: bool = False    # ì¶œë ¥ ìˆ¨ê¹€ ì—¬ë¶€
    decision: str | None = None      # "approve" ë˜ëŠ” "block"
    reason: str | None = None        # ê²°ì • ì‚¬ìœ 
    permission_decision: str | None = None  # "allow", "deny", "ask"

    # MoAI-ADK ì»¤ìŠ¤í…€ í•„ë“œ
    system_message: str | None = None       # ì‚¬ìš©ì ë©”ì‹œì§€
    context_files: list[str] = []          # ë¡œë“œí•  íŒŒì¼ ëª©ë¡
    suggestions: list[str] = []            # ì œì•ˆì‚¬í•­
    exit_code: int = 0                     # ì¢…ë£Œ ì½”ë“œ
```

### ì¢…ë£Œ ì½”ë“œ

```python
0: ì„±ê³µ (Hook ì •ìƒ ì‹¤í–‰)
1: ì˜¤ë¥˜ (íƒ€ì„ì•„ì›ƒ, JSON íŒŒì‹± ì˜¤ë¥˜, í•¸ë“¤ëŸ¬ ì˜ˆì™¸)
```

---

## ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜ (Graceful Degradation)

Hookì€ ì‹¤íŒ¨ì— ê²¬ë”œ ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì¼ë¶€ ì‘ì—…ì´ ì‹¤íŒ¨í•´ë„ ì „ì²´ ì‹œìŠ¤í…œì´ ì¤‘ë‹¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### SessionStartì˜ ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜

```python
def handle_session_start(payload):
    # âœ… CRITICAL: ë°˜ë“œì‹œ ì„±ê³µí•´ì•¼ í•¨
    language = detect_language(cwd)  # ì˜ˆì™¸ ì²˜ë¦¬ ì—†ìŒ

    # âš ï¸ OPTIONAL: ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
    git_info = {}
    try:
        git_info = get_git_info(cwd)
    except Exception:
        pass  # ë¬´ì‹œí•˜ê³  ê³„ì†

    # âš ï¸ OPTIONAL: ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
    specs = {"completed": 0, "total": 0}
    try:
        specs = count_specs(cwd)
    except Exception:
        pass  # ë¬´ì‹œí•˜ê³  ê³„ì†

    # ê²°ê³¼: ìµœì†Œí•œ ì–¸ì–´ ì •ë³´ëŠ” ë°˜ë“œì‹œ í‘œì‹œ
    # ì¶”ê°€ ì •ë³´ëŠ” ì„±ê³µí•œ ê²ƒë§Œ í‘œì‹œ
```

### íƒ€ì„ì•„ì›ƒ ë³´í˜¸

```python
# 5ì´ˆ ê¸€ë¡œë²Œ íƒ€ì„ì•„ì›ƒ
signal.signal(signal.SIGALRM, timeout_handler)
signal.alarm(5)

try:
    # Hook ì‹¤í–‰ (ìµœëŒ€ 5ì´ˆ)
    result = handler(data)
except HookTimeoutError:
    # íƒ€ì„ì•„ì›ƒ ë°œìƒ â†’ ìµœì†Œí•œì˜ ìœ íš¨í•œ ì‘ë‹µ ë°˜í™˜
    return {"continue": True, "systemMessage": "âš ï¸ Hook timeout"}
```

---

## JIT Context Retrieval (ì§„ì‹œ ì»¨í…ìŠ¤íŠ¸ ë¡œë“œ)

ì‚¬ìš©ìê°€ íŠ¹ì • ì‘ì—…ì„ ì–¸ê¸‰í•  ë•Œ ê´€ë ¨ ë¬¸ì„œë¥¼ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.

### ì§€ì›í•˜ëŠ” í‚¤ì›Œë“œ ë° ë¡œë“œ ëŒ€ìƒ

| í‚¤ì›Œë“œ | ë¡œë“œ íŒŒì¼ | ì„¤ëª… |
|--------|---------|------|
| "spec" | `.moai/specs/SPEC-*/spec.md` | ëª¨ë“  SPEC ë¬¸ì„œ |
| "tag" / "ì¶”ì " | `.moai/docs/tag-system.md` | TAG ì‹œìŠ¤í…œ ê°€ì´ë“œ |
| "hook" | `.claude/hooks/` | Hook ì„¤ì • íŒŒì¼ |
| "config" | `.moai/config.json` | í”„ë¡œì íŠ¸ ì„¤ì • |
| "test" | `tests/` | í…ŒìŠ¤íŠ¸ íŒŒì¼ |
| "auth" | `src/auth.py`, `tests/test_auth.py` | ì¸ì¦ ê´€ë ¨ íŒŒì¼ |

### JIT ì•Œê³ ë¦¬ì¦˜

```python
def get_jit_context(user_prompt, cwd):
    """ì‚¬ìš©ì ì…ë ¥ì—ì„œ í•„ìš”í•œ ë¬¸ì„œ ì¶”ì²œ"""

    # 1ë‹¨ê³„: í‚¤ì›Œë“œ ì¶”ì¶œ
    keywords = extract_keywords(user_prompt)
    # ì˜ˆ: "spec ì‘ì„±" â†’ ["spec", "ì‘ì„±"]

    # 2ë‹¨ê³„: í‚¤ì›Œë“œë³„ íŒŒì¼ ê²€ìƒ‰
    matching_files = []
    for keyword in keywords:
        matching_files.extend(search_files_by_keyword(keyword))

    # 3ë‹¨ê³„: ì¤‘ë³µ ì œê±°
    unique_files = remove_duplicates(matching_files)

    # 4ë‹¨ê³„: ìš°ì„ ìˆœìœ„ ì •ë ¬
    sorted_files = prioritize_files(unique_files)

    # 5ë‹¨ê³„: ìƒìœ„ 10ê°œ ë°˜í™˜
    return sorted_files[:10]
```

---

## Checkpoint ì‹œìŠ¤í…œ

ìœ„í—˜í•œ ì‘ì—… ì§ì „ì— ìë™ìœ¼ë¡œ ì²´í¬í¬ì¸íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ë³µêµ¬ ê°€ëŠ¥í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

### ìœ„í—˜ë„ ë ˆë²¨

```python
RISK_LEVEL_HIGH = [
    "git push",
    "git force-push",
    "git reset --hard",
    "rm -rf",  # íŒŒì¼ ëŒ€ëŸ‰ ì‚­ì œ
    "DROP TABLE",  # ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ
]

RISK_LEVEL_MEDIUM = [
    "git commit",  # ì»¤ë°‹ì€ ë˜ëŒë¦´ ìˆ˜ ìˆì§€ë§Œ ì£¼ì˜ í•„ìš”
    "npm publish",  # íŒ¨í‚¤ì§€ ë°°í¬
]

RISK_LEVEL_LOW = [
    "pytest",
    "ruff check",
    "mypy",  # ì•ˆì „í•œ ë„êµ¬ë“¤
]
```

### ì²´í¬í¬ì¸íŠ¸ ìƒì„± ì˜ˆì‹œ

```python
# PreToolUse Hookì—ì„œ ìë™ ìƒì„±
{
    "id": "cp-20240315-102345",
    "timestamp": "2024-03-15T10:23:45.123456",
    "event": "PreToolUse",
    "tool": "Bash",
    "command": "git push origin main",
    "risk_level": "HIGH",
    "files_involved": ["README.md", "src/auth.py", "tests/test_auth.py"],
    "git_status": {
        "branch": "feature/SPEC-AUTH-001",
        "commit_hash": "a1b2c3d",
        "changed_files": 3
    }
}
```

---

## ìµœì  ì‚¬ë¡€ (Best Practices)

### âœ… Hook ê°œë°œí•  ë•Œ

```python
# ì¢‹ì€ ì˜ˆ: íƒ€ì„ì•„ì›ƒ ì„¤ì • + ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜
def my_hook(payload):
    cwd = payload.get("cwd", ".")

    # CRITICAL ì‘ì—… (try-except ì—†ìŒ)
    language = detect_language(cwd)

    # OPTIONAL ì‘ì—… (try-except í¬í•¨)
    try:
        git_info = get_git_info(cwd)
    except Exception:
        git_info = {}  # ê¸°ë³¸ê°’ìœ¼ë¡œ ê³„ì†

    return HookResult(system_message="âœ… Ready")

# ë‚˜ìœ ì˜ˆ: íƒ€ì„ì•„ì›ƒ ì—†ì´ ë¬´í•œ ëŒ€ê¸° ê°€ëŠ¥
def bad_hook(payload):
    while True:
        result = expensive_operation()  # 5ì´ˆ ì´ˆê³¼ ê°€ëŠ¥
    # âŒ Claude Codeê°€ ì‘ë‹µ ë¶ˆê°€ëŠ¥í•´ì§
```

### âœ… Hook í˜¸ì¶œ ì„±ëŠ¥

```python
# ì¢‹ì€ ì˜ˆ: ë¹ ë¥¸ ì‘ë‹µ (< 1ì´ˆ)
def fast_hook(payload):
    return HookResult(system_message="Quick response")

# ë‚˜ìœ ì˜ˆ: ëŠë¦° ì‘ë‹µ (> 5ì´ˆ)
def slow_hook(payload):
    for i in range(100):
        expensive_computation()  # 5ì´ˆ ì´ˆê³¼
    # âŒ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì‹¤íŒ¨
```

---

## ë¬¸ì œ í•´ê²° (Troubleshooting)

### â“ Hookì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í™•ì¸í•  ì‚¬í•­**:
1. Hook íŒŒì¼ì´ `.claude/hooks/alfred/`ì— ìˆëŠ”ê°€?
2. Hook íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì´ ìˆëŠ”ê°€? (`chmod +x`)
3. íŒŒì´ì¬ ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ê°€? (`#!/usr/bin/env python3`)

```bash
# í™•ì¸
ls -la .claude/hooks/alfred/session_start__show_project_info.py
# ì‹¤í–‰ ê¶Œí•œ ì¶”ê°€
chmod +x .claude/hooks/alfred/session_start__show_project_info.py
```

---

### â“ "Hook timeout after 5 seconds" ì˜¤ë¥˜

**ì›ì¸**: Hookì´ 5ì´ˆ ì´ìƒ ì‹¤í–‰ë¨

**í•´ê²°**:
```python
# âŒ ëŠë¦° ì‘ì—… (Git ëª…ë ¹ì–´ ëŒ€ëŸ‰ ì‹¤í–‰, íŒŒì¼ I/O ëŒ€ëŸ‰ ì‘ì—…)
def slow_handler(payload):
    for i in range(1000):
        subprocess.run(["git", "log"])  # ë„ˆë¬´ ë§ìŒ

# âœ… ê°œì„ : í•„ìš”í•œ ê²ƒë§Œ ì‹¤í–‰ + ìºì‹±
cache = {}
def fast_handler(payload):
    if "git_info" in cache:
        return cache["git_info"]
    result = subprocess.run(["git", "log", "-1"], timeout=2)
    cache["git_info"] = result
    return result
```

---

### â“ JIT Contextê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ

**ì›ì¸**: í‚¤ì›Œë“œê°€ ë§¤ì¹­ë˜ì§€ ì•ŠìŒ

**í™•ì¸**:
```python
# ì‚¬ìš©ì ì…ë ¥ì—ì„œ ì¸ì‹ë˜ëŠ” í‚¤ì›Œë“œ í™•ì¸
supported_keywords = [
    "spec", "test", "tag", "hook", "config",
    "auth", "ì¶”ì ", "ê²€ì¦", "í…ŒìŠ¤íŠ¸", "ëª…ì„¸"
]

# ì‚¬ìš©ì ì…ë ¥ ì˜ˆì‹œ
user_input = "tag ê²€ì¦í•´ì¤„ë˜?"
# ì¸ì‹ë˜ëŠ” í‚¤ì›Œë“œ: ["tag", "ê²€ì¦"]
# ë¡œë“œë˜ëŠ” íŒŒì¼: .moai/docs/tag-system.md, TAG ê²€ì¦ ê°€ì´ë“œ
```

---

### â“ ì²´í¬í¬ì¸íŠ¸ ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•ŠìŒ

**í™•ì¸**:
```bash
# ì²´í¬í¬ì¸íŠ¸ ë””ë ‰í† ë¦¬ í™•ì¸
ls -la .moai/checkpoints/

# ìµœê·¼ ì²´í¬í¬ì¸íŠ¸ í™•ì¸
cat .moai/checkpoints/checkpoint-*.json | jq . | head -20
```

---

## Hook ì„¤ì • (Configuration)

### `.claude/hooks.json` ì„¤ì • íŒŒì¼

```json
{
  "hooks": {
    "enabled": true,
    "timeout": 5,
    "events": {
      "SessionStart": {
        "enabled": true,
        "critical_only": false
      },
      "UserPromptSubmit": {
        "enabled": true,
        "max_files": 10,
        "timeout": 3
      },
      "PreToolUse": {
        "enabled": true,
        "checkpoint_on_risk": true,
        "risk_level_threshold": "MEDIUM"
      }
    }
  }
}
```

---

## ë‹¤ìŒ ë‹¨ê³„

Hook ì‹œìŠ¤í…œì„ ì´í•´í–ˆë‹¤ë©´:

1. **Hook ì»¤ìŠ¤í„°ë§ˆì´ì§•**: í”„ë¡œì íŠ¸ì— ë§ê²Œ Hook ìˆ˜ì •
2. **JIT Context í™•ì¥**: í”„ë¡œì íŠ¸ íŠ¹í™” í‚¤ì›Œë“œ ì¶”ê°€
3. **Checkpoint í™œìš©**: ìœ„í—˜í•œ ì‘ì—… ìë™ ë³´í˜¸
4. **ëª¨ë‹ˆí„°ë§**: `.moai/logs/` í™•ì¸ìœ¼ë¡œ Hook ì‹¤í–‰ ê¸°ë¡ ì¶”ì 

---

## ì°¸ê³  ìë£Œ

- [TRUST 5 ì›ì¹™](/ko/introduction/overview) - Hookìœ¼ë¡œ ê²€ì¦í•˜ëŠ” í’ˆì§ˆ ê¸°ì¤€
- [TAG ì‹œìŠ¤í…œ](/ko/concepts/tag-system) - Hookê³¼ TAGì˜ í†µí•©
- [/alfred:0-project](/ko/cli/alfred-0-project) - Hook ì„¤ì •ì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë°©ë²•
- [Claude Code Hooks ê³µì‹ ë¬¸ì„œ](https://docs.claude.com/en/docs/claude-code/hooks) - Hook í‘œì¤€ ìŠ¤í‚¤ë§ˆ
