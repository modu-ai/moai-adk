---
title: SPEC-First TDD - ÏöîÍµ¨ÏÇ¨Ìï≠ Ï£ºÎèÑ Í∞úÎ∞ú
description: MoAI-ADKÏùò SPEC-First TDD Î∞©ÏãùÏúºÎ°ú ÏöîÍµ¨ÏÇ¨Ìï≠Î∂ÄÌÑ∞ Íµ¨ÌòÑÍπåÏßÄ
---

# SPEC-First TDD - ÏöîÍµ¨ÏÇ¨Ìï≠ Ï£ºÎèÑ Í∞úÎ∞ú

## Í∞úÏöî

**SPEC-First TDD**Îäî MoAI-ADKÏùò Í∞úÎ∞ú Î∞©Î≤ïÎ°†ÏûÖÎãàÎã§. ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÍ∏∞ Ï†ÑÏóê Î™ÖÌôïÌïú ÏöîÍµ¨ÏÇ¨Ìï≠(SPEC)ÏùÑ Ï†ïÏùòÌïòÍ≥†, Í∑∏ Îã§Ïùå RED ‚Üí GREEN ‚Üí REFACTOR TDD ÏÇ¨Ïù¥ÌÅ¥ÏùÑ Îî∞Î¶ÖÎãàÎã§.

### Í∏∞Ï°¥ TDD vs SPEC-First TDD

| Ìï≠Î™© | Í∏∞Ï°¥ TDD | SPEC-First TDD |
|------|---------|----------------|
| **ÏãúÏûëÏ†ê** | "Ïñ¥ÎñªÍ≤å ÌÖåÏä§Ìä∏Ìï†Íπå?" | "Î¨¥ÏóáÏùÑ ÎßåÎì§Ïñ¥Ïïº ÌïòÎÇò?" |
| **1Îã®Í≥Ñ** | ÌÖåÏä§Ìä∏ ÏûëÏÑ± (RED) | SPEC Ï†ïÏùò |
| **2Îã®Í≥Ñ** | Íµ¨ÌòÑ (GREEN) | ÌÖåÏä§Ìä∏ ÏûëÏÑ± (RED) |
| **3Îã®Í≥Ñ** | Î¶¨Ìå©ÌÜ†ÎßÅ (REFACTOR) | Íµ¨ÌòÑ (GREEN) |
| **4Îã®Í≥Ñ** | (ÎÅù) | Î¶¨Ìå©ÌÜ†ÎßÅ (REFACTOR) |
| **5Îã®Í≥Ñ** | (ÎÅù) | Î¨∏ÏÑúÌôî & ÎèôÍ∏∞Ìôî |
| **Ï∂îÏ†ÅÏÑ±** | ÏóÜÏùå | TAG Í∏∞Î∞ò Ï∂îÏ†Å |

---

## SPEC-First TDDÏùò 4Îã®Í≥Ñ ÏõåÌÅ¨ÌîåÎ°úÏö∞

### Stage 1: SPEC Ï†ïÏùò (`/alfred:1-plan`)

**Î™©Ìëú**: ÏöîÍµ¨ÏÇ¨Ìï≠ÏùÑ Î™ÖÌôïÌûà Ï†ïÏùòÌïòÍ≥† TAG ÏÉùÏÑ±

#### Step 1.1: Í∏∞Îä• ÏÑ§Î™Ö ÏàòÏßë

ÏÇ¨Ïö©ÏûêÏôÄ Ìï®Íªò Îã§ÏùåÏùÑ Ï†ïÏùòÌï©ÎãàÎã§:

```markdown
Í∏∞Îä•Î™Ö: ÏÇ¨Ïö©Ïûê Ïù∏Ï¶ù
Î™©Ìëú: ÏÇ¨Ïö©ÏûêÍ∞Ä Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú ÏïàÏ†ÑÌïòÍ≤å Î°úÍ∑∏Ïù∏

Ï£ºÏöî ÏöîÍµ¨ÏÇ¨Ìï≠:
- Ïù¥Î©îÏùº ÌòïÏãù Í≤ÄÏ¶ù
- ÎπÑÎ∞ÄÎ≤àÌò∏ Ìï¥Ïã± (bcrypt)
- JWT ÌÜ†ÌÅ∞ Î∞úÍ∏â (24ÏãúÍ∞Ñ Ïú†Ìö®)
- Î°úÍ∑∏Ïù∏ ÏãúÎèÑ Í∏∞Î°ù

ÏÑ±Í≥µ Í∏∞Ï§Ä:
- Ïò¨Î∞îÎ•∏ ÏûêÍ≤©Ï¶ùÎ™Ö: ÌÜ†ÌÅ∞ Î∞òÌôò (200 OK)
- ÏûòÎ™ªÎêú ÎπÑÎ∞ÄÎ≤àÌò∏: 401 Unauthorized
- Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏÇ¨Ïö©Ïûê: 404 Not Found

ÏóêÎü¨ Ï≤òÎ¶¨:
- Ïù¥Î©îÏùº ÌòïÏãù Ïò§Î•ò: 400 Bad Request
- ÏÑúÎ≤Ñ Ïò§Î•ò: 500 Internal Server Error
```

#### Step 1.2: EARS ÌòïÏãù ÏöîÍµ¨ÏÇ¨Ìï≠ ÏûëÏÑ±

SPEC Î¨∏ÏÑúÎ•º ÏûëÏÑ±Ìï©ÎãàÎã§ (`.moai/specs/SPEC-AUTH-001/spec.md`):

```markdown
# SPEC-AUTH-001: ÏÇ¨Ïö©Ïûê Ïù∏Ï¶ù

@SPEC:SAMPLE-001

## Í∞úÏöî
ÏÇ¨Ïö©ÏûêÍ∞Ä Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ïù¥Ïö©ÌïòÏó¨ ÏïàÏ†ÑÌïòÍ≤å Î°úÍ∑∏Ïù∏ÌïòÎäî Í∏∞Îä•

## ÏöîÍµ¨ÏÇ¨Ìï≠ (EARS ÌòïÏãù)

### UBIQUITOUS
- ÏãúÏä§ÌÖúÏùÄ Î™®Îì† ÏÇ¨Ïö©Ïûê ÏûÖÎ†•ÏùÑ Í≤ÄÏ¶ùÌï¥Ïïº ÌïúÎã§
- ÏãúÏä§ÌÖúÏùÄ Î™®Îì† ÎØºÍ∞êÌïú Ï†ïÎ≥¥Î•º ÏïîÌò∏ÌôîÌïòÏó¨ Ï†ÄÏû•Ìï¥Ïïº ÌïúÎã§
- ÏãúÏä§ÌÖúÏùÄ Î™®Îì† Î°úÍ∑∏Ïù∏ ÏãúÎèÑÎ•º Í∏∞Î°ùÌï¥Ïïº ÌïúÎã§

### EVENT-DRIVEN
- WHEN ÏÇ¨Ïö©ÏûêÍ∞Ä Î°úÍ∑∏Ïù∏ÏùÑ ÏãúÎèÑÌïòÎ©¥
  - ÏãúÏä§ÌÖúÏùÄ Ïù¥Î©îÏùº ÌòïÏãùÏùÑ Í≤ÄÏ¶ùÌï¥Ïïº ÌïúÎã§
  - ÏãúÏä§ÌÖúÏùÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Í≤ÄÏ¶ùÌï¥Ïïº ÌïúÎã§
  - ÏãúÏä§ÌÖúÏùÄ JWT ÌÜ†ÌÅ∞ÏùÑ Î∞úÍ∏âÌï¥Ïïº ÌïúÎã§

### STATE-DRIVEN
- WHILE Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÏù¥Î©¥
  - ÏãúÏä§ÌÖúÏùÄ ÌÜ†ÌÅ∞ÏùÑ Í≤ÄÏ¶ùÌï¥Ïïº ÌïúÎã§

### UNWANTED
- ÏãúÏä§ÌÖúÏùÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÌèâÎ¨∏ÏúºÎ°ú Ï†ÄÏû•ÌïòÎ©¥ Ïïà ÎêúÎã§
- ÏãúÏä§ÌÖúÏùÄ ÌÜ†ÌÅ∞ÏùÑ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Ïóê Îã§Ïãú Ï†ÑÏÜ°ÌïòÎ©¥ Ïïà ÎêúÎã§
```

#### Step 1.3: ÏàòÏö© Í∏∞Ï§Ä Ï†ïÏùò

`.moai/specs/SPEC-AUTH-001/acceptance.md`:

```markdown
# SPEC-AUTH-001 ÏàòÏö© Í∏∞Ï§Ä

### AC-001: Ï†ïÏÉÅ Î°úÍ∑∏Ïù∏
**Given** Ïú†Ìö®Ìïú ÏÇ¨Ïö©ÏûêÍ∞Ä Ï°¥Ïû¨ÌïòÍ≥†
**When** Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú Î°úÍ∑∏Ïù∏ÌïòÎ©¥
**Then** JWT ÌÜ†ÌÅ∞ÏùÑ Î∞õÍ≥† (status: 200)

### AC-002: ÏûòÎ™ªÎêú ÎπÑÎ∞ÄÎ≤àÌò∏
**Given** ÏÇ¨Ïö©ÏûêÍ∞Ä Ï°¥Ïû¨ÌïòÍ≥†
**When** Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùºÏù¥ÏßÄÎßå ÏûòÎ™ªÎêú ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú Î°úÍ∑∏Ïù∏ÌïòÎ©¥
**Then** ÏóêÎü¨ ÏùëÎãµÏùÑ Î∞õÍ≥† (status: 401)

### AC-003: Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏÇ¨Ïö©Ïûê
**Given** ÏÇ¨Ïö©ÏûêÍ∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÍ≥†
**When** Ìï¥Îãπ Ïù¥Î©îÏùºÎ°ú Î°úÍ∑∏Ïù∏ ÏãúÎèÑÌïòÎ©¥
**Then** ÏóêÎü¨ ÏùëÎãµÏùÑ Î∞õÍ≥† (status: 404)
```

#### Step 1.4: TAG ÏÉùÏÑ±

AlfredÍ∞Ä ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§:

```
SPEC-AUTH-001 ÏÉùÏÑ±Îê®
  ‚îî‚îÄ @SPEC:SAMPLE-001 ÎßàÏª§ Ï∂îÍ∞Ä
```

**Í≤∞Í≥º**: üìã SPEC Î¨∏ÏÑú ÏôÑÏÑ±, Í∞úÎ∞ú Î™©Ìëú Î™ÖÌôï

---

### Stage 2: ÌÖåÏä§Ìä∏ ÏûëÏÑ± (RED Phase)

**Î™©Ìëú**: ÏöîÍµ¨ÏÇ¨Ìï≠ÏùÑ Í≤ÄÏ¶ùÌïòÎäî **Ïã§Ìå®ÌïòÎäî ÌÖåÏä§Ìä∏** ÏûëÏÑ±

#### Step 2.1: ÌÖåÏä§Ìä∏ ÌååÏùº ÏÉùÏÑ±

`tests/test_auth.py`:

```python
# @TEST:SAMPLE-001
import pytest
from src.auth import AuthService, LoginResult


class TestLogin:
    """ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏ ÌÖåÏä§Ìä∏"""

    def test_login_with_valid_credentials(self):
        """AC-001: Ïú†Ìö®Ìïú ÏûêÍ≤©Ï¶ùÎ™ÖÏúºÎ°ú Î°úÍ∑∏Ïù∏"""
        # Given: Ïú†Ìö®Ìïú ÏÇ¨Ïö©ÏûêÍ∞Ä Ï°¥Ïû¨
        user_email = "user@example.com"
        user_password = "secure123"

        # When: Î°úÍ∑∏Ïù∏ ÏãúÎèÑ
        result = AuthService.login(email=user_email, password=user_password)

        # Then: ÌÜ†ÌÅ∞ Î∞òÌôò ÌôïÏù∏
        assert result.status == "authenticated"
        assert result.token is not None
        assert result.token_type == "Bearer"
        assert result.expires_in == 86400  # 24 hours

    def test_login_with_wrong_password(self):
        """AC-002: ÏûòÎ™ªÎêú ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú Î°úÍ∑∏Ïù∏ Ïã§Ìå®"""
        result = AuthService.login(email="user@example.com", password="wrong123")
        assert result.status == "error"
        assert result.error_code == "INVALID_CREDENTIALS"

    def test_login_with_nonexistent_user(self):
        """AC-003: Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏÇ¨Ïö©ÏûêÎ°ú Î°úÍ∑∏Ïù∏ Ïã§Ìå®"""
        result = AuthService.login(email="nonexistent@example.com", password="any123")
        assert result.status == "error"
        assert result.error_code == "USER_NOT_FOUND"
```

#### Step 2.2: ÌÖåÏä§Ìä∏ Ïã§Ìñâ (RED ÌôïÏù∏)

```bash
pytest tests/test_auth.py -v

# Í≤∞Í≥º:
FAILED tests/test_auth.py::TestLogin::test_login_with_valid_credentials
  ModuleNotFoundError: No module named 'src.auth'

FAILED tests/test_auth.py::TestLogin::test_login_with_wrong_password
FAILED tests/test_auth.py::TestLogin::test_login_with_nonexistent_user

============ 3 failed in 0.15s ============
```

**ÏÉÅÌÉú**: üî¥ RED - ÌÖåÏä§Ìä∏ Ïã§Ìå® (ÏòàÏÉÅÎêú ÏÉÅÌô©)

#### Step 2.3: Ïª§Î∞ã (RED)

```bash
git add tests/test_auth.py
git commit -m "test(RED): Add authentication tests

@TEST:SAMPLE-001
- test_login_with_valid_credentials
- test_login_with_wrong_password
- test_login_with_nonexistent_user
"
```

**Í≤∞Í≥º**: ‚úÖ RED Phase ÏôÑÎ£å, ÌÖåÏä§Ìä∏ ÌÉúÍ∑∏ ÏÉùÏÑ±

---

### Stage 3: Íµ¨ÌòÑ (GREEN Phase)

**Î™©Ìëú**: ÌÖåÏä§Ìä∏Î•º **ÌÜµÍ≥ºÌïòÎäî ÏµúÏÜåÌïúÏùò ÏΩîÎìú** ÏûëÏÑ±

#### Step 3.1: ÏµúÏÜå Íµ¨ÌòÑ

`src/auth.py`:

```python
# @CODE:SAMPLE-001
from dataclasses import dataclass
from typing import Optional
import bcrypt
from datetime import datetime, timedelta
import jwt


@dataclass
class LoginResult:
    """Î°úÍ∑∏Ïù∏ Í≤∞Í≥º"""
    status: str  # "authenticated" or "error"
    token: Optional[str] = None
    token_type: str = "Bearer"
    expires_in: int = 86400  # 24 hours
    error_code: Optional[str] = None


# ÏûÑÏãú ÏÇ¨Ïö©Ïûê DB (ÌîÑÎ°úÌÜ†ÌÉÄÏûÖ)
USERS_DB = {
    "user@example.com": bcrypt.hashpw(b"secure123", bcrypt.gensalt()).decode()
}


class AuthService:
    """Ïù∏Ï¶ù ÏÑúÎπÑÏä§"""

    @staticmethod
    def login(email: str, password: str) -> LoginResult:
        """ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏"""

        # ÏÇ¨Ïö©Ïûê Ï°¥Ïû¨ ÌôïÏù∏
        if email not in USERS_DB:
            return LoginResult(
                status="error",
                error_code="USER_NOT_FOUND"
            )

        # ÎπÑÎ∞ÄÎ≤àÌò∏ Í≤ÄÏ¶ù
        hashed_password = USERS_DB[email]
        if not bcrypt.checkpw(password.encode(), hashed_password.encode()):
            return LoginResult(
                status="error",
                error_code="INVALID_CREDENTIALS"
            )

        # ÌÜ†ÌÅ∞ ÏÉùÏÑ±
        payload = {
            "email": email,
            "exp": datetime.utcnow() + timedelta(hours=24)
        }
        token = jwt.encode(payload, "secret-key", algorithm="HS256")

        return LoginResult(
            status="authenticated",
            token=token,
            expires_in=86400
        )
```

#### Step 3.2: ÌÖåÏä§Ìä∏ Ïã§Ìñâ (GREEN ÌôïÏù∏)

```bash
pytest tests/test_auth.py -v

# Í≤∞Í≥º:
PASSED tests/test_auth.py::TestLogin::test_login_with_valid_credentials
PASSED tests/test_auth.py::TestLogin::test_login_with_wrong_password
PASSED tests/test_auth.py::TestLogin::test_login_with_nonexistent_user

============ 3 passed in 0.12s ============
```

**ÏÉÅÌÉú**: üü¢ GREEN - Î™®Îì† ÌÖåÏä§Ìä∏ ÌÜµÍ≥º

#### Step 3.3: Ïª§Î∞ã (GREEN)

```bash
git add src/auth.py
git commit -m "feat(GREEN): Implement authentication features

@CODE:SAMPLE-001
- Login with email and password
- JWT token generation with 24-hour expiration
- Bcrypt password hashing
- User validation and error handling
"
```

**Í≤∞Í≥º**: ‚úÖ GREEN Phase ÏôÑÎ£å, ÏΩîÎìú ÌÉúÍ∑∏ ÏÉùÏÑ±

---

### Stage 4: Í∞úÏÑ† (REFACTOR Phase)

**Î™©Ìëú**: ÏΩîÎìú ÌíàÏßà Í∞úÏÑ†, Î≥¥Ïïà Í∞ïÌôî, ÌÖåÏä§Ìä∏ Ïª§Î≤ÑÎ¶¨ÏßÄ Ï¶ùÍ∞Ä

#### Step 4.1: Î≥¥Ïïà Î∞è Íµ¨Ï°∞ Í∞úÏÑ†

`src/auth.py` (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ):

```python
# @CODE:SAMPLE-001
from dataclasses import dataclass
from typing import Optional, Dict
import bcrypt
from datetime import datetime, timedelta
import jwt
import logging
import os


logger = logging.getLogger(__name__)

# ÌôòÍ≤Ω Î≥ÄÏàòÏóêÏÑú ÏÑ§Ï†ï ÏùΩÍ∏∞
SECRET_KEY = os.getenv("SECRET_KEY", "dev-secret-key")
TOKEN_EXPIRATION_HOURS = 24
BCRYPT_COST_FACTOR = 4


@dataclass
class LoginResult:
    """Î°úÍ∑∏Ïù∏ Í≤∞Í≥º

    Attributes:
        status: Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ("authenticated" or "error")
        token: JWT ÌÜ†ÌÅ∞ (ÏÑ±Í≥µ ÏãúÏóêÎßå Ìè¨Ìï®)
        token_type: ÌÜ†ÌÅ∞ ÌÉÄÏûÖ (Í∏∞Î≥∏Í∞í: "Bearer")
        expires_in: ÌÜ†ÌÅ∞ ÎßåÎ£åÏãúÍ∞Ñ (Ï¥à Îã®ÏúÑ)
        error_code: ÏóêÎü¨ ÏΩîÎìú (Ïã§Ìå® ÏãúÏóêÎßå Ìè¨Ìï®)
    """
    status: str
    token: Optional[str] = None
    token_type: str = "Bearer"
    expires_in: int = 86400
    error_code: Optional[str] = None


class UserRepository:
    """ÏÇ¨Ïö©Ïûê Ï†ÄÏû•ÏÜå (Îç∞Ïù¥ÌÑ∞ Ï†ëÍ∑º Í≥ÑÏ∏µ)"""

    @staticmethod
    def find_by_email(email: str) -> Optional[Dict]:
        """Ïù¥Î©îÏùºÎ°ú ÏÇ¨Ïö©Ïûê Ï°∞Ìöå"""
        # Ïã§Ï†ú DBÏóêÏÑú Ï°∞Ìöå
        return None

    @staticmethod
    def verify_password(stored_hash: str, password: str) -> bool:
        """ÎπÑÎ∞ÄÎ≤àÌò∏ Í≤ÄÏ¶ù"""
        try:
            return bcrypt.checkpw(
                password.encode('utf-8'),
                stored_hash.encode('utf-8')
            )
        except (ValueError, TypeError) as e:
            logger.error(f"Password verification failed: {e}")
            return False


class AuthService:
    """Ïù∏Ï¶ù ÏÑúÎπÑÏä§"""

    @staticmethod
    def login(email: str, password: str) -> LoginResult:
        """ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏

        Args:
            email: ÏÇ¨Ïö©Ïûê Ïù¥Î©îÏùº
            password: ÏÇ¨Ïö©Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏

        Returns:
            LoginResult: Î°úÍ∑∏Ïù∏ Í≤∞Í≥º

        Raises:
            ValueError: Ïù¥Î©îÏùº ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùå
        """
        # ÏûÖÎ†• Í≤ÄÏ¶ù
        if not email or not password:
            logger.warning("Empty email or password")
            return LoginResult(
                status="error",
                error_code="INVALID_INPUT"
            )

        # ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
        user = UserRepository.find_by_email(email)
        if not user:
            logger.warning(f"User not found: {email}")
            return LoginResult(
                status="error",
                error_code="USER_NOT_FOUND"
            )

        # ÎπÑÎ∞ÄÎ≤àÌò∏ Í≤ÄÏ¶ù
        if not UserRepository.verify_password(user['password_hash'], password):
            logger.warning(f"Password verification failed: {email}")
            return LoginResult(
                status="error",
                error_code="INVALID_CREDENTIALS"
            )

        # ÌÜ†ÌÅ∞ ÏÉùÏÑ±
        token = AuthService._create_token(email)

        logger.info(f"Login successful: {email}")
        return LoginResult(
            status="authenticated",
            token=token,
            expires_in=TOKEN_EXPIRATION_HOURS * 3600
        )

    @staticmethod
    def _create_token(email: str) -> str:
        """JWT ÌÜ†ÌÅ∞ ÏÉùÏÑ±"""
        payload = {
            "email": email,
            "iat": datetime.utcnow(),
            "exp": datetime.utcnow() + timedelta(hours=TOKEN_EXPIRATION_HOURS)
        }
        return jwt.encode(payload, SECRET_KEY, algorithm="HS256")
```

#### Step 4.2: ÌÖåÏä§Ìä∏ Ïª§Î≤ÑÎ¶¨ÏßÄ Í≤ÄÏ¶ù

```bash
pytest tests/test_auth.py --cov=src/auth --cov-report=html

# Í≤∞Í≥º:
===================== 85% coverage =====================
```

**Ï°∞Í±¥**: TRUST 5Ïùò "Test" ÏõêÏπô Ï∂©Ï°± (‚â•85% Ïª§Î≤ÑÎ¶¨ÏßÄ)

#### Step 4.3: ÏΩîÎìú ÌíàÏßà Í≤ÄÏÇ¨

```bash
# ÏΩîÎìú Ïä§ÌÉÄÏùº Í≤ÄÏÇ¨
ruff check src/auth.py

# ÌÉÄÏûÖ ÏïàÏ†ÑÏÑ± Í≤ÄÏÇ¨
mypy src/auth.py --strict

# Î≥¥Ïïà Í≤ÄÏÇ¨
bandit -r src/auth.py

# Í≤∞Í≥º: Î™®Îëê 0 issues ‚úÖ
```

#### Step 4.4: Î¨∏ÏÑúÌôî Ï∂îÍ∞Ä

`.moai/docs/auth.md`:

```markdown
<!-- @DOC:SAMPLE-001 -->

# Ïù∏Ï¶ù Í∏∞Îä•

## Í∞úÏöî
ÏÇ¨Ïö©Ïûê Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ïù¥Ïö©Ìïú ÏïàÏ†ÑÌïú Î°úÍ∑∏Ïù∏ Í∏∞Îä•ÏûÖÎãàÎã§.

## ÏÇ¨Ïö© ÏòàÏãú

```python
from src.auth import AuthService

result = AuthService.login("user@example.com", "password123")
if result.status == "authenticated":
    print(f"Token: {result.token}")
else:
    print(f"Error: {result.error_code}")
```

## Î≥¥Ïïà Í≥†Î†§ÏÇ¨Ìï≠

- ‚úÖ ÎπÑÎ∞ÄÎ≤àÌò∏Îäî bcryptÎ°ú Ìï¥Ïã±Îê®
- ‚úÖ ÌÜ†ÌÅ∞ÏùÄ HS256ÏúºÎ°ú ÏÑúÎ™ÖÎê®
- ‚úÖ Î™®Îì† ÏûÖÎ†•ÏùÄ Í≤ÄÏ¶ùÎê®
- ‚úÖ ÎØºÍ∞êÌïú Ï†ïÎ≥¥Îäî Î°úÍ∑∏Ïóê ÎÖ∏Ï∂úÎêòÏßÄ ÏïäÏùå
```

#### Step 4.5: Ïª§Î∞ã (REFACTOR)

```bash
git add src/auth.py tests/test_auth.py .moai/docs/auth.md
git commit -m "refactor(REFACTOR): Improve code quality and add documentation

@CODE:SAMPLE-001
- Add proper error handling and input validation
- Implement UserRepository for data access layer
- Add comprehensive docstrings (Google style)
- Improve logging for security monitoring
- Achieve 85%+ test coverage

Improvements:
- Security: Environment variable for SECRET_KEY
- Quality: Type hints and error handling
- Maintainability: Separation of concerns
- Documentation: Complete API reference
"
```

**ÏÉÅÌÉú**: üü¢ REFACTOR Phase ÏôÑÎ£å, Î¨∏ÏÑú ÌÉúÍ∑∏ ÏÉùÏÑ±

---

## SPEC-First TDDÏùò Ïû•Ï†ê

### 1. Î™ÖÌôïÌïú ÏöîÍµ¨ÏÇ¨Ìï≠ ‚úÖ

SPECÏùÑ Î®ºÏ†Ä ÏûëÏÑ±ÌïòÎ©¥:
- Í∞úÎ∞úÏûêÏôÄ Ïù¥Ìï¥Í¥ÄÍ≥ÑÏûê Í∞Ñ Ïò§Ìï¥ Ï†úÍ±∞
- Î≥ÄÍ≤Ω ÏöîÏ≤≠ ÏµúÏÜåÌôî
- Î≤îÏúÑ ÌôïÏã§
- ÏôÑÎ£å Í∏∞Ï§Ä Î™ÖÌôï

### 2. ÏûêÎèô Ï∂îÏ†ÅÏÑ± ‚úÖ

TAG ÏãúÏä§ÌÖúÏúºÎ°ú:
- SPEC ‚Üí TEST ‚Üí CODE ‚Üí DOC ÏôÑÏ†Ñ Ïó∞Í≤∞
- Ïñ¥Îäê ÏöîÍµ¨ÏÇ¨Ìï≠Ïù¥ Íµ¨ÌòÑÎêêÎäîÏßÄ ÏûêÎèô Ï∂îÏ†Å
- ÎàÑÎùΩÎêú ÌÖåÏä§Ìä∏/Î¨∏ÏÑú ÏûêÎèô Í∞êÏßÄ

### 3. ÌÖåÏä§Ìä∏ ÌíàÏßà Ìñ•ÏÉÅ ‚úÖ

ÌÖåÏä§Ìä∏Î•º Î®ºÏ†Ä Ïì∞Î©¥:
- Íµ¨ÌòÑ Ï†ÑÏóê Ïó£ÏßÄ ÏºÄÏù¥Ïä§ Í≥†Î†§
- ÌÖåÏä§Ìä∏ Ïª§Î≤ÑÎ¶¨ÏßÄ ÏûêÎèô 85% Ïù¥ÏÉÅ
- ÌöåÍ∑Ä ÌÖåÏä§Ìä∏ ÏûêÎèôÌôî

### 4. Î¨∏ÏÑúÌôî ÏûêÎèôÌôî ‚úÖ

SPECÍ≥º ÏΩîÎìú ÎèôÍ∏∞Ìôî:
- Ï£ºÏÑù Î∂àÏùºÏπò Ï†úÍ±∞
- ÏÇ¨Ïö©Ïûê Î¨∏ÏÑú ÏûêÎèô ÏÉùÏÑ±
- Î≥ÄÍ≤Ω Ïù¥Î†• Ï∂îÏ†Å

---

## SPEC-First TDD vs Îã§Î•∏ Î∞©Ïãù ÎπÑÍµê

### SPEC-First TDD (MoAI-ADK)

```
SPEC Ï†ïÏùò
    ‚Üì
ÌÖåÏä§Ìä∏ ÏûëÏÑ± (RED)
    ‚Üì
Íµ¨ÌòÑ (GREEN)
    ‚Üì
Í∞úÏÑ† (REFACTOR)
    ‚Üì
Î¨∏ÏÑú ÎèôÍ∏∞Ìôî
    ‚Üì
PR ÏÉùÏÑ± & Î≥ëÌï©
```

**Ïû•Ï†ê**:
- ÏöîÍµ¨ÏÇ¨Ìï≠ Î™ÖÌôï
- ÏôÑÏ†ÑÌïú Ï∂îÏ†ÅÏÑ±
- ÏûêÎèô Î¨∏ÏÑúÌôî
- ÎÇÆÏùÄ Í∏∞Ïà†Î∂ÄÏ±Ñ

### Í∏∞Ï°¥ TDD

```
ÌÖåÏä§Ìä∏ ÏûëÏÑ± (RED)
    ‚Üì
Íµ¨ÌòÑ (GREEN)
    ‚Üì
Í∞úÏÑ† (REFACTOR)
    ‚Üì
(Ïù¥ Îã§ÏùåÏù¥?)
```

**Î¨∏Ï†úÏ†ê**:
- ÏöîÍµ¨ÏÇ¨Ìï≠ Î∂àÎ™ÖÌôïÌï† Ïàò ÏûàÏùå
- Î¨∏ÏÑúÌôî ÎàÑÎùΩ
- Ï∂îÏ†ÅÏÑ± ÏïΩÌï®
- Í∏∞Ïà†Î∂ÄÏ±Ñ Ï¶ùÍ∞Ä

### Waterfall (Ìè≠Ìè¨Ïàò)

```
ÏöîÍµ¨Î∂ÑÏÑù
    ‚Üì
ÏÑ§Í≥Ñ
    ‚Üì
Íµ¨ÌòÑ
    ‚Üì
ÌÖåÏä§Ìä∏
    ‚Üì
Î∞∞Ìè¨
```

**Î¨∏Ï†úÏ†ê**:
- Î≥ÄÍ≤Ω Ïñ¥Î†§ÏõÄ
- ÌîºÎìúÎ∞± ÎäêÎ¶º
- ÏúÑÌóò ÎÜíÏùå

---

## SPEC-First TDD Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏

### SPEC Îã®Í≥Ñ

- ‚úÖ SPEC Î¨∏ÏÑú ÏûëÏÑ±Îê®
- ‚úÖ EARS ÌòïÏãù Í≤ÄÏ¶ùÎê®
- ‚úÖ ÏàòÏö© Í∏∞Ï§Ä Ï†ïÏùòÎê®
- ‚úÖ @SPEC TAG Ï∂îÍ∞ÄÎê®
- ‚úÖ ÌåÄ Î¶¨Î∑∞ ÏôÑÎ£åÎê®

### RED Îã®Í≥Ñ

- ‚úÖ Î™®Îì† ÏàòÏö© Í∏∞Ï§ÄÏóê ÎåÄÌïú ÌÖåÏä§Ìä∏ ÏûëÏÑ±Îê®
- ‚úÖ ÌÖåÏä§Ìä∏Í∞Ä Ïã§Ìå®Ìï® (ÏòàÏÉÅÎêú ÏÉÅÌô©)
- ‚úÖ @TEST TAG Ï∂îÍ∞ÄÎê®
- ‚úÖ Ïª§Î∞ãÎê® (test(RED):)

### GREEN Îã®Í≥Ñ

- ‚úÖ ÏµúÏÜåÌïúÏùò ÏΩîÎìúÎ°ú ÌÖåÏä§Ìä∏ ÌÜµÍ≥º
- ‚úÖ @CODE TAG Ï∂îÍ∞ÄÎê®
- ‚úÖ Ïª§Î∞ãÎê® (feat(GREEN):)

### REFACTOR Îã®Í≥Ñ

- ‚úÖ ÌÖåÏä§Ìä∏ Ïª§Î≤ÑÎ¶¨ÏßÄ ‚â• 85%
- ‚úÖ ÏΩîÎìú Ïä§ÌÉÄÏùº Í≤ÄÏÇ¨ ÌÜµÍ≥º
- ‚úÖ ÌÉÄÏûÖ ÏïàÏ†ÑÏÑ± Í≤ÄÏÇ¨ ÌÜµÍ≥º
- ‚úÖ Î≥¥Ïïà Í≤ÄÏÇ¨ ÌÜµÍ≥º
- ‚úÖ Î¨∏ÏÑú ÏûëÏÑ±Îê® (@DOC TAG)
- ‚úÖ Ïª§Î∞ãÎê® (refactor(REFACTOR):)

### ÎèôÍ∏∞Ìôî Îã®Í≥Ñ

- ‚úÖ README.md ÏóÖÎç∞Ïù¥Ìä∏
- ‚úÖ CHANGELOG.md ÏóÖÎç∞Ïù¥Ìä∏
- ‚úÖ API Î¨∏ÏÑú ÏÉùÏÑ±
- ‚úÖ TAG Í≤ÄÏ¶ù ÌÜµÍ≥º
- ‚úÖ PR ÏÉùÏÑ±Îê®

---

## Î¨∏Ï†ú Ìï¥Í≤∞

### Q: SPECÏùÑ ÎÑàÎ¨¥ ÏûêÏÑ∏ÌïòÍ≤å ÏûëÏÑ±Ìï¥Ïïº ÌïòÎÇòÏöî?

**A**: ÏïÑÎãàÏöî. Îã§Ïùå Ï†ïÎèÑÏùò ÏàòÏ§ÄÏù¥ Ï†ÅÎãπÌï©ÎãàÎã§:

```markdown
‚úÖ Ï¢ãÏùÄ ÏàòÏ§Ä:
- Í∏∞Îä• Í∞úÏöî (1-2Ï§Ñ)
- Ï£ºÏöî ÏöîÍµ¨ÏÇ¨Ìï≠ (3-5Í∞ú)
- ÏÑ±Í≥µ/Ïã§Ìå® Í∏∞Ï§Ä
- ÏàòÏö© Í∏∞Ï§Ä (3-5Í∞ú)
- ÏÜåÏöî ÏãúÍ∞Ñ: 10-15Î∂Ñ

‚ùå Í≥ºÎèÑÌïú ÏàòÏ§Ä:
- Íµ¨ÌòÑ ÏÑ∏Î∂ÄÏÇ¨Ìï≠ (SPECÏùò Ïó≠Ìï† ÏïÑÎãò)
- UI/UX ÎîîÏûêÏù∏ (Îã§Î•∏ Î¨∏ÏÑúÏóêÏÑú)
- Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà (ÏÑ§Í≥Ñ Îã®Í≥ÑÏóêÏÑú)
```

### Q: SPECÏùÑ Î≥ÄÍ≤ΩÌï¥Ïïº ÌïòÎ©¥?

**A**: Ïñ∏Ï†úÎì† Î≥ÄÍ≤Ω Í∞ÄÎä•Ìï©ÎãàÎã§:

1. SPEC ÌååÏùº ÏàòÏ†ï
2. Í∏∞Ï°¥ ÌÖåÏä§Ìä∏/ÏΩîÎìú Í≤ÄÌÜ†
3. ÌïÑÏöîÌïú ÌÖåÏä§Ìä∏/ÏΩîÎìú ÏóÖÎç∞Ïù¥Ìä∏
4. Îã§Ïãú GREEN ‚Üí REFACTOR ÏßÑÌñâ

### Q: ÏãúÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï† Îïå Îã®Í≥ÑÎ•º Í±¥ÎÑàÎõ∏ Ïàò ÏûàÎÇòÏöî?

**A**: Í∂åÏû•ÌïòÏßÄ ÏïäÏäµÎãàÎã§:

| Í±¥ÎÑàÎúÄ | Î¨∏Ï†ú |
|------|------|
| SPEC Í±¥ÎÑàÎúÄ | ÏöîÍµ¨ÏÇ¨Ìï≠ Î∂àÎ™ÖÌôï, Ïû¨ÏûëÏóÖ Ï¶ùÍ∞Ä |
| RED Í±¥ÎÑàÎúÄ | ÌÖåÏä§Ìä∏ ÎàÑÎùΩ, Î≤ÑÍ∑∏ Ï¶ùÍ∞Ä |
| REFACTOR Í±¥ÎÑàÎúÄ | Í∏∞Ïà†Î∂ÄÏ±Ñ, Ïú†ÏßÄÎ≥¥Ïàò Ïñ¥Î†§ÏõÄ |
| ÎèôÍ∏∞Ìôî Í±¥ÎÑàÎúÄ | Î¨∏ÏÑú ÎàÑÎùΩ, Ï∂îÏ†ÅÏÑ± ÏÉÅÏã§ |

SPEC-First TDDÎäî Ïû•Í∏∞Ï†ÅÏúºÎ°ú ÏãúÍ∞ÑÏùÑ **40% Ïù¥ÏÉÅ Îã®Ï∂ï**Ìï©ÎãàÎã§.

---

## Îã§Ïùå Îã®Í≥Ñ

SPEC-First TDDÎ•º Ïù¥Ìï¥Ìïú ÌõÑ:

1. **[EARS Í∞ÄÏù¥Îìú](/ko/concepts/ears-guide)** - SPEC ÏûëÏÑ± Î∞©Ïãù ÏÉÅÏÑ∏ ÌïôÏäµ
2. **[TAG ÏãúÏä§ÌÖú](/ko/concepts/tag-system)** - ÏöîÍµ¨ÏÇ¨Ìï≠Í≥º ÏΩîÎìú Ï∂îÏ†Å
3. **[/alfred:1-plan ÏãúÏûë](/ko/cli/alfred-1-plan)** - Ï≤´ Î≤àÏß∏ SPEC ÏûëÏÑ±

---

## Ï∞∏Í≥† ÏûêÎ£å

- **MoAI-ADK ÏõåÌÅ¨ÌîåÎ°úÏö∞**: 4Îã®Í≥Ñ ÏûêÎèôÌôî ÏãúÏä§ÌÖú
- **TRUST 5 ÏõêÏπô**: ÌíàÏßà Í∏∞Ï§Ä
- **Git Í∏∞Î∞ò ÌòëÏóÖ**: ÏûêÎèô Ïª§Î∞ã Î©îÏãúÏßÄ
