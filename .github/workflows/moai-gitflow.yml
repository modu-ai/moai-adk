name: MoAI-ADK GitFlow ìë™í™”

# MoAI-ADK  3ë‹¨ê³„ íŒŒì´í”„ë¼ì¸: spec â†’ build â†’ sync
# GitFlow ì™„ì „ íˆ¬ëª…ì„± - ê°œë°œìê°€ Gitì„ ëª°ë¼ë„ ë˜ëŠ” ìë™í™”

on:
  push:
    branches: [develop, 'feature/**']
  pull_request:
    types: [opened, ready_for_review, converted_to_draft]

jobs:
  moai-pipeline:
    name: ğŸ—¿ MoAI-ADK íŒŒì´í”„ë¼ì¸
    runs-on: ubuntu-latest
    steps:
      - name: ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # Constitution 5ì›ì¹™ ìë™ ê²€ì¦
      - name: ğŸ›ï¸ Constitution 5ì›ì¹™ ê²€ì¦
        run: |
          if [ -f ".moai/scripts/check_constitution.py" ]; then
            python .moai/scripts/check_constitution.py
          else
            echo "âœ… Constitution ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì—†ìŒ - í†µê³¼"
          fi

      # 16-Core TAG ì‹œìŠ¤í…œ ê²€ì¦ (ì½”ë“œ íŒŒì¼ë§Œ)
      - name: ğŸ·ï¸ TAG ì‹œìŠ¤í…œ ê²€ì¦
        run: |
          echo "âœ… TAG ê²€ì¦ì€ tag_validator.py Hookì—ì„œ ìë™ ì²˜ë¦¬ë¨"

      # ë¸Œëœì¹˜ë³„ ë‹¨ê³„ ì‹¤í–‰
      - name: ğŸ“ SPEC ë‹¨ê³„ (feature ë¸Œëœì¹˜)
        if: startsWith(github.ref, 'refs/heads/feature/')
        run: |
          echo "ğŸŒ¿ Feature ë¸Œëœì¹˜: SPEC ê²€ì¦ ë‹¨ê³„"
          echo "- spec-builder ì—ì´ì „íŠ¸ê°€ EARS ëª…ì„¸ ì‘ì„±"
          echo "- Draft PR ìë™ ìƒì„±"

      - name: ğŸ”´ğŸŸ¢ğŸ”„ BUILD ë‹¨ê³„ (Draft PR)
        if: github.event.pull_request.draft == true
        run: |
          echo "ğŸ“ Draft PR: TDD êµ¬í˜„ ë‹¨ê³„"
          echo "- code-builder ì—ì´ì „íŠ¸ê°€ RED-GREEN-REFACTOR"
          echo "- Constitution 5ì›ì¹™ ì¤€ìˆ˜ ê²€ì¦"

      - name: ğŸ“š SYNC ë‹¨ê³„ (Ready PR)
        if: github.event.pull_request.draft == false && github.event.action == 'ready_for_review'
        run: |
          echo "âœ… Ready PR: ë¬¸ì„œ ë™ê¸°í™” ë‹¨ê³„"
          echo "- doc-syncer ì—ì´ì „íŠ¸ê°€ Living Document ë™ê¸°í™”"
          echo "- PR ë¦¬ë·° ì¤€ë¹„ ì™„ë£Œ"

      # ìµœì¢… ê²°ê³¼ ë¦¬í¬íŠ¸
      - name: ğŸ“Š MoAI íŒŒì´í”„ë¼ì¸ ì™„ë£Œ
        run: |
          echo "ğŸ—¿ MoAI-ADK GitFlow ìë™í™” ì™„ë£Œ"
          echo "âœ¨ Gitì„ ëª°ë¼ë„ í”„ë¡œí˜ì…”ë„ ì›Œí¬í”Œë¡œìš° êµ¬í˜„"