# EARS 요구사항 작성 가이드

<!-- @CODE:DOCS-002 | SPEC: .moai/specs/SPEC-DOCS-002/spec.md -->

> "명확한 요구사항이 성공적인 프로젝트의 시작입니다"

## 개요

**EARS (Easy Approach to Requirements Syntax)** 는 체계적이고 명확한 요구사항 작성을 위한 방법론입니다. MoAI-ADK는 EARS를 SPEC 작성의 핵심 원칙으로 채택하여, 애매모호함을 제거하고 검증 가능한 요구사항을 작성합니다.

### EARS의 장점

- **명확성**: 구조화된 구문으로 의도를 정확히 전달
- **검증 가능성**: 측정 가능한 기준으로 구현 검증
- **일관성**: 팀 전체가 동일한 형식으로 요구사항 작성
- **추적성**: @TAG 시스템과 결합하여 완벽한 추적성 확보

---

## EARS 5가지 구문 유형

### 1. Ubiquitous (기본 요구사항)

**형식**: 시스템은 [기능]을 제공해야 한다

**용도**: 항상 제공되어야 하는 핵심 기능

**예시**:

```markdown
- 시스템은 사용자 인증 기능을 제공해야 한다
- 시스템은 파일 업로드 기능을 제공해야 한다
- 시스템은 실시간 알림 기능을 제공해야 한다
```

### 2. Event-driven (이벤트 기반)

**형식**: WHEN [조건]이면, 시스템은 [동작]해야 한다

**용도**: 특정 이벤트 발생 시 시스템 동작 정의

**예시**:

```markdown
- WHEN 사용자가 유효한 자격증명으로 로그인하면, 시스템은 JWT 토큰을 발급해야 한다
- WHEN 파일 업로드가 완료되면, 시스템은 업로드 완료 알림을 전송해야 한다
- WHEN 결제가 실패하면, 시스템은 실패 사유를 사용자에게 표시해야 한다
```

### 3. State-driven (상태 기반)

**형식**: WHILE [상태]일 때, 시스템은 [동작]해야 한다

**용도**: 특정 상태가 지속되는 동안의 시스템 동작 정의

**예시**:

```markdown
- WHILE 사용자가 인증된 상태일 때, 시스템은 보호된 리소스 접근을 허용해야 한다
- WHILE 파일 업로드가 진행 중일 때, 시스템은 진행률을 실시간으로 표시해야 한다
- WHILE 결제 처리가 진행 중일 때, 시스템은 중복 요청을 차단해야 한다
```

### 4. Optional (선택적 기능)

**형식**: WHERE [조건]이면, 시스템은 [동작]할 수 있다

**용도**: 조건부로 제공되는 선택적 기능

**예시**:

```markdown
- WHERE 리프레시 토큰이 제공되면, 시스템은 새로운 액세스 토큰을 발급할 수 있다
- WHERE 프리미엄 사용자이면, 시스템은 5GB 이상의 파일 업로드를 허용할 수 있다
- WHERE 쿠폰 코드가 입력되면, 시스템은 할인을 적용할 수 있다
```

### 5. Constraints (제약사항)

**형식**: IF [조건]이면, 시스템은 [제약]해야 한다

**용도**: 시스템의 한계나 제약사항 명시

**예시**:

```markdown
- IF 잘못된 토큰이 제공되면, 시스템은 접근을 거부해야 한다
- IF 파일 크기가 100MB를 초과하면, 시스템은 업로드를 거부해야 한다
- IF 일일 결제 시도가 3회를 초과하면, 시스템은 계정을 일시 정지해야 한다
```

---

## 실제 적용 예시

### 예시 1: JWT 인증 시스템 (AUTH-001)

```markdown
### Ubiquitous Requirements
- 시스템은 JWT 기반 인증 기능을 제공해야 한다
- 시스템은 토큰 갱신 기능을 제공해야 한다

### Event-driven Requirements
- WHEN 사용자가 유효한 이메일/비밀번호로 로그인하면, 시스템은 액세스 토큰과 리프레시 토큰을 발급해야 한다
- WHEN 액세스 토큰이 만료되면, 시스템은 401 Unauthorized 에러를 반환해야 한다
- WHEN 리프레시 토큰으로 갱신 요청이 오면, 시스템은 새로운 액세스 토큰을 발급해야 한다

### State-driven Requirements
- WHILE 사용자가 인증된 상태일 때, 시스템은 API 요청에 사용자 정보를 포함해야 한다
- WHILE 토큰이 유효한 동안, 시스템은 자동 재로그인 없이 API 접근을 허용해야 한다

### Optional Features
- WHERE 2FA(이중 인증)가 활성화되어 있으면, 시스템은 추가 인증 코드를 요구할 수 있다

### Constraints
- IF 잘못된 자격증명이 5회 연속 입력되면, 시스템은 계정을 15분간 잠가야 한다
- 액세스 토큰 만료시간은 15분을 초과하지 않아야 한다
- 리프레시 토큰 만료시간은 7일을 초과하지 않아야 한다
```

### 예시 2: 파일 업로드 기능 (UPLOAD-001)

```markdown
### Ubiquitous Requirements
- 시스템은 멀티파트 파일 업로드 기능을 제공해야 한다
- 시스템은 업로드 진행률 표시 기능을 제공해야 한다

### Event-driven Requirements
- WHEN 파일 선택이 완료되면, 시스템은 파일 크기와 타입을 검증해야 한다
- WHEN 업로드가 성공하면, 시스템은 파일 URL을 반환해야 한다
- WHEN 업로드가 실패하면, 시스템은 실패 사유를 사용자에게 표시해야 한다

### State-driven Requirements
- WHILE 업로드가 진행 중일 때, 시스템은 진행률 바를 실시간으로 업데이트해야 한다
- WHILE 파일 검증 중일 때, 시스템은 "검증 중" 상태를 표시해야 한다

### Optional Features
- WHERE 사용자가 프리미엄 계정이면, 시스템은 동시 업로드를 5개까지 허용할 수 있다

### Constraints
- IF 파일 크기가 10MB를 초과하면, 시스템은 청크 업로드를 사용해야 한다
- IF 허용되지 않은 파일 타입이면, 시스템은 업로드를 거부해야 한다
- 동시 업로드는 무료 사용자의 경우 2개로 제한되어야 한다
```

---

## 안티 패턴 및 개선안

### 안티 패턴 1: 모호한 표현

❌ **나쁜 예**:

```markdown
- 시스템은 사용자 친화적이어야 한다
```

✅ **개선안**:

```markdown
- 시스템은 주요 기능에 3번의 클릭 이내로 접근할 수 있어야 한다
- 시스템은 에러 메시지를 사용자가 이해할 수 있는 언어로 표시해야 한다
```

### 안티 패턴 2: 측정 불가능한 기준

❌ **나쁜 예**:

```markdown
- 시스템은 빠르게 동작해야 한다
```

✅ **개선안**:

```markdown
- WHEN 사용자가 로그인 버튼을 클릭하면, 시스템은 2초 이내에 응답해야 한다
- 시스템은 API 응답 시간을 평균 200ms 이내로 유지해야 한다
```

### 안티 패턴 3: 구체성 부족

❌ **나쁜 예**:

```markdown
- 시스템은 보안이 강해야 한다
```

✅ **개선안**:

```markdown
- 시스템은 HTTPS를 사용하여 모든 데이터 전송을 암호화해야 한다
- 시스템은 비밀번호를 bcrypt 알고리즘(cost factor 12)으로 해싱해야 한다
- IF 잘못된 로그인 시도가 5회 연속되면, 시스템은 계정을 15분간 잠가야 한다
```

### 안티 패턴 4: 주체 불명확

❌ **나쁜 예**:

```markdown
- 파일이 업로드되어야 한다
```

✅ **개선안**:

```markdown
- WHEN 사용자가 파일 업로드 버튼을 클릭하면, 시스템은 파일 선택 대화상자를 표시해야 한다
- WHEN 파일 선택이 완료되면, 시스템은 자동으로 업로드를 시작해야 한다
```

### 안티 패턴 5: 조건 누락

❌ **나쁜 예**:

```markdown
- 시스템은 할인을 적용해야 한다
```

✅ **개선안**:

```markdown
- WHERE 유효한 쿠폰 코드가 입력되면, 시스템은 해당 할인율을 적용할 수 있다
- IF 할인 적용 후 금액이 0원 미만이면, 시스템은 최소 금액 1,000원을 유지해야 한다
```

---

## 베스트 프랙티스

### 1. 측정 가능한 기준 명시

```markdown
✅ 좋은 예:
- 시스템은 API 응답 시간을 95 percentile 기준 500ms 이내로 유지해야 한다
- WHEN 파일 업로드가 완료되면, 시스템은 3초 이내에 성공 메시지를 표시해야 한다
```

### 2. 구체적인 액션 동사 사용

```markdown
✅ 좋은 예:
- 시스템은 사용자에게 이메일 알림을 **전송**해야 한다
- 시스템은 입력값을 **검증**해야 한다
- 시스템은 결과를 **로깅**해야 한다
```

### 3. 제약사항 명확히 정의

```markdown
✅ 좋은 예:
- IF 동시 접속자가 1,000명을 초과하면, 시스템은 대기 큐를 활성화해야 한다
- 사용자 비밀번호는 최소 8자, 대소문자/숫자/특수문자를 각 1개 이상 포함해야 한다
```

---

## EARS 템플릿

### SPEC 문서 템플릿

```markdown
---
id: [DOMAIN]-[번호]
version: 0.0.1
status: draft
created: YYYY-MM-DD
updated: YYYY-MM-DD
author: @your-name
priority: high|medium|low
---

# @SPEC:[ID]: [제목]

## HISTORY
### v0.0.1 (YYYY-MM-DD)
- **INITIAL**: [초기 작성 설명]

---

## Requirements (기능 요구사항)

### Ubiquitous Requirements (기본 요구사항)
- 시스템은 [기능]을 제공해야 한다

### Event-driven Requirements (이벤트 기반)
- WHEN [조건]이면, 시스템은 [동작]해야 한다

### State-driven Requirements (상태 기반)
- WHILE [상태]일 때, 시스템은 [동작]해야 한다

### Optional Features (선택적 기능)
- WHERE [조건]이면, 시스템은 [동작]할 수 있다

### Constraints (제약사항)
- IF [조건]이면, 시스템은 [제약]해야 한다

---
```

---

## 관련 문서

- [TRUST 5원칙 가이드](./trust-principles.md)
- [TAG 시스템 가이드](./tag-system.md)
- [SPEC-First TDD 워크플로우](./spec-first-tdd.md)
- [개발 가이드](../../.moai/memory/development-guide.md)

---

**작성일**: 2025-10-11
**버전**: v1.0.0
**TAG**: @CODE:DOCS-002
