# コアアーキテクチャ: Alfredハイブリッドシステム

MoAI-ADKの心臓部であるAlfredスーパーエージェントのアーキテクチャを深く理解してください。

## 全体構造

### 4層スタック

```
┌─────────────────────────────────────────────┐
│           Commands (/alfred:*)              │
│   (Workflow Orchestration & User Entry)     │
└────────────────┬────────────────────────────┘
                 │
┌────────────────▼────────────────────────────┐
│        Sub-agents (19名のチーム)              │
│   (Deep reasoning & Decision making)        │
└────────────────┬────────────────────────────┘
                 │
┌────────────────▼────────────────────────────┐
│       Claude Skills (93個)                  │
│   (Reusable knowledge capsules)             │
└────────────────┬────────────────────────────┘
                 │
┌────────────────▼────────────────────────────┐
│           Hooks (<100ms)                    │
│   (Guardrails & Context)                    │
└─────────────────────────────────────────────┘
```

______________________________________________________________________

## Alfredスーパーエージェント

Alfredは**SPEC → TDD → Sync**ワークフローをオーケストレーションする中央調整者です。

### コア特性

| 特性          | 説明                                       |
| ------------- | ------------------------------------------ |
| **自律性**    | ユーザーの意図を理解し、独立して意思決定 |
| **推論能力** | 複雑なタスクを段階的に分解                |
| **チーム調整**   | 19名の専門家を最適に配置              |
| **学習**      | セッションログから継続的に改善                |
| **透明性**    | すべての決定を追跡可能に記録             |

______________________________________________________________________

## 19名のチーム構造

### 10名のコアSub-agents

| Agent                      | 役割                     | アクティベーション条件          |
| -------------------------- | ------------------------ | -------------------- |
| **project-manager**        | プロジェクト初期化と設定  | `/alfred:0-project`  |
| **spec-builder**           | SPEC作成（EARS構文）    | `/alfred:1-plan`     |
| **implementation-planner** | アーキテクチャと実装計画    | `/alfred:2-run`開始 |
| **tdd-implementer**        | RED→GREEN→REFACTOR実行  | `/alfred:2-run`中   |
| **doc-syncer**             | ドキュメント自動生成と同期 | `/alfred:3-sync`     |
| **tag-agent**              | TAG検証と追跡可能性管理  | `/alfred:3-sync`     |
| **git-manager**            | Gitワークフロー自動化    | すべての段階            |
| **trust-checker**          | TRUST 5原則検証        | `/alfred:2-run`完了 |
| **quality-gate**           | リリース準備状態確認    | `/alfred:3-sync`     |
| **debug-helper**           | エラー分析と解決        | 必要時に自動アクティベート   |

### 6名の専門家Agents

| Expert              | ドメイン                        | アクティベーション条件              |
| ------------------- | ----------------------------- | ------------------------ |
| **backend-expert**  | API、サーバー、DBアーキテクチャ        | SPECにサーバー/APIキーワード   |
| **frontend-expert** | UI、状態管理、パフォーマンス            | SPECにフロントエンドキーワード |
| **devops-expert**   | デプロイ、CI/CD、インフラ           | SPECにデプロイキーワード       |
| **ui-ux-expert**    | デザインシステム、アクセシビリティ         | SPECにデザインキーワード     |
| **security-expert** | セキュリティ分析、脆弱性診断        | SPECにセキュリティキーワード       |
| **database-expert** | DB設計、最適化、マイグレーション | SPECにDBキーワード         |

### 2名のビルトインAgents (Claude)

- **Claude Opus/Sonnet**: 複雑な推論が必要な場合
- **Claude Haiku**: 軽量タスク用

______________________________________________________________________

## ハイブリッドパターン

### Lead-Specialistパターン

専門化されたドメイン専門家がリードエージェントをサポートします。

```
ユーザーリクエスト
    ↓
Alfred (Lead)
    ├─→ フロントエンドキーワード検出
    │   └─→ frontend-expertアクティベート（Specialist）
    ├─→ データベースキーワード検出
    │   └─→ database-expertアクティベート（Specialist）
    └─→ セキュリティキーワード検出
        └─→ security-expertアクティベート（Specialist）
```

**使用例**:

- UIコンポーネント設計が必要 → UI/UX Expert
- DBパフォーマンス最適化 → Database Expert
- セキュリティレビュー → Security Expert

### Master-Cloneパターン

大規模タスクはAlfredクローンが並列処理します。

```
大規模タスク（100+ファイル、5+ステップ）
    ↓
Master Alfred（調整）
    ├─→ Clone-1: モジュールAリファクタリング
    ├─→ Clone-2: モジュールBリファクタリング
    └─→ Clone-3: モジュールCリファクタリング
    ↓
結果マージと統合
```

**使用例**:

- 大規模マイグレーション（v1.0 → v2.0）
- 全体アーキテクチャリファクタリング
- 複数ドメイン同時作業

______________________________________________________________________

## 4ステップワークフロー

### Phase 1: 意図理解（Intent Understanding）

```
ユーザーリクエスト → 明確性評価
├─ 明確: Phase 2に進行
└─ 不明確: AskUserQuestion → ユーザー応答 → Phase 2に進行
```

**Alfredの役割**:

- リクエスト分析と分類
- 必要に応じて追加情報収集
- タスク範囲確定

### Phase 2: 計画作成（Plan Creation）

```
Plan Agent呼び出し
    ↓
├─ タスク分解（Decomposition）
├─ 依存関係分析（Dependency Analysis）
├─ 並列化機会識別（Parallelization）
├─ ファイルリスト明示（File List）
└─ 時間見積もり（Time Estimation）
    ↓
ユーザー承認（AskUserQuestion）
    ↓
TodoWrite初期化
```

### Phase 3: タスク実行（Execution）

```
RED Phase
├─ テスト作成
└─ すべて失敗確認

GREEN Phase
├─ 最小実装
└─ すべて通過確認

REFACTOR Phase
├─ コード改善
└─ テスト維持
```

**TDD厳格性**:

- RED: 実装コード禁止
- GREEN: 最小限のみ追加
- REFACTOR: テスト維持

### Phase 4: 報告とコミット（Report & Commit）

```
タスク完了
    ↓
├─ ドキュメント生成（設定に応じて）
├─ Gitコミット（自動）
├─ PR作成（チームモード）
└─ クリーンアップ
```

______________________________________________________________________

## TAGシステム（追跡可能性）

### TAGチェーン

```
SPEC-001（要件）
    ↓
@TEST:APP-001:*（テスト）
    ↓
@CODE:APP-001:*（実装）
    ↓
@DOC:APP-001:*（ドキュメント）
    ↓
相互参照（完全な追跡可能性）
```

### 追跡可能性保証

| 成果物 | TAG                | 用途          |
| -------- | ------------------ | ------------- |
| SPEC     | `SPEC-001`         | 要件定義 |
| テスト   | `@TEST:SPEC-001`   | 要件検証 |
| コード     | `@CODE:SPEC-001:*` | 実装追跡     |
| ドキュメント     | `@DOC:SPEC-001`    | ドキュメント同期   |

______________________________________________________________________

## コアスキルシステム

### 93個のClaude Skills

Skillsは**Progressive Disclosure**原則により必要な時だけロードされます。

#### 基礎スキル（Foundation）

- TRUST 5原則
- TAGシステム
- SPEC作成
- Gitワークフロー

#### 必須スキル（Essentials）

- デバッグ
- パフォーマンス最適化
- リファクタリング
- テスト作成

#### Alfredスキル（Alfred）

- エージェントガイド
- ワークフロー
- 意思決定原則

#### ドメインスキル（Domain）

- データベース
- バックエンドAPI
- フロントエンドUI
- セキュリティ

#### 言語スキル（Language）

- Python 3.13+
- TypeScript 5.7+
- Go 1.24+
- その他20言語

______________________________________________________________________

## 安全メカニズム（Hooks）

### SessionStart Hook

- プロジェクト状態確認
- セッションログ分析
- 設定検証

### PreToolUse Hook

- 危険なコマンドブロック
- 権限検証
- コンテキスト配信

### PostToolUse Hook

- 結果分析
- エラー検出
- 自動修正提案

______________________________________________________________________

## パフォーマンス指標

### 予想実行時間

| 段階          | 平均時間 | 範囲       |
| ------------- | --------- | ---------- |
| 意図理解     | 1分       | 1-5分      |
| 計画作成     | 2分       | 1-5分      |
| RED段階      | 3分       | 1-10分     |
| GREEN段階    | 5分       | 2-15分     |
| REFACTOR段階 | 5分       | 2-15分     |
| 同期        | 2分       | 1-5分      |
| **全体**      | **18分**  | **8-55分** |

### 生産性向上

従来の開発 vs MoAI-ADK:

| 指標            | 従来 | MoAI-ADK | 改善率    |
| --------------- | ---- | -------- | --------- |
| 開発速度       | 100% | 250%     | **+150%** |
| バグ削減       | 100% | 20%      | **-80%**  |
| ドキュメント時間     | 100% | 10%      | **-90%**  |
| テストカバレッジ | 60%  | 95%      | **+35%**  |

______________________________________________________________________

## スケーラビリティ

### 水平スケーリング（Horizontal）

Master-Cloneパターンで無制限並列化:

- 10モジュール同時開発
- 100+ファイル同時変更
- 書き直しとマイグレーション

### 垂直スケーリング（Vertical）

追加専門家エージェント統合:

- 新しいドメイン専門家追加
- カスタムSkills拡張
- チームサイズ無制限

______________________________________________________________________

## 次の学習

- [Alfredワークフロー](../guides/alfred/index.md) - 4ステップ詳細ガイド
- [SPEC作成](../guides/specs/basics.md) - EARS構文マスター
- [TDD実装](../guides/tdd/index.md) - RED-GREEN-REFACTOR
- [TAGシステム](../guides/specs/tags.md) - 完全な追跡可能性

______________________________________________________________________

**質問がありますか？** [オンラインドキュメントポータル](https://adk.mo.ai.kr)をご訪問ください。




