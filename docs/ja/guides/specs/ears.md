# EARS構文: 明確で実行可能な要件の記述

**Easy Approach to Requirements Syntax (EARS)** を使用して、明確で、テスト可能で、実装可能な要件を記述する方法を学びましょう。

**最終更新**: 2025-11-06
**関連**: [SPECの記述](writing.md) | [TAG システム](tags.md)

______________________________________________________________________

## EARSとは何ですか?

EARSは、あいまいさを排除し、実装の明確さを確保する5つの標準化されたパターンで要件を記述するための体系的なアプローチです。

### なぜEARSを使用するのか?

**従来の要件記述の問題点**:

- 「システムは、ユーザーフレンドリーでなければならない」→ あいまいで、テスト不可能
- 「システムは、高速に動作する必要がある」→ 測定不可能
- 「ログイン機能を提供」→ エラーケースが欠落、トリガーが不明確

**EARS構文のソリューション**:

- **明確なトリガー**: いつ、何が動作を引き起こすのか?
- **測定可能な動作**: システムは何をすべきか?
- **定量化された制約**: どのような制限があるか?
- **テスト可能な結果**: どのように検証するか?

## 5つのEARSパターン

### パターン1: 普遍的要件

**目的**: 常に真でなければならないシステムの基本的な動作を定義します。

**構文**: `システムは<動作>しなければならない`

**使用するタイミング**:

- コア機能
- システム全体の振る舞い
- 常に適用されるルール
- 基本的な能力
- 基盤となる制約

**構造**:

```
システムは [動作] しなければならない [詳細/制約]
```

#### 例

**認証システム**:

```markdown
- システムは、ユーザー認証メカニズムを提供しなければならない
- システムは、すべてのユーザーアクティビティをログに記録しなければならない
- システムは、保存時にユーザーパスワードを暗号化しなければならない
- システムは、失敗したログイン試行を3回後にアカウントをロックしなければならない
- システムは、10分間のアイドル後にセッションを期限切れにしなければならない
```

**APIエンドポイント**:

```markdown
- システムは、すべてのAPIリクエストに対してJSON応答を返さなければならない
- システムは、入力データを処理する前に検証しなければならない
- システムは、すべてのAPIエラーに対して適切なHTTPステータスコードを返さなければならない
- システムは、すべてのAPI呼び出しに対して認証を要求しなければならない
- システムは、すべてのAPIレスポンスでレート制限ヘッダーを含めなければならない
```

**データ処理**:

```markdown
- システムは、すべてのユーザーデータをバックアップしなければならない
- システムは、重複したレコードを自動的に削除しなければならない
- システムは、データの整合性制約を強制しなければならない
- システムは、すべてのデータベーストランザクションをACIDプロパティで処理しなければならない
- システムは、データ操作の監査証跡を維持しなければならない
```

**セキュリティ**:

```markdown
- システムは、すべての通信をHTTPSで暗号化しなければならない
- システムは、保存時に機密データを暗号化しなければならない
- システムは、最小権限の原則を実施しなければならない
- システムは、SQLインジェクション攻撃を防ぐために入力をサニタイズしなければならない
- システムは、すべてのセキュリティ関連イベントをログに記録しなければならない
```

#### 高度な普遍的パターン

**定量化された要件**:

```markdown
- システムは、99.9%の稼働率を維持しなければならない
- システムは、すべてのリクエストに500ミリ秒以内に応答しなければならない
- システムは、10,000の同時ユーザーをサポートしなければならない
- システムは、少なくとも1年間のトランザクション履歴を保持しなければならない
- システムは、毎日午前2時にデータをバックアップしなければならない
```

**複数の動作**:

```markdown
- システムは、ユーザープロファイルを保存し、取得し、更新しなければならない
- システムは、すべてのトランザクションをログに記録し、検証し、確認しなければならない
- システムは、ファイルアップロードを受け入れ、検証し、処理しなければならない
- システムは、ユーザー入力をサニタイズし、検証し、保存しなければならない
```

**条件付き普遍的要件**:

```markdown
- システムは、サポートされているすべてのブラウザでアクセス可能でなければならない
- システムは、すべての主要なデバイスフォームファクター(モバイル、タブレット、デスクトップ)と互換性がなければならない
- システムは、複数の言語でコンテンツを表示しなければならない
- システムは、WCAG 2.1レベルAAのアクセシビリティ基準を満たさなければならない
```

### パターン2: イベント駆動要件

**目的**: 特定のトリガーまたは条件が発生したときのシステムの動作を定義します。

**構文**: `<トリガー>の場合、システムは<応答>しなければならない`

**使用するタイミング**:

- ユーザーアクション
- システムイベント
- データ変更
- 外部トリガー
- 状態遷移

**構造**:

```
<条件>の場合、システムは [応答] しなければならない [結果/制約]
```

#### 例

**ユーザー認証**:

```markdown
- 有効な資格情報が提供された場合、システムはユーザーセッションを作成し、ダッシュボードにリダイレクトしなければならない
- 無効な資格情報が提供された場合、システムは一般的なエラーメッセージを表示し、試行をログに記録しなければならない
- ユーザーがパスワードリセットを要求した場合、システムはリセットリンクを記載したメールを送信しなければならない
- ユーザーが15分間非アクティブな場合、システムはセッションをタイムアウトし、再認証を要求しなければならない
- ユーザーが3回連続してログインに失敗した場合、システムはアカウントを30分間ロックしなければならない
```

**データ検証**:

```markdown
- フォームが送信された場合、システムはすべてのフィールドを必要な形式で検証しなければならない
- 検証に失敗した場合、システムは修正が必要なフィールドを示す具体的なエラーメッセージを表示しなければならない
- 検証に成功した場合、システムはデータを保存し、確認メッセージを表示しなければならない
- 重複データが検出された場合、システムはユーザーに警告し、既存のレコードの更新を提案しなければならない
- 必須フィールドが欠落している場合、システムはフォーム送信を防ぎ、欠落しているフィールドをハイライトしなければならない
```

**ファイル処理**:

```markdown
- ファイルがアップロードされた場合、システムはファイルタイプとサイズを検証しなければならない
- ファイルがウイルススキャンに合格した場合、システムはクラウドストレージにファイルを保存しなければならない
- ファイル処理が完了した場合、システムはアクセス可能なファイルURLを返さなければならない
- ファイルアップロードがサイズ制限を超える場合、システムは413エラーメッセージを返さなければならない
- ファイル処理が失敗した場合、システムはファイルを削除し、エラーをログに記録しなければならない
```

**APIインタラクション**:

```markdown
- APIリクエストを受信した場合、システムは認証トークンを検証しなければならない
- トークン検証に失敗した場合、システムは401 Unauthorizedエラーを返さなければならない
- レート制限を超えた場合、システムは429 Too Many Requestsエラーを返さなければならない
- データが正常に作成された場合、システムは201 Createdステータスと新しいリソースURLを返さなければならない
- サーバーエラーが発生した場合、システムは500 Internal Server Errorとエラー詳細をログに記録しなければならない
```

#### 高度なイベント駆動パターン

**複数のトリガー**:

```markdown
- ユーザーログインが失敗した場合、またはアカウントがロックされた場合、システムはセキュリティアラートを送信しなければならない
- ファイルアップロードが完了し、ウイルススキャンに合格した場合、システムはファイルを処理しなければならない
- 高CPU使用率が検出され、メモリ使用率が90%を超える場合、システムはリソースをスケールしなければならない
```

**カスケーディングイベント**:

```markdown
- ユーザー登録が完了した場合、システムはユーザープロファイルを作成し、ウェルカムメールを送信し、ユーザー設定を初期化しなければならない
- 支払いが処理された場合、システムはサブスクリプションを更新し、領収書を送信し、アクセスを延長しなければならない
- セキュリティインシデントが検出された場合、システムはイベントをログに記録し、管理者に通知し、インシデント対応をトリガーしなければならない
```

**複雑な条件**:

```markdown
- ユーザーが新しいデバイスからログインを試み、場所が通常と異なる場合、システムは追加の検証を要求しなければならない
- APIリクエストがレート制限を超え、ユーザーがプレミアムでない場合、システムはリクエストをスロットルしなければならない
- システム負荷が80%を超え、応答時間が5秒を超える場合、システムはキャッシングモードを有効にしなければならない
```

### パターン3: 状態駆動要件

**目的**: 特定の条件または状態の維持に依存するシステムの動作を定義します。

**構文**: `<条件>の間、システムは<動作>しなければならない`

**使用するタイミング**:

- 継続的な動作
- 状態依存の機能
- コンテキストアウェアな操作
- 進行中のシステム条件
- 永続的なモード

**構造**:

```
[状態/条件が存在する]間、システムは [継続的な動作] しなければならない [制約/詳細]
```

#### 例

**認証状態**:

```markdown
- ユーザーが認証されている間、システムは保護されたリソースへのアクセスを許可しなければならない
- ユーザーセッションがアクティブな間、システムはユーザーのコンテキストと設定を維持しなければならない
- 多要素認証が保留中の間、システムは機密操作を制限しなければならない
- パスワードリセットが進行中の間、システムは通常のログイン試行をブロックしなければならない
- アカウントが停止されている間、システムはすべてのアクセス試行を拒否しなければならない
```

**システムモード**:

```markdown
- メンテナンスモードがアクティブな間、システムは管理者アクセスのみを許可しなければならない
- 読み取り専用モードが有効な間、システムはすべての書き込み操作を拒否しなければならない
- デバッグモードがアクティブな間、システムは詳細な実行情報をログに記録しなければならない
- キャッシングモードが有効な間、システムは可能な場合はキャッシュから応答を提供しなければならない
- バックアップが進行中の間、システムは書き込み操作をキューに入れなければならない
```

**ビジネス条件**:

```markdown
- サブスクリプションがアクティブな間、システムはプレミアム機能を提供しなければならない
- トライアル期間がアクティブな間、システムはトライアル通知を表示しなければならない
- クォータ制限を超えている間、システムはAPIリクエストをスロットルしなければならない
- プロモーション期間がアクティブな間、システムは割引コードを適用しなければならない
- コンプライアンス監査が進行中の間、システムは強化されたログを有効にしなければならない
```

**リソース状態**:

```markdown
- ディスクスペースが10%未満の間、システムは管理者にアラートを送信しなければならない
- メモリ使用率が90%を超えている間、システムは頻繁にガベージコレクションを実行しなければならない
- ネットワークレイテンシーが高い間、システムは圧縮を有効にしなければならない
- データベース接続が枯渇している間、システムはリクエストをキューに入れなければならない
- CPU使用率が80%を超えて継続する間、システムは水平にスケールしなければならない
```

#### 高度な状態駆動パターン

**ネストされた状態**:

```markdown
- ユーザーが認証され、サブスクリプションがアクティブな間、システムは完全な機能アクセスを提供しなければならない
- システムがメンテナンスモードで、ユーザーが管理者の間、システムは読み取り専用アクセスを許可しなければならない
- レート制限がアクティブで、ユーザーがプレミアムの間、システムは緩和された制限を適用しなければならない
```

**状態遷移**:

```markdown
- ユーザーステータスが「保留中」の間、システムは毎週検証リマインダーを送信しなければならない
- 注文ステータスが「処理中」の間、システムは5分ごとに進捗を更新しなければならない
- デプロイメントステータスが「ローリング」の間、システムは徐々にトラフィックをシフトしなければならない
```

**条件付き永続性**:

```markdown
- 機能フラグが有効な間、システムは新しい認証フローを使用しなければならない
- A/Bテストがアクティブな間、システムはユーザーセグメントに基づいてトラフィックをルーティングしなければならない
- 移行が進行中の間、システムは古いデータ形式と新しいデータ形式の両方をサポートしなければならない
```

### パターン4: オプション要件

**目的**: 常に存在するとは限らない、ナイス・トゥ・ハブ機能または条件付き機能を定義します。

**構文**: `<条件が満たされる>場合、システムは<オプションの動作>してもよい`

**使用するタイミング**:

- オプション機能
- 設定依存の機能
- 強化の機会
- 将来の機能
- 条件付き動作

**構造**:

```
[条件が存在する]場合、システムは [オプションの動作] してもよい [実装の詳細]
```

#### 例

**機能フラグ**:

```markdown
- 多要素認証が有効な場合、システムは追加の検証を要求してもよい
- ソーシャルログインが設定されている場合、システムはOAuth認証をサポートしてもよい
- ベータ機能が有効な場合、システムは実験的な機能を提供してもよい
- 高度な分析が有効な場合、システムは詳細なユーザー行動を追跡してもよい
- AI推奨が利用可能な場合、システムはユーザーにコンテンツを提案してもよい
```

**設定オプション**:

```markdown
- メール通知が有効な場合、システムはリアルタイムアラートを送信してもよい
- キャッシングが設定されている場合、システムは頻繁にアクセスされるデータを保存してもよい
- バックアップ自動化が有効な場合、システムは毎日スナップショットを作成してもよい
- 監視がアクティブな場合、システムはパフォーマンスメトリクスを収集してもよい
- デバッグが有効な場合、システムは詳細な実行詳細をログに記録してもよい
```

**統合機能**:

```markdown
- サードパーティカレンダーが接続されている場合、システムはイベントを同期してもよい
- 決済ゲートウェイが利用可能な場合、システムはトランザクションを処理してもよい
- SMSサービスが設定されている場合、システムはテキストメッセージを送信してもよい
- ストレージプロバイダーが設定されている場合、システムはクラウドストレージを使用してもよい
- CDNが利用可能な場合、システムはエッジロケーションから静的アセットを提供してもよい
```

**強化機能**:

```markdown
- ユーザー設定が許可する場合、システムはコンテンツ推奨をパーソナライズしてもよい
- デバイス機能がサポートする場合、システムは高度な機能を有効にしてもよい
- ブラウザがサポートする場合、システムは最新のWeb APIを使用してもよい
- ネットワーク条件が許可する場合、システムは高品質メディアをロードしてもよい
- ユーザーの同意が提供される場合、システムは分析データを収集してもよい
```

#### 高度なオプションパターン

**複数の条件**:

```markdown
- ユーザーがプレミアムで、高度な機能が有効な場合、システムは優先サポートを提供してもよい
- モバイルアプリがインストールされ、プッシュ通知が有効な場合、システムはモバイルアラートを送信してもよい
- AI処理が利用可能で、ユーザーデータが十分な場合、システムはインサイトを生成してもよい
```

**階層的オプション**:

```markdown
- 基本検索が利用可能な場合、システムはテキスト検索を提供してもよい
- 高度な検索が有効な場合、システムはファセット検索を提供してもよい
- AI検索が設定されている場合、システムは自然言語クエリを提供してもよい
```

**段階的な強化**:

```markdown
- JavaScriptが有効な場合、システムはインタラクティブなインターフェースを提供してもよい
- WebAssemblyがサポートされている場合、システムはクライアント側の処理を使用してもよい
- Service Workerが利用可能な場合、システムはオフライン機能を有効にしてもよい
```

### パターン5: 望ましくない動作 (制約)

**目的**: システムが行うべきでないことを定義し、制約と制限を確立します。

**構文**: `システムは<望ましくない動作>してはならない` または `<パラメーター>は<制約>してはならない`

**使用するタイミング**:

- セキュリティ制約
- ビジネスルール
- 技術的制限
- 品質要件
- 規制コンプライアンス

**構造**:

```
システムは [禁止された動作] してはならない
[パラメーター] は [制約/制限] してはならない
```

#### 例

**セキュリティ制約**:

```markdown
- システムは、平文でパスワードを保存してはならない
- システムは、エラーメッセージで機密情報を明かしてはならない
- システムは、ユーザー入力でSQLインジェクションを許可してはならない
- システムは、暗号化されていない通信を受け入れてはならない
- システムは、ユーザーに内部システムの詳細を公開してはならない
```

**データ制約**:

```markdown
- ユーザーパスワードは、8文字未満であってはならない
- メールアドレスは、特殊文字を含んではならない
- ファイルアップロードは、サイズが100MBを超えてはならない
- APIリクエストは、1000レコードを超えて含んではならない
- セッショントークンは、24時間を超えて有効であってはならない
```

**パフォーマンス制約**:

```markdown
- 応答時間は、すべてのリクエストに対して5秒を超えてはならない
- データベースクエリは、2秒を超えて時間がかかってはならない
- ファイルアップロードは、30秒を超えて時間がかかってはならない
- ログインプロセスは、3秒を超えて時間がかかってはならない
- レポート生成は、10分を超えて時間がかかってはならない
```

**ビジネスルール**:

```markdown
- システムは、重複したメールアドレスを許可してはならない
- システムは、同じ資格情報での同時セッションを許可してはならない
- システムは、マイナスのアカウント残高を許可してはならない
- システムは、適切な認可なしに支払いを処理してはならない
- システムは、確認なしにユーザーデータを削除してはならない
```

**技術的制限**:

```markdown
- システムは、Internet Explorer 11をサポートしてはならない
- システムは、IPごとに1分間に1000リクエストを超えて処理してはならない
- システムは、ユーザーごとに1TBを超えるデータを保存してはならない
- システムは、利用可能なメモリより大きいファイルアップロードをサポートしてはならない
- システムは、データベース接続なしに機能してはならない
```

#### 高度な制約パターン

**条件付き制約**:

```markdown
- ユーザーがプレミアムでない場合、システムは1時間あたり100を超えるAPIアクセスレートを許可してはならない
- システムがメンテナンス中の場合、システムはすべての書き込み操作を許可してはならない
- コンプライアンスモードがアクティブな場合、システムは機密データをエクスポートしてはならない
```

**複雑な制約**:

```markdown
- システムは、過去5つのパスワード内でのパスワード再利用を許可してはならない
- システムは、同じユーザーからの5ファイルを超える同時アップロードを許可してはならない
- システムは、2年を超えて古いAPIバージョンをサポートしてはならない
```

**規制制約**:

```markdown
- システムは、明示的な同意なしに個人データを保存してはならない
- システムは、PCIコンプライアンスなしに支払いを処理してはならない
- システムは、適切な保護措置なしに国境を越えてデータを転送してはならない
- システムは、法的に必要な期間より長くデータを保持してはならない
```

## 高度なEARSテクニック

### パターンの組み合わせ

複雑な要件は、しばしば複数のEARSパターンを組み合わせます:

```markdown
# 例: 複雑な認証システム

## コア認証 (普遍的)
- システムは、メールとパスワードによるユーザー認証を提供しなければならない
- システムは、安全なセッション管理を維持しなければならない
- システムは、すべての認証試行をログに記録しなければならない

## ログイン動作 (イベント駆動)
- 有効な資格情報が提供された場合、システムはJWTトークンを発行しなければならない
- 無効な資格情報が提供された場合、システムは401エラーを返さなければならない
- 複数回の失敗試行が発生した場合、システムはレート制限を実装しなければならない

## セッション管理 (状態駆動)
- ユーザーが認証されている間、システムは保護されたリソースへのアクセスを許可しなければならない
- セッションがアクティブな間、システムはトークンを自動的に更新しなければならない
- セキュリティ脅威が検出された間、システムは再認証を要求しなければならない

## 強化機能 (オプション)
- 多要素認証が有効な場合、システムは追加の検証を要求しなければならない
- 生体認証が利用可能な場合、システムは指紋ログインをサポートしてもよい
- ソーシャルログインが設定されている場合、システムはOAuth認証を許可してもよい

## セキュリティ制約 (望ましくない動作)
- システムは、平文でパスワードを保存してはならない
- パスワードは、8文字未満であってはならない
- システムは、権限のないユーザーにアカウントの存在を明かしてはならない
```

### 定量的要件

EARSパターンは、測定可能な要件を表現できます:

```markdown
## パフォーマンス要件
- システムは、500ミリ秒以内(95パーセンタイル)にAPIリクエストに応答しなければならない
- データベースクエリは、200ミリ秒を超えて時間がかかってはならない
- ファイルアップロードは、サイズが10MBを超えてはならない
- システムは、1000の同時ユーザーをサポートしなければならない
- ログインプロセスは、3秒以内に完了しなければならない

## 可用性要件
- システムは、99.9%の稼働率を維持しなければならない
- スケジュールされたダウンタイムは、月に4時間を超えてはならない
- 復旧時間は、5分を超えてはならない
- データバックアップは、99.99%の成功率で毎日実行しなければならない
```

### 時間的要件

時間ベースの動作を表現します:

```markdown
## 時間ベースの動作
- ユーザーが30分間非アクティブな場合、システムはセッションをタイムアウトしなければならない
- パスワードリセットリンクが有効な間(24時間)、システムはパスワード変更を許可しなければならない
- トライアル期間がアクティブな場合(14日間)、システムはトライアル通知を表示しなければならない
- システムは、ログアウト後30日を超えてセッションデータを保持してはならない
- スケジュールされたメンテナンスが開始された場合(日曜日午前2時)、システムはメンテナンスモードに入らなければならない
```

### コンテキスト要件

コンテキストに依存する要件:

```markdown
## コンテキスト依存の動作
- ユーザーがモバイルデバイスの場合、システムはタッチ用にインターフェースを最適化しなければならない
- ネットワーク接続が遅い場合、システムは画像を圧縮しなければならない
- ユーザーが異なるタイムゾーンにいる場合、システムは現地時間を表示しなければならない
- ユーザーが読み取り専用モードの間、システムはデータ変更を防止しなければならない
- コンテンツが年齢制限されている場合、システムはアクセス前にユーザーの年齢を確認しなければならない
```

## 一般的なEARSの誤りとその修正方法

### 誤り1: パターンの混在

**❌ 誤り**:

```markdown
ユーザーがログインする場合、システムは弱いパスワードを許可してはならない
```

**✅ 正解**:

```markdown
ユーザーが弱いパスワードでログインを試みた場合、システムは認証を拒否しなければならない
パスワードは、8文字未満であってはならない
```

### 誤り2: あいまいな言語

**❌ 誤り**:

```markdown
システムは、高速でなければならない
```

**✅ 正解**:

```markdown
システムは、2秒以内にユーザーリクエストに応答しなければならない
```

### 誤り3: 1つのステートメントに複数の要件

**❌ 誤り**:

```markdown
ユーザーが登録する場合、システムはアカウントを作成し、ウェルカムメールを送信し、デフォルト設定を設定しなければならない
```

**✅ 正解**:

```markdown
ユーザー登録が完了した場合、システムはユーザーアカウントを作成しなければならない
ユーザーアカウントが作成された場合、システムはウェルカムメールを送信しなければならない
ウェルカムメールが送信された場合、システムはデフォルトのユーザー設定を設定しなければならない
```

### 誤り4: エラー条件の欠落

**❌ 誤り**:

```markdown
ユーザーが有効な資格情報を送信した場合、システムはユーザーを認証しなければならない
```

**✅ 正解**:

```markdown
有効な資格情報が提供された場合、システムはユーザーを認証しなければならない
無効な資格情報が提供された場合、システムは401エラーを返さなければならない
認証サービスが利用できない場合、システムは503エラーを返さなければならない
```

### 誤り5: 要件内の実装の詳細

**❌ 誤り**:

```markdown
システムは、PostgreSQLのusersテーブルでパスワードをハッシュ化するためにbcryptを12ラウンドで使用しなければならない
```

**✅ 正解**:

```markdown
システムは、最小12ラウンドの安全なアルゴリズムを使用してパスワードをハッシュ化しなければならない
システムは、データベースにパスワードハッシュを安全に保存しなければならない
```

## EARS検証と品質保証

### 自動検証

MoAI-ADKは、EARS構文を検証するツールを提供します:

```bash
# SPEC構文を検証
moai-adk validate-ears .moai/specs/SPEC-AUTH-001/spec.md

# EARSパターン準拠をチェック
moai-adk check-ears-patterns .moai/specs/

# EARS品質レポートを生成
moai-adk ears-quality-report
```

### 品質チェックリスト

各要件について、以下を確認してください:

**パターン準拠**:

- [ ] 要件タイプに対して正しいEARSパターンを使用している
- [ ] 指定された構文構造に従っている
- [ ] 適切なトリガー/条件を含んでいる
- [ ] 明確な応答/動作を指定している

**明確性と精度**:

- [ ] 言語があいまいでない
- [ ] 技術用語が定義されている
- [ ] 測定が定量化されている
- [ ] スコープが明確に境界づけられている

**テスト可能性**:

- [ ] 成功基準が定義されている
- [ ] テストシナリオを作成できる
- [ ] 期待される結果が指定されている
- [ ] エッジケースが考慮されている

**完全性**:

- [ ] すべての機能側面がカバーされている
- [ ] エラー条件が含まれている
- [ ] パフォーマンス要件が指定されている
- [ ] セキュリティの考慮事項が対処されている

### レビュープロセス

1. **セルフレビュー**: 著者がEARS準拠をチェック
2. **ピアレビュー**: チームメンバーが構文と明確性を検証
3. **エキスパートレビュー**: ドメインエキスパートが完全性を確認
4. **自動チェック**: ツールが構文とパターンを検証
5. **最終承認**: ステークホルダーが要件にサインオフ

## 実世界のEARS例

### Eコマースシステム

```markdown
# @SPEC:ECOM-001: ショッピングカート管理

## コア機能 (普遍的)
- システムは、セッション間でショッピングカートの状態を維持しなければならない
- システムは、税金と送料を含むカートの合計を計算しなければならない
- システムは、カートに追加する前に製品の可用性を検証しなければならない
- システムは、複数の支払い方法をサポートしなければならない
- システムは、注文確認と追跡を提供しなければならない

## カート操作 (イベント駆動)
- ユーザーがカートにアイテムを追加した場合、システムは在庫を更新し、合計を再計算しなければならない
- ユーザーがカートからアイテムを削除した場合、システムは在庫を解放し、合計を更新しなければならない
- ユーザーが割引コードを適用した場合、システムは検証し、有効な場合は割引を適用しなければならない
- ユーザーがチェックアウトに進む場合、システムはカートを検証し、支払いにリダイレクトしなければならない
- 支払いが成功した場合、システムは注文を作成し、カートをクリアしなければならない

## セッション管理 (状態駆動)
- カートにアイテムが含まれている間、システムは30日間カートデータを保持しなければならない
- ユーザーが認証されている間、システムはゲストカートをユーザーカートとマージしなければならない
- チェックアウトが進行中の間、システムはカートの内容をロックしなければならない
- 支払いが処理されている間、システムは支払いステータスを表示しなければならない

## 強化機能 (オプション)
- ウィッシュリストが有効な場合、システムは後で保存するためのアイテムを許可しなければならない
- 推奨が利用可能な場合、システムは関連製品を提案してもよい
- ゲストチェックアウトが有効な場合、システムはアカウントなしで購入を許可してもよい
- ロイヤルティプログラムがアクティブな場合、システムはリワードポイントを適用しなければならない

## ビジネス制約 (望ましくない動作)
- システムは、空のカートでチェックアウトを許可してはならない
- システムは、期限切れの割引コードを適用してはならない
- システムは、在庫切れのアイテムを販売してはならない
- カートは、100アイテムを超えてはならない
- システムは、PCIコンプライアンスなしに支払い情報を保存してはならない
```

### IoTデバイス管理

```markdown
# @SPEC:IOT-001: デバイス監視と制御

## コア監視 (普遍的)
- システムは、すべての登録デバイスの接続ステータスを維持しなければならない
- システムは、設定された間隔でデバイスからテレメトリデータを収集しなければならない
- システムは、デバイスイベントを処理し、適切なアラートを生成しなければならない
- システムは、デバイスの健全性メトリクスとダッシュボードを提供しなければならない
- システムは、安全なデバイス認証と認可をサポートしなければならない

## デバイスイベント (イベント駆動)
- デバイスが重大なエラーを報告した場合、システムは即座に管理者にアラートを送信しなければならない
- デバイスがオフラインになった場合、システムは指数バックオフで再接続試行を開始しなければならない
- ファームウェアアップデートが利用可能な場合、システムはデバイスに通知し、アップデートをスケジュールしなければならない
- デバイスの閾値を超えた場合、システムはアラートをトリガーし、是正措置を取らなければならない
- デバイス証明書が期限切れになる場合、システムは接続をブロックし、更新を要求しなければならない

## 接続管理 (状態駆動)
- デバイスが接続されている間、システムは双方向通信を維持しなければならない
- デバイスがメンテナンスモードの間、システムはコマンドを後で実行するためにキューに入れなければならない
- ネットワーク接続が不安定な間、システムはデータをバッファリングし、可能なときに同期しなければならない
- ファームウェアアップデートが進行中の間、システムは進捗を監視し、失敗を処理しなければならない

## 高度な機能 (オプション)
- 予測メンテナンスが有効な場合、システムはデバイスパターンを分析し、故障を予測してもよい
- エッジコンピューティングが利用可能な場合、システムはデバイス上でローカルにデータを処理してもよい
- 機械学習モデルがデプロイされている場合、システムは異常検出を提供してもよい
- デジタルツインが設定されている場合、システムはデバイスの動作をシミュレートしてもよい

## 技術的制約 (望ましくない動作)
- システムは、権限のないデバイスからの接続を受け入れてはならない
- デバイスデータは、設定された保持期間より長く保持されてはならない
- システムは、1秒間に10,000イベントを超えて処理してはならない
- デバイス接続は、最大帯域幅制限を超えてはならない
- システムは、ログまたはエラーメッセージでデバイスの資格情報を公開してはならない
```

## ツールとリソース

### EARSテンプレート

MoAI-ADKは、ドメイン固有のEARSテンプレートを提供します:

```markdown
# APIエンドポイントテンプレート
[HTTPメソッド]が[エンドポイント]にリクエストされた場合、システムは[応答]しなければならない
[条件]が存在する間、システムは[動作]しなければならない
[機能]が有効な場合、システムは[オプションの動作]してもよい
システムは[制約]してはならない
```

### トレーニングと練習

**EARS記述演習**:

1. 非公式な要件をEARS形式に変換する
2. 異なる要件タイプに対して適切なパターンを特定する
3. 複雑なシナリオのためにパターンを組み合わせる練習をする
4. 既存の仕様をレビューして改善する

**練習のための一般的なシナリオ**:

- ユーザー登録と認証
- APIエンドポイント設計
- データベース操作
- ファイルアップロードと処理
- 支払い処理
- 通知システム
- 検索機能
- レポートと分析

EARS構文をマスターすることで、成功したソフトウェア開発の基盤となる明確で、あいまいさのない、テスト可能な要件を記述できるようになります。これらのパターンを練習すれば、仕様記述で自然に使えるようになります! 🎯
