# MoAI-ADK Tool Permissions
# Single Source of Truth for tool access permissions by category
# Version: 1.0.0
# Last Updated: 2026-01-22

---
permissions:
  version: "1.0.0"
  description: "Tool access permissions for skill categories"
  purpose: "Define allowed tools based on skill category and use case"

# Tool Definitions
tools:
  read_only:
    tools:
      - "Read"
      - "Grep"
      - "Glob"
    description: "Non-destructive information gathering tools"

  read_write:
    tools:
      - "Read"
      - "Write"
      - "Edit"
      - "Grep"
      - "Glob"
    description: "File modification tools"

  development:
    tools:
      - "Read"
      - "Write"
      - "Edit"
      - "Grep"
      - "Glob"
      - "Bash"
      - "TodoWrite"
    description: "Full development toolkit"

  documentation:
    tools:
      - "Read"
      - "Grep"
      - "Glob"
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
    description: "Documentation and reference tools"

# Category Permissions
category_permissions:
  foundation:
    always_allowed:
      - "Read"
      - "Grep"
      - "Glob"
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
    conditional:
      - tool: "Write"
        requires: "modularized=true"
        reason: "Foundation skills with modularized content can write reference files"
      - tool: "Edit"
        requires: "modularized=true"
        reason: "Foundation skills with modularized content can edit reference files"
    never_allowed:
      - "Bash"
      - "Task"
    description: "Foundation skills provide reference information only"

  workflow:
    always_allowed:
      - "Read"
      - "Write"
      - "Edit"
      - "Grep"
      - "Glob"
      - "Bash"
      - "TodoWrite"
    conditional:
      - tool: "AskUserQuestion"
        requires: "Alfred only"
        reason: "Only Alfred can ask questions, subagents cannot"
      - tool: "Task"
        requires: "Manager agents only"
        reason: "Manager agents can delegate to other agents"
    never_allowed: []
    description: "Workflow skills orchestrate development processes"

  domain:
    always_allowed:
      - "Read"
      - "Grep"
      - "Glob"
      - "Bash"
    conditional:
      - tool: "Write"
        requires: "Implementation task"
        reason: "Domain skills can write when implementing features"
      - tool: "Edit"
        requires: "Implementation task"
        reason: "Domain skills can edit when implementing features"
    never_allowed:
      - "AskUserQuestion"
      - "Task"
    description: "Domain skills provide specialized expertise"

  language:
    always_allowed:
      - "Read"
      - "Grep"
      - "Glob"
      - "Bash"
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
    conditional:
      - tool: "Write"
        requires: "Implementation task"
        reason: "Language skills can write when implementing code"
      - tool: "Edit"
        requires: "Implementation task"
        reason: "Language skills can edit when modifying code"
      - tool: "TodoWrite"
        requires: "Complex multi-step task"
        reason: "Language skills can track tasks for complex implementations"
    never_allowed:
      - "AskUserQuestion"
      - "Task"
    description: "Language skills provide programming language expertise"

  platform:
    always_allowed:
      - "Read"
      - "Grep"
      - "Glob"
      - "Bash"
    conditional:
      - tool: "Write"
        requires: "Configuration task"
        reason: "Platform skills can write configuration files"
      - tool: "Edit"
        requires: "Configuration task"
        reason: "Platform skills can edit configuration files"
      - tool: "TodoWrite"
        requires: "Multi-step setup"
        reason: "Platform skills can track setup tasks"
    never_allowed:
      - "AskUserQuestion"
      - "Task"
    description: "Platform skills provide platform-specific integration"

  library:
    always_allowed:
      - "Read"
      - "Grep"
      - "Glob"
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
    conditional: []
    never_allowed:
      - "Write"
      - "Edit"
      - "Bash"
      - "TodoWrite"
      - "AskUserQuestion"
      - "Task"
    description: "Library skills provide reference information only"

  tool:
    always_allowed:
      - "Read"
      - "Grep"
      - "Glob"
      - "Bash"
    conditional:
      - tool: "Write"
        requires: "Tool-specific task"
        reason: "Tool skills can write when executing tool-specific operations"
      - tool: "Edit"
        requires: "Tool-specific task"
        reason: "Tool skills can edit when executing tool-specific operations"
    never_allowed:
      - "AskUserQuestion"
      - "Task"
    description: "Tool skills provide tool-specific expertise"

# Special Permissions
special_permissions:
  alfred_only:
    tools:
      - "AskUserQuestion"
    reason: "Only Alfred can interact with users directly"
    context: "Subagents operate in isolated contexts and cannot ask questions"

  manager_agents:
    tools:
      - "Task"
    reason: "Manager agents can delegate to specialized agents"
    agents:
      - "manager-spec"
      - "manager-ddd"
      - "manager-docs"
      - "manager-quality"
      - "manager-strategy"
      - "manager-git"
      - "manager-project"

  mcp_tools:
    tools:
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
      - "mcp__sequential-thinking__sequentialthinking"
    reason: "MCP tools require special permissions"
    categories:
      - "foundation"
      - "language"
      - "library"

# Language-Specific Additions
language_additions:
  python:
    additional_tools:
      - "Bash"
    reason: "Python development requires running tests, linting, type checking"
    use_cases:
      - "pytest: Run test suite"
      - "ruff: Run linter"
      - "mypy: Run type checker"
      - "black: Format code"
      - "isort: Sort imports"

  typescript:
    additional_tools:
      - "Bash"
    reason: "TypeScript development requires running tests, linting, type checking"
    use_cases:
      - "npm test: Run test suite"
      - "eslint: Run linter"
      - "tsc: Run type checker"
      - "prettier: Format code"

  go:
    additional_tools:
      - "Bash"
    reason: "Go development requires running tests, building, vetting"
    use_cases:
      - "go test: Run test suite"
      - "go vet: Run code analysis"
      - "go build: Build binary"
      - "gofmt: Format code"

  java:
    additional_tools:
      - "Bash"
    reason: "Java development requires running tests, building, static analysis"
    use_cases:
      - "mvn test: Run test suite"
      - "spotbugs: Run static analysis"
      - "mvn compile: Build project"
      - "checkstyle: Check code style"

# Permission Validation
permission_validation:
  rules:
    - "Foundation skills never have Bash access"
    - "Library skills never have Write/Edit access"
    - "Only Alfred can use AskUserQuestion"
    - "Only manager agents can use Task"
    - "MCP tools restricted to specific categories"

  validation_checks:
    - "Check skill category matches allowed tools"
    - "Verify conditional tool requirements met"
    - "Ensure never_allowed tools not present"
    - "Validate special permissions properly assigned"

# Examples
examples:
  foundation_skill:
    skill: "moai-foundation-core"
    category: "foundation"
    allowed_tools:
      - "Read"
      - "Grep"
      - "Glob"
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
    not_allowed:
      - "Write"
      - "Edit"
      - "Bash"
      - "TodoWrite"
      - "AskUserQuestion"
      - "Task"

  workflow_skill:
    skill: "moai-workflow-spec"
    category: "workflow"
    allowed_tools:
      - "Read"
      - "Write"
      - "Edit"
      - "Grep"
      - "Glob"
      - "Bash"
      - "TodoWrite"
    not_allowed:
      - "AskUserQuestion"
      - "Task"

  language_skill:
    skill: "moai-lang-python"
    category: "language"
    allowed_tools:
      - "Read"
      - "Grep"
      - "Glob"
      - "Bash"
      - "mcp__context7__resolve-library-id"
      - "mcp__context7__get-library-docs"
    not_allowed:
      - "AskUserQuestion"
      - "Task"

  platform_skill:
    skill: "moai-platform-auth0"
    category: "platform"
    allowed_tools:
      - "Read"
      - "Grep"
      - "Glob"
      - "Bash"
      - "Write"
      - "Edit"
    not_allowed:
      - "AskUserQuestion"
      - "Task"

# Migration Guide
migration:
  from_unrestricted:
    description: "Converting unrestricted skills to category-based permissions"
    steps:
      - "Identify skill category"
      - "Apply category permissions template"
      - "Remove never_allowed tools"
      - "Add conditional tool requirements"
      - "Validate permission compliance"
      - "Test with restricted tool access"

  from_custom:
    description: "Migrating custom tool permissions to standard categories"
    steps:
      - "Review current tool permissions"
      - "Identify closest standard category"
      - "Apply category permissions"
      - "Add custom conditional permissions"
      - "Document custom permission rationale"
      - "Validate against permission rules"

# Best Practices
best_practices:
  permission_granting:
    - "Use minimum required permissions"
    - "Prefer read-only tools when possible"
    - "Add write tools only when necessary"
    - "Document permission requirements"
    - "Review permissions periodically"

  tool_usage:
    - "Prefer Edit over Bash for file modifications"
    - "Use Read before Write/Edit operations"
    - "Limit Bash to execution-only tasks"
    - "Use Grep/Glob for file discovery"
    - "Respect never_allowed restrictions"

  validation:
    - "Validate skill permissions on load"
    - "Check tool access before use"
    - "Log permission violations"
    - "Report invalid configurations"
    - "Maintain permission audit trail"
