{
  "schema_version": "2.0",
  "policy_mode": "deduplication",
  "effective_date": "2025-11-06",
  "gpt5_pro_analysis": {
    "duplicate_types": {
      "topline": {
        "allowed": false,
        "description": "Primary topline tags must be unique across all files",
        "severity": "critical",
        "action": "auto_renumber_or_remove"
      },
      "reference": {
        "allowed": true,
        "description": "References in documentation, examples, tutorials are allowed",
        "severity": "info",
        "action": "track_only"
      },
      "scope": {
        "allowed": "conditional",
        "description": "Package-specific scoping allowed with domain prefix",
        "severity": "warning",
        "action": "validate_domain"
      }
    },
    "primary_related_rules": {
      "primary_per_id": "Each ID can have only one primary topline file",
      "related_unlimited": "Related references unlimited",
      "auto_primary_selection": "Choose most authoritative file as primary"
    },
    "monorepo_scoping": {
      "enabled": true,
      "pattern": "<package>#<domain>-<counter>",
      "examples": [
        "auth#AUTH-001",
        "user#USER-001", 
        "payment#PAY-001"
      ],
      "domain_separation": true
    },
    "exception_whitelist": {
      "paths": [
        "generated/**",
        "examples/**", 
        "docs/guides/**",
        "docs/getting-started/**",
        "templates/**",
        "**.template.*"
      ],
      "reason": "Educational and template content allowed to have example tags"
    }
  },
  "deduplication_strategy": {
    "auto_detection": {
      "enabled": true,
      "scan_frequency": "on_commit",
      "confidence_threshold": 0.9
    },
    "auto_correction": {
      "enabled": true,
      "dry_run_default": true,
      "backup_required": true,
      "approval_required": true
    },
    "primary_selection_algorithm": {
      "criteria": [
        {"factor": "file_authority", "weight": 0.4},
        {"factor": "tag_position", "weight": 0.3}, 
        {"factor": "file_depth", "weight": 0.2},
        {"factor": "creation_date", "weight": 0.1}
      ],
      "authority_hierarchy": {
        "highest": [".moai/specs/*/spec.md"],
        "high": ["src/**/*.py", "tests/**/*.py"],
        "medium": ["docs/api/**/*.md", "docs/reference/**/*.md"],
        "low": ["docs/guides/**", "examples/**", "templates/**"]
      }
    }
  },
  "validation_rules": {
    "topline_uniqueness": {
      "rule": "No duplicate topline tags across authority hierarchy",
      "check_method": "scan_first_20_lines",
      "exclusions": ["whitelisted_paths", "example_blocks"]
    },
    "chain_integrity": {
      "rule": "SPEC → TEST → CODE → DOC chains must remain intact",
      "validation": "bidirectional_link_check",
      "auto_fix": "update_related_references"
    },
    "scope_validation": {
      "rule": "Package-specific tags must use domain scoping",
      "pattern_check": "^[A-Z]+#[A-Z]+-[0-9]{3}$",
      "auto_prefix": true
    }
  },
  "implementation_phases": {
    "phase_1": {
      "name": "Policy Update",
      "duration": "1-2 days",
      "tasks": [
        "Update tag-policy.json with new rules",
        "Create de-duplication scripts",
        "Configure validation hooks",
        "Document new policies"
      ]
    },
    "phase_2": {
      "name": "Batch Cleanup", 
      "duration": "3-5 days",
      "tasks": [
        "Scan and identify all duplicates",
        "Generate correction plan",
        "Apply corrections with approval",
        "Validate chain integrity"
      ]
    },
    "phase_3": {
      "name": "Operational Mode",
      "duration": "ongoing",
      "tasks": [
        "Enable real-time validation",
        "Monitor tag system health",
        "Continuous improvement",
        "User training and support"
      ]
    }
  },
  "rollback_plan": {
    "enabled": true,
    "backup_strategy": "git_tag_before_changes",
    "rollback_triggers": [
      "critical_chain_breakage",
      "validation_errors > 10%",
      "user_complaints > 5"
    ],
    "recovery_procedures": [
      "restore_from_git_tag",
      "revalidate_all_chains", 
      "notify_stakeholders",
      "document_incident"
    ]
  },
  "metrics": {
    "success_criteria": {
      "duplicate_reduction": "95% of duplicates eliminated",
      "chain_integrity": "100% of chains intact",
      "validation_time": "< 5 seconds per scan",
      "user_satisfaction": "> 90% positive feedback"
    },
    "monitoring": {
      "daily_scan_results": true,
      "weekly_health_report": true,
      "monthly_trend_analysis": true,
      "quarterly_policy_review": true
    }
  }
}
