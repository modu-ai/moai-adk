#!/bin/bash
# MoAI-ADK Weekly Session Analysis Script
# Claude Code ì„¸ì…˜ ë¡œê·¸ë¥¼ ì£¼ê°„ ë¶„ì„í•˜ê³  ë³´ê³ ì„œ ìƒì„±

set -e

PROJECT_ROOT=$(git rev-parse --show-toplevel)
cd "$PROJECT_ROOT"

# ìƒ‰ìƒ ì •ì˜
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}ğŸ“Š MoAI-ADK Weekly Session Analysis${NC}"
echo "=================================================="
echo "Project: $PROJECT_ROOT"
echo "Date: $(date)"
echo "=================================================="

# 1. ì„¸ì…˜ ë¶„ì„ ì‹¤í–‰
echo -e "${BLUE}ğŸ” Running session analysis...${NC}"

REPORT_DIR=".moai/reports"
mkdir -p "$REPORT_DIR"

python3 .moai/scripts/session_analyzer.py \
  --days 7 \
  --output "$REPORT_DIR/weekly-$(date +%Y-%m-%d).md" \
  --verbose

echo -e "${GREEN}âœ… Analysis complete${NC}"

# 2. ë³€ê²½ì‚¬í•­ í™•ì¸
echo ""
echo -e "${BLUE}ğŸ” Checking for changes...${NC}"

if git diff --quiet HEAD "$REPORT_DIR/"; then
  echo -e "${YELLOW}âš ï¸  No changes to commit${NC}"
  exit 0
fi

# 3. ë³€ê²½ì‚¬í•­ ì»¤ë°‹
echo -e "${BLUE}ğŸ“ Committing changes...${NC}"

git add "$REPORT_DIR/"

git commit -m "$(cat <<'EOF'
ğŸ“Š Weekly session meta-analysis report

Generated by automated weekly analysis script.
Analyzing: Claude Code session logs from ~/.claude/projects/

Review improvements and update:
- .claude/settings.json (permissions)
- CLAUDE.md (rules and guidelines)
- .claude/hooks/ (hook logic)

ğŸ¤– Generated with Claude Code

Co-Authored-By: MoAI-ADK <moai@example.com>
EOF
)" || echo -e "${YELLOW}âš ï¸  Commit failed (might be empty)${NC}"

echo -e "${GREEN}âœ… Analysis and commit complete${NC}"
echo ""
echo -e "${BLUE}ğŸ“„ Report location: $REPORT_DIR/weekly-$(date +%Y-%m-%d).md${NC}"
