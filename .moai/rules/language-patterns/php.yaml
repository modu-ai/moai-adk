# PHP Language Patterns
# Common patterns for PHP 8.3+ development
# Version: 1.0.0
# Last Updated: 2026-01-23

---
language: "php"
version: "8.3+"
description: "Common patterns for modern PHP development"

# Language Features
features:
  readonly_classes:
    name: "Readonly Classes"
    description: "Immutable class declaration"
    example: |
      readonly class User
      {
          public function __construct(
              public int $id,
              public string $name,
              public string $email,
          ) {}
      }

  enums:
    name: "Enums with Methods"
    description: "Rich enum types"
    example: |
      enum Status: string
      {
          case Pending = 'pending';
          case Active = 'active';
          case Suspended = 'suspended';

          public function label(): string
          {
              return match($this) {
                  self::Pending => 'Awaiting Approval',
                  self::Active => 'Active User',
                  self::Suspended => 'Account Suspended',
              };
          }

          public function canLogin(): bool
          {
              return $this === self::Active;
          }
      }

  attributes:
    name: "Attributes"
    description: "Metadata annotations"
    example: |
      #[Route('/users/{id}', methods: ['GET'])]
      #[Middleware('auth')]
      public function show(int $id): Response
      {
          return new JsonResponse($this->userService->find($id));
      }

# Web Framework Patterns
web_frameworks:
  laravel:
    name: "Laravel 11"
    patterns:
      eloquent:
        description: "Eloquent ORM patterns"
        example: |
          class User extends Model
          {
              protected $fillable = ['name', 'email'];
              protected $casts = [
                  'email_verified_at' => 'datetime',
                  'settings' => 'array',
              ];

              public function posts(): HasMany
              {
                  return $this->hasMany(Post::class);
              }

              public function scopeActive(Builder $query): void
              {
                  $query->where('status', 'active');
              }
          }

      service_pattern:
        description: "Service class pattern"
        example: |
          readonly class UserService
          {
              public function __construct(
                  private UserRepository $repository,
                  private EventDispatcher $events,
              ) {}

              public function create(CreateUserDTO $dto): User
              {
                  $user = $this->repository->create($dto->toArray());
                  $this->events->dispatch(new UserCreated($user));
                  return $user;
              }
          }

      api_resources:
        description: "API Resource transformation"
        example: |
          class UserResource extends JsonResource
          {
              public function toArray(Request $request): array
              {
                  return [
                      'id' => $this->id,
                      'name' => $this->name,
                      'email' => $this->email,
                      'posts' => PostResource::collection($this->whenLoaded('posts')),
                      'created_at' => $this->created_at->toIso8601String(),
                  ];
              }
          }

  symfony:
    name: "Symfony 7"
    patterns:
      controller:
        description: "Modern controller pattern"
        example: |
          #[Route('/api/users')]
          class UserController extends AbstractController
          {
              public function __construct(
                  private readonly UserRepository $repository,
              ) {}

              #[Route('/{id}', methods: ['GET'])]
              public function show(int $id): JsonResponse
              {
                  $user = $this->repository->find($id)
                      ?? throw $this->createNotFoundException();

                  return $this->json($user);
              }
          }

# Testing Patterns
testing:
  pest:
    name: "Pest PHP"
    patterns:
      feature_test:
        description: "Feature testing pattern"
        example: |
          describe('User API', function () {
              it('can create a user', function () {
                  $response = post('/api/users', [
                      'name' => 'John Doe',
                      'email' => 'john@example.com',
                  ]);

                  $response->assertStatus(201)
                      ->assertJson(['name' => 'John Doe']);

                  expect(User::count())->toBe(1);
              });

              it('validates required fields', function () {
                  post('/api/users', [])
                      ->assertStatus(422)
                      ->assertJsonValidationErrors(['name', 'email']);
              });
          });

# Best Practices
best_practices:
  code_style:
    - "Use PHP-CS-Fixer or PHP_CodeSniffer"
    - "Use PHPStan or Psalm for static analysis"
    - "Prefer readonly classes for DTOs"
    - "Use constructor property promotion"

  patterns:
    - "Use dependency injection"
    - "Use service classes for business logic"
    - "Use DTOs for data transfer"
    - "Use repositories for data access"
