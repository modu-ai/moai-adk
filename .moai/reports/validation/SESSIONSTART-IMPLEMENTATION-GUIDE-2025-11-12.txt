CLAUDE CODE SESSIONSTART í›… - SUPPRESS í”Œë˜ê·¸ êµ¬í˜„ ê°€ì´ë“œ
=======================================================
ì‘ì„±ì¼: 2025-11-12
ëŒ€ìƒ: session_start__*.py íŒŒì¼ì˜ config í”Œë˜ê·¸ ì—°ë™

## ê°œìš”

Claude Codeì˜ SessionStart í›…ì´ .moai/config/config.jsonì˜
session.suppress_setup_messages í”Œë˜ê·¸ë¥¼ ì¡´ì¤‘í•˜ë„ë¡ êµ¬í˜„í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

## ë¬¸ì œ

í˜„ì¬ ìƒíƒœ:
1. .moai/config/config.jsonì— suppress_setup_messages í”Œë˜ê·¸ ì¡´ì¬
2. SessionStart í›… ì‹¤í–‰ ì‹œ í”Œë˜ê·¸ë¥¼ ë¬´ì‹œí•˜ê³  í•­ìƒ ë©”ì‹œì§€ í‘œì‹œ

ì˜ˆìƒ ë™ì‘:
- suppress_setup_messages = false: ë©”ì‹œì§€ í•­ìƒ í‘œì‹œ
- suppress_setup_messages = true: ë©”ì‹œì§€ ìƒëµ (7ì¼ ì´ˆê³¼ ì‹œ ë‹¤ì‹œ í‘œì‹œ)

## ì†”ë£¨ì…˜ ì•„í‚¤í…ì²˜

### 1. ìˆ˜ì •í•  íŒŒì¼

íŒŒì¼ 1: /Users/goos/MoAI/MoAI-ADK/.claude/hooks/alfred/session_start__show_project_info.py

ë³€ê²½ ì‚¬í•­:
- should_show_setup_messages() í•¨ìˆ˜ ì¶”ê°€
- main()ì—ì„œ í”Œë˜ê·¸ í™•ì¸ í›„ ì¡°ê±´ë¶€ ë©”ì‹œì§€ ìƒì„±

íŒŒì¼ 2: /Users/goos/MoAI/MoAI-ADK/.claude/hooks/alfred/session_start__config_health_check.py

ë³€ê²½ ì‚¬í•­:
- should_suppress_setup() í•¨ìˆ˜ ì¶”ê°€
- should_update ë¡œì§ ìˆ˜ì •í•˜ì—¬ í”Œë˜ê·¸ í™•ì¸

### 2. êµ¬í˜„ ìƒì„¸ - session_start__show_project_info.py

ì¶”ê°€í•  í•¨ìˆ˜ (SessionStart.mdì˜ ë¡œì§ ë™ì¼):

```python
def should_show_setup_messages() -> bool:
    """
    Determine whether to show setup completion messages.

    Logic:
    1. Read .moai/config/config.json
    2. Check session.suppress_setup_messages flag
    3. If suppress_setup_messages is False, always show messages
    4. If suppress_setup_messages is True:
       - Check if more than 7 days have passed since suppression
       - Show messages if time threshold exceeded

    Returns:
        bool: True if messages should be shown, False otherwise
    """
    from datetime import datetime

    config_path = Path(".moai/config/config.json")

    # If config doesn't exist, show messages
    if not config_path.exists():
        return True

    try:
        with open(config_path) as f:
            config = json.load(f)
    except (json.JSONDecodeError, IOError):
        # If config can't be read, show messages
        return True

    # Check project initialization status
    if not config.get("project", {}).get("initialized", False):
        return True

    # Check suppress_setup_messages flag
    session_config = config.get("session", {})
    suppress = session_config.get("suppress_setup_messages", False)

    if not suppress:
        # Flag is False, show messages
        return True

    # Flag is True, check time threshold (7 days)
    suppressed_at_str = session_config.get("setup_messages_suppressed_at")
    if not suppressed_at_str:
        # No timestamp recorded, show messages
        return True

    try:
        suppressed_at = datetime.fromisoformat(suppressed_at_str)
        now = datetime.now(suppressed_at.tzinfo) if suppressed_at.tzinfo else datetime.now()
        days_passed = (now - suppressed_at).days

        # Show messages if more than 7 days have passed
        return days_passed >= 7
    except (ValueError, TypeError):
        # If timestamp is invalid, show messages
        return True
```

main() í•¨ìˆ˜ ìˆ˜ì •:

í˜„ì¬ ì½”ë“œ:
```python
def main() -> None:
    ...
    try:
        input_data = sys.stdin.read()
        _data = json.loads(input_data) if input_data.strip() else {}

        session_output = format_session_output()

        result: dict[str, Any] = {
            "continue": True,
            "systemMessage": session_output
        }

        print(json.dumps(result))
        sys.exit(0)
    ...
```

ìˆ˜ì •ëœ ì½”ë“œ:
```python
def main() -> None:
    ...
    try:
        input_data = sys.stdin.read()
        _data = json.loads(input_data) if input_data.strip() else {}

        # Check if setup messages should be shown
        show_messages = should_show_setup_messages()

        # Generate session output conditionally
        session_output = format_session_output() if show_messages else ""

        result: dict[str, Any] = {
            "continue": True,
            "systemMessage": session_output
        }

        print(json.dumps(result))
        sys.exit(0)
    ...
```

### 3. êµ¬í˜„ ìƒì„¸ - session_start__config_health_check.py

ì¶”ê°€í•  í•¨ìˆ˜:

```python
def should_suppress_setup() -> bool:
    """
    Determine whether setup messages should be suppressed.

    Returns:
        bool: True if setup should be suppressed, False otherwise
    """
    from datetime import datetime

    config = get_config_data()
    if not config:
        # No config, don't suppress
        return False

    session_config = config.get("session", {})
    suppress = session_config.get("suppress_setup_messages", False)

    if not suppress:
        # Flag is False, don't suppress
        return False

    # Flag is True, check time threshold (7 days)
    suppressed_at_str = session_config.get("setup_messages_suppressed_at")
    if not suppressed_at_str:
        # No timestamp, suppress
        return True

    try:
        suppressed_at = datetime.fromisoformat(suppressed_at_str)
        now = datetime.now(suppressed_at.tzinfo) if suppressed_at.tzinfo else datetime.now()
        days_passed = (now - suppressed_at).days

        # Suppress if less than 7 days have passed
        return days_passed < 7
    except (ValueError, TypeError):
        # If timestamp is invalid, don't suppress (show messages)
        return False
```

main() í•¨ìˆ˜ ìˆ˜ì •:

í˜„ì¬ ì½”ë“œ:
```python
def main() -> None:
    try:
        input_data = sys.stdin.read()
        _data = json.loads(input_data) if input_data.strip() else {}

        config_report = generate_config_report()

        system_message = f"ğŸ“‹ Configuration Health Check:\n{config_report}"

        if should_update:
            system_message += "\n\nâš ï¸  Configuration issues detected. Please take action."

        result: dict[str, Any] = {
            "continue": True,
            "systemMessage": system_message
        }

        if should_update:
            question_data = { ... }
            result["askUserQuestion"] = question_data

        print(json.dumps(result))
        sys.exit(0)
    ...
```

ìˆ˜ì •ëœ ì½”ë“œ:
```python
def main() -> None:
    try:
        input_data = sys.stdin.read()
        _data = json.loads(input_data) if input_data.strip() else {}

        # Check if setup messages should be suppressed
        is_suppressed = should_suppress_setup()

        # Generate configuration report
        config_report = generate_config_report()

        # Determine system message
        if is_suppressed:
            # If suppressed and no issues, return minimal response
            should_update = should_suggest_update()
            if not should_update:
                # No issues, suppress everything
                result: dict[str, Any] = {
                    "continue": True,
                    "systemMessage": ""  # Empty message
                }
                print(json.dumps(result))
                sys.exit(0)
            else:
                # Issues found, show them even if suppressed
                system_message = f"âš ï¸  Configuration issues detected:\n{config_report}"
        else:
            # Not suppressed, show full report
            system_message = f"ğŸ“‹ Configuration Health Check:\n{config_report}"

            if should_update:
                system_message += "\n\nâš ï¸  Configuration issues detected. Please take action."

        result: dict[str, Any] = {
            "continue": True,
            "systemMessage": system_message
        }

        if should_update:
            question_data = { ... }
            result["askUserQuestion"] = question_data

        print(json.dumps(result))
        sys.exit(0)
    ...
```

## êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë‹¨ê³„ 1: session_start__show_project_info.py ìˆ˜ì •

- [ ] should_show_setup_messages() í•¨ìˆ˜ ì¶”ê°€
- [ ] í•¨ìˆ˜ì— datetime import í™•ì¸ (ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìŒ)
- [ ] main()ì—ì„œ show_messages ë³€ìˆ˜ ì¶”ê°€
- [ ] main()ì—ì„œ session_outputì„ ì¡°ê±´ë¶€ë¡œ ìƒì„±
- [ ] íŒŒì¼ ì €ì¥ ë° chmod +x ìœ ì§€ í™•ì¸

### ë‹¨ê³„ 2: session_start__config_health_check.py ìˆ˜ì •

- [ ] should_suppress_setup() í•¨ìˆ˜ ì¶”ê°€
- [ ] main()ì—ì„œ is_suppressed ë³€ìˆ˜ ì¶”ê°€
- [ ] main()ì—ì„œ is_suppressedë¥¼ í™•ì¸í•˜ì—¬ ì‘ë‹µ ìƒì„±
- [ ] íŒŒì¼ ì €ì¥

### ë‹¨ê³„ 3: í…ŒìŠ¤íŠ¸

- [ ] config.jsonì—ì„œ suppress_setup_messagesë¥¼ falseë¡œ ì„¤ì •
- [ ] ìƒˆ Claude Code ì„¸ì…˜ ì‹œì‘
- [ ] setup ë©”ì‹œì§€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
  - "ğŸš€ MoAI-ADK Session Started" ë©”ì‹œì§€ í™•ì¸
  - "ğŸ“‹ Configuration Health Check" ë©”ì‹œì§€ í™•ì¸

- [ ] config.jsonì—ì„œ suppress_setup_messagesë¥¼ trueë¡œ ì„¤ì •
- [ ] setup_messages_suppressed_atë¥¼ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
- [ ] ìƒˆ Claude Code ì„¸ì…˜ ì‹œì‘
- [ ] setup ë©”ì‹œì§€ í‘œì‹œë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
  - ë¹ˆ ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë˜ëŠ” ìµœì†Œí•œì˜ ë©”ì‹œì§€ë§Œ í‘œì‹œ

- [ ] 7ì¼ ê²½ê³¼ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
  - setup_messages_suppressed_atë¥¼ 7ì¼ ì „ ë‚ ì§œë¡œ ë³€ê²½
  - ìƒˆ ì„¸ì…˜ ì‹œì‘ â†’ ë©”ì‹œì§€ ë‹¤ì‹œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

## êµ¬í˜„ í›„ ì˜ˆìƒ ë™ì‘

### ì‹œë‚˜ë¦¬ì˜¤ 1: suppress_setup_messages = false (ë©”ì‹œì§€ í•­ìƒ í‘œì‹œ)

```
Claude Code ì„¸ì…˜ ì‹œì‘
â”œâ”€ session_start__show_project_info.py ì‹¤í–‰
â”‚  â”œâ”€ should_show_setup_messages() â†’ true ë°˜í™˜
â”‚  â””â”€ systemMessage: "ğŸš€ MoAI-ADK Session Started\n..."
â””â”€ session_start__config_health_check.py ì‹¤í–‰
   â”œâ”€ should_suppress_setup() â†’ false ë°˜í™˜
   â””â”€ systemMessage: "ğŸ“‹ Configuration Health Check:\nâœ… Configuration complete\n..."

ì‚¬ìš©ìì—ê²Œ í‘œì‹œë¨:
âœ“ í”„ë¡œì íŠ¸ ì •ë³´ (ë¸Œëœì¹˜, ë³€ê²½ì‚¬í•­, ìµœê·¼ ì»¤ë°‹)
âœ“ ì„¤ì • ìƒíƒœ (ì™„ì„±ë„, ë²„ì „, ì—…ë°ì´íŠ¸ í•„ìš” ì—¬ë¶€)
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: suppress_setup_messages = true (7ì¼ ì´ë‚´)

```
Claude Code ì„¸ì…˜ ì‹œì‘
â”œâ”€ session_start__show_project_info.py ì‹¤í–‰
â”‚  â”œâ”€ should_show_setup_messages() â†’ false ë°˜í™˜ (7ì¼ ë¯¸ê²½ê³¼)
â”‚  â””â”€ systemMessage: "" (ë¹ˆ ë©”ì‹œì§€)
â””â”€ session_start__config_health_check.py ì‹¤í–‰
   â”œâ”€ should_suppress_setup() â†’ true ë°˜í™˜
   â”œâ”€ should_updateê°€ falseë¼ë©´:
   â”‚  â””â”€ systemMessage: "" (ë¹ˆ ë©”ì‹œì§€)
   â””â”€ should_updateê°€ trueë¼ë©´:
      â””â”€ systemMessage: "âš ï¸  Configuration issues detected:\n..." (ì´ìŠˆë§Œ í‘œì‹œ)

ì‚¬ìš©ìì—ê²Œ í‘œì‹œë¨:
âœ— í”„ë¡œì íŠ¸ ì •ë³´ ë¹„í‘œì‹œ
âœ— ì„¤ì • ìƒíƒœ ë¹„í‘œì‹œ
âœ“ ì„¤ì • ë¬¸ì œê°€ ìˆìœ¼ë©´ ê²½ê³ ë§Œ í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: suppress_setup_messages = true (7ì¼ ì´ˆê³¼)

```
Claude Code ì„¸ì…˜ ì‹œì‘
â”œâ”€ session_start__show_project_info.py ì‹¤í–‰
â”‚  â”œâ”€ should_show_setup_messages() â†’ true ë°˜í™˜ (7ì¼ ê²½ê³¼)
â”‚  â””â”€ systemMessage: "ğŸš€ MoAI-ADK Session Started\n..."
â””â”€ session_start__config_health_check.py ì‹¤í–‰
   â”œâ”€ should_suppress_setup() â†’ false ë°˜í™˜ (7ì¼ ê²½ê³¼)
   â””â”€ systemMessage: "ğŸ“‹ Configuration Health Check:\n..."

ì‚¬ìš©ìì—ê²Œ í‘œì‹œë¨:
âœ“ í”„ë¡œì íŠ¸ ì •ë³´ (ë‹¤ì‹œ í‘œì‹œ)
âœ“ ì„¤ì • ìƒíƒœ (ë‹¤ì‹œ í‘œì‹œ)

ì°¸ê³ : setup_messages_suppressed_atê°€ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•¨
```

## ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 1. í”Œë˜ê·¸ ìë™ ì—…ë°ì´íŠ¸

í˜„ì¬ êµ¬í˜„:
- setup_messages_suppressed_atëŠ” ìˆ˜ë™ìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸ë¨
- 7ì¼ ì´ˆê³¼ í›„ ë©”ì‹œì§€ ì¬í‘œì‹œ ì‹œ, ìë™ìœ¼ë¡œ íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ

í–¥í›„ ê°œì„  ì‚¬í•­:
- main()ì—ì„œ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ë•Œ, íƒ€ì„ìŠ¤íƒ¬í”„ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
- ë˜ëŠ” ë³„ë„ì˜ post-hookì—ì„œ ì²˜ë¦¬

### 2. íƒ€ì„ìŠ¤íƒ¬í”„ í˜•ì‹

í˜„ì¬ ì‚¬ìš©:
- ISO 8601 í˜•ì‹ (ì˜ˆ: "2025-11-12T00:00:00Z")
- datetime.fromisoformat()ìœ¼ë¡œ íŒŒì‹± ê°€ëŠ¥

ì£¼ì˜ì‚¬í•­:
- íƒ€ì„ì¡´ ì •ë³´ í¬í•¨ í•„ìš” (Z = UTC)
- ì—†ìœ¼ë©´ í˜„ì¬ ì‹œê°„ëŒ€ë¡œ ê¸°ë³¸ ì„¤ì •

### 3. ì—ëŸ¬ í•¸ë“¤ë§

ê¶Œì¥ ì‚¬í•­:
- config.jsonì„ ì½ì„ ìˆ˜ ì—†ìœ¼ë©´: ë©”ì‹œì§€ í‘œì‹œ (ë³´ìˆ˜ì )
- íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´: ë©”ì‹œì§€ í‘œì‹œ (ë³´ìˆ˜ì )
- suppress_setup_messagesê°€ ëª…ì‹œë˜ì§€ ì•Šìœ¼ë©´: falseë¡œ ê°„ì£¼ (ê¸°ë³¸ê°’)

## íŒ¨í‚¤ì§€ í…œí”Œë¦¿ ë™ê¸°í™”

ì´ ë³€ê²½ì‚¬í•­ì„ íŒ¨í‚¤ì§€ í…œí”Œë¦¿ì—ë„ ë°˜ì˜:

- /Users/goos/MoAI/MoAI-ADK/src/moai_adk/templates/.claude/hooks/alfred/session_start__show_project_info.py
- /Users/goos/MoAI/MoAI-ADK/src/moai_adk/templates/.claude/hooks/alfred/session_start__config_health_check.py

íŒ¨í‚¤ì§€ í…œí”Œë¦¿ì´ source of truthì´ë¯€ë¡œ, ë¡œì»¬ êµ¬í˜„ í›„ í…œí”Œë¦¿ë„ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

## ê²€ì¦ ëª…ë ¹ì–´

êµ¬í˜„ í›„ ê²€ì¦:

```bash
# íŒŒì¼ì´ Python êµ¬ë¬¸ì ìœ¼ë¡œ ìœ íš¨í•œì§€ í™•ì¸
python3 -m py_compile .claude/hooks/alfred/session_start__show_project_info.py
python3 -m py_compile .claude/hooks/alfred/session_start__config_health_check.py

# ì‹¤ì œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ (í•„ìš” ì‹œ)
python3 -c "from pathlib import Path; exec(open('.claude/hooks/alfred/session_start__show_project_info.py').read()); print(should_show_setup_messages())"

# config.json ë¬¸ë²• í™•ì¸
cat .moai/config/config.json | jq '.session'

# í›…ì´ í˜¸ì¶œë˜ëŠ”ì§€ í™•ì¸ (ìƒˆ ì„¸ì…˜ ì‹œì‘ í›„ ë¡œê·¸ í™•ì¸)
cat .moai/logs/sessions/*.log | tail -50
```

## ë§ˆë¬´ë¦¬

ì´ êµ¬í˜„ìœ¼ë¡œ:
1. .moai/config/config.jsonì˜ session.suppress_setup_messages í”Œë˜ê·¸ê°€ ì‹¤ì œë¡œ ë™ì‘
2. Claude Codeì˜ SessionStart í›…ì´ ì„¤ì •ì„ ì¡´ì¤‘
3. í”„ë¡œì íŠ¸ê°€ ì´ë¯¸ ì„¤ì •ë˜ì—ˆìœ¼ë©´ ë¶ˆí•„ìš”í•œ ë©”ì‹œì§€ ë¹„í‘œì‹œ
4. 7ì¼ë§ˆë‹¤ ì„¤ì • ìƒíƒœ í™•ì¸ ë©”ì‹œì§€ ë‹¤ì‹œ í‘œì‹œ

ì´ë¥¼ í†µí•´ Claude Code ì„¸ì…˜ ì‹œì‘ ì‹œ ì¼ê´€ë˜ê³  ê¹”ë”í•œ ì‚¬ìš©ì ê²½í—˜ ì œê³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.
