# Alfred의 SPEC 판단 로직

**작성일**: 2025-11-21
**상태**: Production Ready

---

## 개요

Alfred는 사용자의 요청과 대화를 **자연어로 분석**하여 SPEC 작성 필요성을 자동으로 판단합니다.

이 문서는 Alfred의 판단 기준과 사용자에게 제안하는 방식을 상세히 설명합니다.

---

## 판단 기준: 5가지 질문

Alfred는 다음 5가지 질문을 통해 작업의 복잡도를 분석합니다:

### ① 파일 수정 범위
**Q**: 여러 파일을 수정하거나 새로 생성하는가?

```
아니오: 한 파일만 수정
  예시: CSS 스타일 변경, 문자열 수정, 함수 1개 추가

가능: 2-3개 파일 수정
  예시: 로그인 로직 수정 (컴포넌트 + 서비스)

예: 4개 이상 파일 수정
  예시: 이미지 업로드 (API + Frontend + DB + Middleware)
```

### ② 아키텍처 영향
**Q**: 아키텍처나 데이터 모델 변경이 있는가?

```
아니오: 기존 구조 유지
  예시: 기존 엔드포인트의 로직 수정

가능: 부분적 변경
  예시: 새로운 Service 클래스 추가, 기존 DB 칼럼 추가

예: 주요 변경
  예시: 마이크로서비스 전환, 새로운 아키텍처 패턴 도입
```

### ③ 컴포넌트 통합
**Q**: 여러 컴포넌트 간 통합이 필요한가?

```
아니오: 단일 컴포넌트만
  예시: 한 페이지 내에서만 변경

가능: 2-3개 컴포넌트
  예시: Login 컴포넌트 + Profile 컴포넌트

예: 4개 이상 컴포넌트
  예시: Frontend + Backend + Database + Cache + Message Queue
```

### ④ 구현 시간
**Q**: 구현 시간이 30분 이상 예상되는가?

```
아니오: 15분 이하
  예시: 색상 변경, 텍스트 수정, 간단한 함수

가능: 15-30분
  예시: 간단한 기능 추가, 부분 리팩토링

예: 30분 이상
  예시: 복잡한 기능, 아키텍처 변경, 통합 작업
```

### ⑤ 향후 유지보수
**Q**: 향후 유지보수나 확장이 필요한가?

```
아니오: 일회성 작업
  예시: 긴급 버그 수정, 임시 로직

가능: 향후 변경 가능성
  예시: 새로운 결제 모듈, 인증 시스템

예: 확실한 유지보수/확장 필요
  예시: 핵심 기능, 재사용 가능한 컴포넌트
```

---

## 판단 로직

Alfred는 위 5가지 질문에 대한 답변을 수집하여 다음과 같이 판단합니다:

```
"예" 또는 "가능" 답변 개수:

┌─────────┬──────────────┬────────────────────────┐
│ 개수    │ 판단         │ 행동                   │
├─────────┼──────────────┼────────────────────────┤
│ 0-1개   │ SPEC 불필요  │ 즉시 구현 진행         │
│ 2-3개   │ SPEC 권장    │ 사용자 선택 (Yes/No)   │
│ 4-5개   │ SPEC 강력    │ 강조된 제안             │
│         │ 권장         │                        │
└─────────┴──────────────┴────────────────────────┘
```

---

## 사용자 제안 패턴

### 패턴 A: SPEC 불필요 (0-1개 충족)

```
GOOS님, 이 작업은 SPEC 없이 바로 구현하겠습니다.

분석:
  • 한 파일만 수정
  • 아키텍처 영향 없음
  • 구현 시간 15분 이내

→ 즉시 구현 진행
```

### 패턴 B: SPEC 권장 (2-3개 충족)

```
GOOS님, 이 작업은 다음 이유로 SPEC 문서 작성을 권장합니다:

📋 분석 결과:
  ✓ 여러 파일 수정 필요 (Backend, Frontend)
  ✓ 데이터 모델 변경 있음
  - 컴포넌트 통합: 2개
  - 구현 시간: 45분
  - 향후 유지보수: 있음

이를 통해 구현 시간을 30% 단축할 수 있습니다.

다음 중 선택해주세요:
```

그 후 `AskUserQuestion` 호출:

```json
{
  "questions": [
    {
      "question": "SPEC 문서를 생성하고 진행하시겠습니까?",
      "header": "SPEC 제안",
      "multiSelect": false,
      "options": [
        {
          "label": "예, SPEC 생성 후 구현",
          "description": "자동으로 /moai:1-plan을 실행하고 spec-builder에 위임합니다"
        },
        {
          "label": "아니오, 바로 구현 시작",
          "description": "SPEC 없이 즉시 구현을 진행합니다"
        }
      ]
    }
  ]
}
```

### 패턴 C: SPEC 강력 권장 (4-5개 충족)

```
GOOS님, 이 작업은 다음 이유로 SPEC 문서 작성이 **강력히 권장**됩니다:

⚠️ 복잡도 분석:
  ✓ 여러 파일 수정 (Backend, Frontend, DB 포함)
  ✓ 아키텍처 변경 필요
  ✓ 3개 이상 컴포넌트 통합
  ✓ 예상 구현 시간: 2-3시간
  ✓ 향후 유지보수 필요

SPEC 작성 시 예상 효과:
  • 구현 시간 40% 단축
  • 버그 위험 60% 감소
  • 미래 유지보수 비용 50% 절감

다음 중 선택해주세요:
```

같은 방식으로 `AskUserQuestion` 호출

---

## 자동 워크플로우

### 사용자가 "예, SPEC 생성"을 선택한 경우

**Step 1: 사용자 피드백**
```
GOOS님, SPEC을 생성하겠습니다. 잠시만 기다려주세요...
```

**Step 2: SPEC 생성 실행**
```bash
/moai:1-plan "{요구사항 요약}"
```

Alfred가 자동으로 호출:
```python
Task(
  subagent_type="spec-builder",
  description="Generate SPEC document",
  prompt="사용자 요구사항 분석 및 SPEC 생성"
)
```

**Step 3: 템플릿 자동 선택**
spec-builder가 자동으로 다음 중 선택:
```
복잡도 LOW → Level 1 (Minimal, 5개 섹션)
복잡도 MEDIUM → Level 2 (Standard, 7개 섹션, EARS)
복잡도 HIGH → Level 3 (Comprehensive, 10+ 섹션)
```

**Step 4: SPEC 생성 완료**
```
SPEC-001이 생성되었습니다.
```

**Step 5: 컨텍스트 초기화**
```
/clear 실행하여 새 세션 시작
```

**Step 6: 구현 제안**
```
📋 다음 단계:
  1. /clear (컨텍스트 초기화)
  2. /moai:2-run SPEC-001 (TDD 구현)

진행하시겠습니까?
```

---

## 판단 예시

### 예시 1: 버그 수정 (SPEC 불필요)

**사용자 요청**:
> "로그인 페이지의 에러 메시지가 영어로만 표시됩니다. 한글로 변경해주세요."

**Alfred 분석**:
```
① 파일 수정: i18n 설정 1개만 → 아니오
② 아키텍처: 변경 없음 → 아니오
③ 컴포넌트: 단일 → 아니오
④ 시간: 10분 → 아니오
⑤ 유지보수: 없음 → 아니오

결과: 0개 충족 → SPEC 불필요
```

**Alfred 결정**:
```
즉시 구현 진행

구현: i18n/messages.json에 한글 번역 추가
```

---

### 예시 2: 기능 추가 (SPEC 권장)

**사용자 요청**:
> "사용자가 프로필 사진을 업로드할 수 있는 기능을 추가하고 싶습니다. 이미지 최적화, 캐싱, DB 저장까지 포함해야 합니다."

**Alfred 분석**:
```
① 파일 수정: Backend API + Frontend Form + DB Schema + Middleware
   → 4개 이상 → 예

② 아키텍처: 파일 업로드 흐름 추가, 이미지 처리 레이어
   → 주요 변경 → 예

③ 컴포넌트: Frontend + Backend + Database + Cache
   → 4개 이상 → 예

④ 시간: 이미지 최적화, S3 연동, 프론트 UI
   → 2시간 이상 → 예

⑤ 유지보수: 향후 프로필 관련 기능 확장 가능
   → 확실함 → 예

결과: 5개 충족 → SPEC 강력 권장
```

**Alfred 결정**:
```
사용자에게 SPEC 강력 권장 제안

사용자 "예" 선택

→ /moai:1-plan 자동 실행
→ spec-builder가 Level 2 (Standard) 템플릿 선택
→ SPEC-003 자동 생성
→ /moai:2-run SPEC-003으로 TDD 구현
```

---

### 예시 3: 프로토타입 (예외)

**사용자 요청**:
> "빠르게 프로토타입을 만들어보고 싶습니다. 정확한 설계보다는 빠른 구현이 중요합니다."

**Alfred 분석**:
```
프로토타입 키워드 감지
→ "빠르게", "프로토타입", "임시" 등의 단어 인식

특수 처리:
  복잡도와 관계없이 SPEC 스킵
  즉시 구현 권장
```

**Alfred 결정**:
```
GOOS님, 프로토타입이군요. 빠르게 진행하겠습니다.

→ 즉시 구현 시작
→ 완료 후 프로덕션 전환 시 SPEC 제안 가능
```

---

## 예외 처리

### 경우 1: 사용자가 SPEC 거부

```
GOOS님, SPEC 없이 바로 구현을 진행하겠습니다.

⚠️ 참고: 구현 중 복잡도가 증가하면
SPEC으로 전환할 수 있습니다.
```

→ 즉시 구현 진행

### 경우 2: 구현 중 복잡도 증가

초기 판단: 간단한 수정 (SPEC 불필요)
구현 중: 예상 외로 복잡도 증가

```
GOOS님, 이 작업이 예상보다 복잡해지고 있습니다.

현재 상황:
  • 추가 파일 수정 필요
  • 아키텍처 변경 가능성
  • 예상 시간 2시간으로 증가

SPEC을 작성하여 체계적으로 진행하시겠습니까?
```

→ 사용자 선택에 따라 즉시 `/moai:1-plan` 실행 가능

### 경우 3: 긴급 상황

```
사용자: "프로덕션 버그입니다. 즉시 수정이 필요합니다!"

Alfred: SPEC 제안 스킵

→ 즉시 구현
→ 완료 후 SPEC 작성 가능
```

---

## Alfred의 장점

### 1. 자연스러운 워크플로우
```
❌ 이전: 사용자가 매번 "SPEC이 필요한가?" 판단
✅ 이후: Alfred가 자동으로 판단 및 제안
```

### 2. False Positive 최소화
```
5가지 조건으로 보수적 판단
→ 불필요한 제안 줄임
→ 사용자 신뢰도 높음
```

### 3. 유연한 대응
```
프로토타입, 긴급 수정, 구현 중 변경 등
다양한 상황에 대응 가능
```

### 4. 데이터 기반 개선
```
월간 통계로 효과 측정
→ 판단 기준 지속 개선
```

---

## 구현 체크리스트

Alfred의 SPEC 판단을 구현할 때 확인할 항목:

- [ ] 5가지 질문 프롬프트 구현
- [ ] 조건 충족 개수 계산 로직
- [ ] AskUserQuestion 통합
- [ ] 자동 /moai:1-plan 트리거
- [ ] 템플릿 자동 선택 로직
- [ ] 예외 처리 (프로토타입, 긴급)
- [ ] 구현 중 복잡도 증가 감지
- [ ] 통계 데이터 수집 연동

---

**문서 버전**: 1.0.0
**마지막 업데이트**: 2025-11-21
**상태**: Production Ready
