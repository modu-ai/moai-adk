# Workflow Configuration
# Execution mode, team settings, and automation preferences

workflow:
  # Execution mode selection
  # Options: auto (intelligent selection), subagent (classic mode), team (agent teams)
  execution_mode: "auto"

  # Auto-clear strategy for context management
  auto_clear:
    enabled: true
    after_plan: true
    after_run: false
    token_threshold: 150000

  # Token budget allocations per phase
  token_budget:
    plan: 30000
    run: 180000
    sync: 40000

  # Agent Teams configuration
  team:
    # Master switch - also requires CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
    enabled: false

    # Maximum teammates per team (2-5 recommended)
    max_teammates: 5

    # Default model for teammates
    # Options: haiku (fast/cheap), sonnet (balanced), opus (powerful)
    default_model: "sonnet"

    # Require teammates to get plan approved before implementing
    require_plan_approval: true

    # Team lead operates in delegate mode (coordination only, no direct implementation)
    delegate_mode: true

    # Display mode for teammates
    # Options: auto (tmux if available), in-process (same terminal), tmux (force split panes)
    teammate_display: "auto"

    # Auto-selection thresholds for switching to team mode
    auto_selection:
      # Minimum number of distinct domains to trigger team mode
      min_domains_for_team: 3

      # Minimum number of affected files to trigger team mode
      min_files_for_team: 10

      # Minimum complexity score (1-10) to trigger team mode
      min_complexity_score: 7

    # Pre-defined team composition patterns
    patterns:
      plan_research:
        roles:
          - researcher
          - analyst
          - architect
        model: "sonnet"
        description: "Parallel SPEC research and design"

      implementation:
        roles:
          - backend-dev
          - frontend-dev
          - tester
        model: "sonnet"
        description: "Cross-layer feature implementation"

      design_implementation:
        roles:
          - designer
          - backend-dev
          - frontend-dev
          - tester
        model: "sonnet"
        description: "Cross-layer feature implementation with UI/UX design"

      full_stack:
        roles:
          - api-layer
          - ui-layer
          - data-layer
          - quality
        model: "sonnet"
        description: "Full-stack implementation with quality gate"

      investigation:
        roles:
          - hypothesis-1
          - hypothesis-2
          - hypothesis-3
        model: "haiku"
        description: "Competing hypothesis debugging"

      review:
        roles:
          - security-reviewer
          - perf-reviewer
          - quality-reviewer
        model: "sonnet"
        description: "Multi-perspective code review"

  # Completion markers for workflow state detection
  completion:
    markers:
      done: "<moai>DONE</moai>"
      complete: "<moai>COMPLETE</moai>"
    detect_in_output: true

  # Loop prevention guards
  loop_prevention:
    max_iterations: 100
    max_retries_per_operation: 3
    failure_pattern_detection: true
