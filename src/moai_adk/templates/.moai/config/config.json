{
  "_meta": {
  },
  "moai": {
    "version": "{{MOAI_VERSION}}",
    "update_check_frequency": "daily",
    "version_check": {
      "enabled": true,
      "cache_ttl_hours": 24
    }
  },
  "constitution": {
    "enforce_tdd": true,
    "principles": {
      "simplicity": {
        "max_projects": 5,
        "notes": "Default recommendation. Adjust in .moai/config.json or via SPEC/ADR with documented rationale based on project size."
      }
    },
    "test_coverage_target": 90
  },
  "git_strategy": {
    "mode": "selection",
    "_notes": "Selection-Based Workflow (v0.26.0+): Both Personal and Team modes use GitHub Flow (main-based). Users select mode manually via config.enabled flags. No auto-switching.",
    "personal": {
      "enabled": true,
      "workflow": "github-flow",
      "_workflow_notes": "Personal mode: feature/SPEC-XXX → PR → main (self-merge allowed). Fast, simple workflow for solo development with CI automation.",
      "require_pr": true,
      "_pr_notes": "PR creation required for CI/CD integration, documentation, and audit trail. Self-merge allowed (allow_self_merge: true)",
      "allow_self_merge": true,
      "require_review": false,
      "_review_notes": "Code review optional (peer review encouraged but not mandatory)",
      "auto_checkpoint": "event-driven",
      "checkpoint_events": [
        "delete",
        "refactor",
        "merge",
        "script",
        "critical-file"
      ],
      "checkpoint_type": "local-branch",
      "max_checkpoints": 10,
      "cleanup_days": 7,
      "push_to_remote": false,
      "auto_commit": true,
      "branch_prefix": "feature/SPEC-",
      "base_branch": "main",
      "main_branch": "main",
      "prevent_branch_creation": false,
      "work_on_main": false,
      "require_ci": true,
      "auto_merge": false
    },
    "team": {
      "enabled": false,
      "_notes": "Team mode: Enable manually (enabled: true) when collaborating. Uses GitHub Flow: feature/SPEC-XXX → PR → main with mandatory review. No auto-switching.",
      "workflow": "github-flow",
      "require_pr": true,
      "_pr_notes": "PR creation required for all changes (no direct commits to main)",
      "allow_self_merge": false,
      "_merge_notes": "Author cannot merge own PR. Requires reviewer approval before merge.",
      "base_branch": "main",
      "main_branch": "main",
      "draft_pr": false,
      "feature_prefix": "feature/SPEC-",
      "require_review": true,
      "min_reviewers": 1
    }
  },
  "pipeline": {
    "available_commands": [
      "/alfred:0-project",
      "/alfred:1-plan",
      "/alfred:2-run",
      "/alfred:3-sync"
    ]
  },
  "language": {
    "conversation_language": "{{CONVERSATION_LANGUAGE}}",
    "conversation_language_name": "{{CONVERSATION_LANGUAGE_NAME}}",
    "agent_prompt_language": "{{CONVERSATION_LANGUAGE}}",
    "notes": "Language for sub-agent internal prompts (english=global standard, localized=user's conversation language)"
  },
  "project": {
    "name": "{{PROJECT_NAME}}",
    "description": "{{PROJECT_DESCRIPTION}}",
    "owner": "{{PROJECT_OWNER}}",
    "mode": "{{PROJECT_MODE}}",
    "locale": "{{CONVERSATION_LANGUAGE}}",
    "language": "{{CODEBASE_LANGUAGE}}",
    "created_at": "{{CREATION_TIMESTAMP}}",
    "initialized": true,
    "optimized": false,
    "optimized_at": null,
    "_notes": "optimized=false: Template updated, config merge required. optimized=true: Configuration fully merged and verified."
  },
  "user": {
    "name": "{{USER_NAME}}",
    "notes": "Personal name for Alfred's personalized greetings (e.g., '철수', 'John'). Leave empty for default greetings like '사용자님'"
  },
  "session": {
    "suppress_setup_messages": false,
    "notes": "suppress_setup_messages: false enables SessionStart output. Set to true to suppress messages (show again after 7 days)"
  },
  "hooks": {
    "timeout_ms": 2000,
    "graceful_degradation": true,
    "notes": "Hook execution timeout (milliseconds). Set graceful_degradation to true to continue even if a hook fails. Optimized to 2 seconds for faster performance."
  },
  "session_end": {
    "enabled": true,
    "metrics": {
      "enabled": true,
      "save_location": ".moai/logs/sessions/"
    },
    "work_state": {
      "enabled": true,
      "save_location": ".moai/memory/last-session-state.json"
    },
    "cleanup": {
      "enabled": true,
      "temp_files": true,
      "cache_files": true,
      "patterns": [
        ".moai/temp/*",
        ".moai/cache/*.tmp"
      ]
    },
    "warnings": {
      "uncommitted_changes": true
    },
    "summary": {
      "enabled": true,
      "max_lines": 5
    },
    "notes": "SessionEnd hook configuration. Executed when Claude Code session ends. Controls metrics saving, work state preservation, cleanup, warnings, and summary generation."
  },
  "auto_cleanup": {
    "enabled": true,
    "cleanup_days": 7,
    "max_reports": 10,
    "cleanup_targets": [
      ".moai/reports/*.json",
      ".moai/reports/*.md",
      ".moai/cache/*",
      ".moai/temp/*"
    ]
  },
  "daily_analysis": {
    "enabled": true,
    "analysis_time": "00:00",
    "analyze_sessions": true,
    "analyze_tools": true,
    "analyze_errors": true,
    "analyze_permissions": true,
    "auto_optimize": false,
    "report_location": ".moai/reports/daily-"
  },
  "report_generation": {
    "enabled": true,
    "auto_create": false,
    "warn_user": true,
    "user_choice": "Minimal",
    "configured_at": "{{CREATION_TIMESTAMP}}",
    "allowed_locations": [
      ".moai/docs/",
      ".moai/reports/",
      ".moai/analysis/",
      ".moai/specs/SPEC-*/"
    ],
    "notes": "Control automatic report generation. 'enabled': turn on/off, 'auto_create': full (true) vs minimal (false) reports. Helps reduce token usage."
  },
  "github": {
    "templates": {
      "enable_trust_5": true,
      "enable_alfred_commands": true,
      "spec_directory": ".moai/specs",
      "docs_directory": ".moai/docs",
      "test_directory": "tests",
      "notes": "Configure GitHub templates for project customization. When enable_* flags are false, corresponding MoAI-specific sections are omitted from templates."
    },
    "auto_delete_branches": null,
    "auto_delete_branches_checked": false,
    "spec_git_workflow": "per_spec",
    "spec_git_workflow_configured": false,
    "notes": "auto_delete_branches: whether to auto-delete feature branches after merge. spec_git_workflow: 'feature_branch' (auto), 'develop_direct' (direct), 'per_spec' (ask per SPEC - flexible, user controls each workflow)"
  },
  "agent_permissions": {
    "_meta": "Claude Code v2.0.43 Agent Permission & Skills Configuration",
    "_version": "2.0.43",
    "_description": "Agent-level permission control (permissionMode) and Skills auto-loading",
    "_activated_by": "SubagentStart/Stop Hooks with model parameter optimization",
    "hooks": {
      "model_strategy": {
        "subagent_start": {
          "type": "context_optimizer",
          "purpose": "Optimize context for each agent based on type",
          "model": "haiku",
          "cost_savings": "70% vs no optimization",
          "features": ["context_strategy", "token_budget", "priority_files", "auto_load_skills"]
        },
        "subagent_stop": {
          "type": "lifecycle_tracker",
          "purpose": "Track agent completion and performance metrics",
          "model": "haiku",
          "tracking": ["execution_time_ms", "success_status", "agent_transcript_path"]
        }
      }
    },
    "permission_modes": {
      "auto": {
        "description": "Automatically executed (no user approval required)",
        "use_cases": ["SPEC generation", "documentation", "validation", "configuration"],
        "examples": ["spec-builder", "docs-manager", "quality-gate"],
        "safety": "Safe for non-destructive operations"
      },
      "ask": {
        "description": "Requires user approval via Task() delegation",
        "use_cases": ["code implementation", "architecture decisions", "deployment"],
        "examples": ["tdd-implementer", "backend-expert", "frontend-expert"],
        "safety": "Requires explicit user confirmation"
      }
    },
    "auto_mode_agents": [
      "spec-builder",
      "docs-manager",
      "quality-gate",
      "project-manager",
      "agent-factory",
      "skill-factory",
      "doc-syncer",
      "cc-manager",
      "format-expert",
      "sync-manager"
    ],
    "ask_mode_agents": [
      "tdd-implementer",
      "backend-expert",
      "frontend-expert",
      "performance-engineer",
      "devops-expert",
      "api-designer",
      "mcp-context7-integrator",
      "debug-helper",
      "implementation-planner",
      "monitoring-expert",
      "migration-expert",
      "ui-ux-expert",
      "accessibility-expert",
      "component-designer",
      "trust-checker",
      "mcp-sequential-thinking-integrator",
      "mcp-playwright-integrator",
      "mcp-notion-integrator",
      "figma-expert",
      "database-expert",
      "security-expert",
      "git-manager"
    ],
    "skills_configuration": {
      "_notes": "Each agent has domain-specific Skills in frontmatter. Skills auto-load via SubagentStart Hook.",
      "high_reuse_skills": {
        "moai-lang-python": "7 agents (spec-builder, tdd-implementer, backend-expert, etc.)",
        "moai-domain-frontend": "5 agents (frontend-expert, ui-ux-expert, component-designer, etc.)",
        "moai-domain-cloud": "4 agents (devops-expert, performance-engineer, monitoring-expert, database-expert)",
        "moai-context7-lang-integration": "4 agents (backend-expert, api-designer, mcp-context7-integrator)"
      },
      "specialized_skills": {
        "moai-security-*": "security-expert only",
        "moai-baas-vercel-ext": "devops-expert only",
        "moai-domain-figma": "figma-expert only",
        "moai-domain-notion": "mcp-notion-integrator only",
        "moai-playwright-webapp-testing": "mcp-playwright-integrator only"
      }
    },
    "activation_flow": {
      "_notes": "How agent permissions and skills are loaded",
      "step_1": "User calls /alfred:1-plan or /alfred:2-run or Task(subagent_type='...')",
      "step_2": "SubagentStart Hook (model: haiku) triggered automatically",
      "step_3": "Agent frontmatter loaded (permissionMode + skills array)",
      "step_4": "If ask mode: User approval required via AskUserQuestion",
      "step_5": "If auto mode: Execute immediately",
      "step_6": "Skills auto-loaded based on agent type",
      "step_7": "SubagentStop Hook tracks completion and metrics"
    },
    "cost_optimization": {
      "hook_model_selection": {
        "haiku": "70% cheaper than sonnet, sufficient for lightweight hooks (SubagentStart/Stop)",
        "sonnet": "Used for complex user interaction hooks (UserPromptSubmit requires reasoning)",
        "cost_savings": "~73% reduction with haiku-based hooks vs all-sonnet"
      },
      "agent_delegation": {
        "_notes": "Using Task() for agent delegation saves 80-85% context tokens",
        "monolithic": "All context loaded: 130,000 tokens",
        "delegated": "Focused agents: 20,000-30,000 tokens each"
      }
    }
  },
  "document_management": {
    "_meta": {
    },
    "enabled": true,
    "enforce_structure": true,
    "block_root_pollution": false,
    "directories": {
      "reports": {
        "base": ".moai/reports/",
        "categories": ["inspection", "phases", "sync", "analysis", "validation", "daily"],
        "auto_categorize": true,
        "retention_days": 90
      },
      "logs": {
        "base": ".moai/logs/",
        "categories": ["sessions", "agent-transcripts", "errors", "execution"],
        "retention_days": 30
      },
      "scripts": {
        "base": ".moai/scripts/",
        "categories": ["dev", "conversion", "validation", "analysis", "maintenance"],
        "retention_days": null
      },
      "temp": {
        "base": ".moai/temp/",
        "categories": ["tests", "coverage", "work", "research"],
        "retention_days": 7,
        "auto_cleanup": true
      },
      "backups": {
        "base": ".moai/backups/",
        "categories": ["specs", "docs", "hooks", "skills", "config", "legacy"],
        "retention_days": 90,
        "max_backups_per_type": 10
      },
      "cache": {
        "base": ".moai/cache/",
        "categories": ["mcp", "analysis"],
        "retention_days": 30,
        "auto_cleanup": true
      }
    },
    "root_whitelist": [
      "README.md", "README.*.md",
      "CHANGELOG.md", "CONTRIBUTING.md", "CLAUDE.md",
      "LICENSE", "LICENSE.*",
      "pyproject.toml", "setup.py", "setup.cfg",
      "package.json", "package-lock.json", "yarn.lock", "pnpm-lock.yaml",
      ".gitignore", ".gitattributes", ".editorconfig", ".prettierrc", ".eslintrc*",
      "Makefile", "Dockerfile", "docker-compose.yml", ".dockerignore",
      "tsconfig.json", "jsconfig.json", "next.config.js", "vite.config.js"
    ],
    "file_patterns": {
      "reports": {
        "inspection": ["FINAL-INSPECTION-*.md", "*-inspection-*.md"],
        "phases": ["PHASE*-COMPLETION-*.md", "*-phase-*.md"],
        "sync": ["sync-report-*.md", "*-sync-*.md"],
        "analysis": ["*-ANALYSIS-*.md", "*-analysis-*.md"],
        "validation": ["*-validation-*.md", "*-quality-*.md"],
        "daily": ["daily-*.md", "*-daily-report-*.md"]
      },
      "scripts": {
        "dev": ["init-*.sh", "setup-*.sh", "*-dev-*.py"],
        "conversion": ["fix-*.js", "convert-*.py", "migrate-*.js"],
        "validation": ["validate_*.py", "lint_*.py", "check_*.sh"],
        "analysis": ["*_analyzer.py", "analyze_*.py", "*_monitor.py"],
        "maintenance": ["cleanup_*.sh", "maintain_*.py"]
      },
      "temp": {
        "tests": ["test-*.spec.js", "*_test.tmp", "*.test.temp"],
        "coverage": ["coverage.json", ".coverage", "*.lcov"],
        "work": ["*.tmp", "*.temp", "*.bak", "*.draft"]
      },
      "backups": {
        "docs": ["docs_backup_*", "docs-backup-*"],
        "hooks": ["hooks_backup_*", "hooks-backup-*"],
        "specs": ["specs_backup_*", "specs-backup-*"],
        "config": ["config_backup_*", "config-backup-*"]
      }
    },
    "validation": {
      "enabled": true,
      "on_file_create": true,
      "on_session_end": true,
      "warn_violations": true,
      "block_violations": false
    },
    "auto_migration": {
      "enabled": true,
      "scan_on_startup": false,
      "suggest_moves": true,
      "auto_move": false,
      "require_user_approval": true
    },
    "cleanup": {
      "enabled": true,
      "schedule": "session_end",
      "dry_run": false,
      "preserve_recent_days": 3,
      "max_items_per_cleanup": 100,
      "notify_before_delete": true
    },
    "notes": "Document management system to prevent project root pollution. Enforces .moai/ hierarchy for all internal files. Auto-categorizes by file patterns. Cleanup policy preserves recent files."
  }
}